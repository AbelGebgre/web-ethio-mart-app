(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"/2EW":function(t,o,e){"use strict";e.r(o),e.d(o,"NotificationModule",function(){return $});var i=e("Xa2L"),n=e("/1cH"),a=e("iadO"),l=e("1jcm"),s=e("d3UM"),r=e("NFeN"),u=e("qFsG"),c=e("kmnG"),d=e("0IaG"),b=e("V5BG"),p=e("Q4Mo"),m=e("jIHw"),h=e("7kUa"),f=e("3Pt+"),g=e("rEr+"),v=e("PCNd"),C=e("ofXK"),_=e("5o1E"),w=e("tyNb"),V=e("mrSG"),y=e("7+5H"),k=e("12jx"),W=e("fXoL"),O=e("H0VJ"),j=e("otk6"),S=e("tk/3"),D=e("xivw");let I=(()=>{class t{constructor(t,o,e,i){this.dialogServices=t,this.fun=o,this.http=e,this.config=i,this.formSubmit=new W.o,this.formImport=new W.o,this.formClose=new W.o,this.columns=[],this.oldColumns=[],this.data=[],this.length=0,this.dialogConfigModal={closable:!0,formComponent:y.a}}ngOnInit(){var t,o,e;this.oldColumns=(null===(t=this.config.lookupData)||void 0===t?void 0:t.columns)||[],this.width=(null===(o=this.config.lookupData)||void 0===o?void 0:o.width)||"800px",this.caption=null===(e=this.config.lookupData)||void 0===e?void 0:e.caption}getFile(t){var o,e;this.fileData=t,this.length=(null==t?void 0:t.upload.length)||0,null===(o=this.fileData)||void 0===o||o.deleted.forEach(t=>{this.data=this.data.filter(o=>o.fileID!==t.id)}),this.length>0?null===(e=this.fileData)||void 0===e||e.upload.forEach(t=>{this.getData(t,t.type.split("/")[1])}):this.data=[]}getData(t,o){this.columns=this.oldColumns;const e=this.fun.base64ToBlob(null==t?void 0:t.base64),i=new FileReader;i.onload=()=>{var e,n,a;const l="json"===o?this.fun.getJson(i.result):"csv"===o?this.fun.getCSV(i.result):this.fun.getExcel(i.result,null===(n=null===(e=null==t?void 0:t.name)||void 0===e?void 0:e.toString())||void 0===n?void 0:n.split(".")[0],null==t?void 0:t.id);if(this.data.push(...l),(null===(a=this.data)||void 0===a?void 0:a.length)>0){const t=this.columns=Object.keys(null==this?void 0:this.data[0]);this.columns=this.columns.map(t=>t.trim().split(" ").length>1&&""!==t.trim().split(" ")[1]?t.trim().split(" ").join("_").toLowerCase():t.trim().toLowerCase());const o=t.filter(t=>!this.columns.includes(t.toLowerCase()));this.columns=this.fun.getColumns(this.columns),o?(this.data=this.data.filter((t,o,e)=>o===e.findIndex(o=>o.amharic_names===t.amharic_names&&o.station_names===t.station_names&&o.route_no===t.route_no&&o.position===t.position)),console.log(this.data),this.data=this.data.map(t=>{const e=(t,...o)=>o.length?e(((t,o)=>{var e=t;return Object(V.__rest)(o,["symbol"==typeof e?e:e+""])})(o.pop(),t),...o):t;return e(t,...o)})):(this.blockUI.stop(),this.fun.notify("","Please check the columns",4e3),this.length=0)}else this.blockUI.stop(),this.fun.notify("","File does't have a data",4e3),this.length=0},"json"===o||"csv"===o?i.readAsText(e):i.readAsBinaryString(e)}uploadedFile(){var t;const o=[];return null===(t=this.data)||void 0===t||t.forEach(t=>{var e,i,n;0===o.filter(o=>o.route_no===t.route_no).length&&o.push({route_no:t.route_no,left:null===(e=this.data)||void 0===e?void 0:e.filter(o=>{var e;return o.route_no===t.route_no&&"l"===(null===(e=o.position)||void 0===e?void 0:e.toLowerCase())}).length,right:null===(i=this.data)||void 0===i?void 0:i.filter(o=>{var e;return o.route_no===t.route_no&&"r"===(null===(e=o.position)||void 0===e?void 0:e.toLowerCase())}).length,items:null===(n=this.data)||void 0===n?void 0:n.filter(o=>o.route_no===t.route_no)})}),o[o.length-1].route_no}onSave(){this.formImport.emit(this.data)}onCancel(){this.formClose.emit()}showModalTable(){this.blockUI.stop(),this.dialogConfigModal.width=this.width,this.dialogConfigModal.lookupData={caption:"Imported "+this.caption+" data.",columns:this.columns,data:this.data,actions:[{icon:"trash",color:"danger"}],button:"Save"};const t=this.dialogServices.handleDialog(this.dialogConfigModal);this.handleModalChange(t)}handleModalChange(t){t.componentInstance.formSave.subscribe(o=>{this.oldColumns.includes("published")&&(o=o.map(t=>{var o;return Object.assign(Object.assign({},t),{published:"yes"===(null===(o=null==t?void 0:t.published)||void 0===o?void 0:o.toLowerCase())?1:0})})),this.formSubmit.emit({value:o,dialogRef:t})})}}return t.\u0275fac=function(o){return new(o||t)(W.Qb(O.a),W.Qb(j.a),W.Qb(S.b),W.Qb(d.a))},t.\u0275cmp=W.Kb({type:t,selectors:[["app-import-data-template"]],outputs:{formSubmit:"formSubmit",formImport:"formImport",formClose:"formClose"},decls:15,vars:1,consts:[["mat-dialog-content","",1,"p-dialog-content"],[1,"p-col-12"],["fileType","application",3,"fileDropped"],["fileImage",""],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled","click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"]],template:function(t,o){1&t&&(W.Wb(0,"div",0),W.Wb(1,"div",1),W.Wb(2,"app-file-upload-template",2,3),W.ec("fileDropped",function(t){return o.getFile(t)}),W.Vb(),W.Vb(),W.Vb(),W.Wb(4,"div",4),W.Wb(5,"button",5),W.ec("click",function(){return o.onCancel()}),W.Rb(6,"span",6),W.Wb(7,"span",7),W.Qc(8,"Cancel"),W.Vb(),W.Rb(9,"span",8),W.Vb(),W.Wb(10,"button",9),W.ec("click",function(){return o.onSave()}),W.Rb(11,"span",10),W.Wb(12,"span",7),W.Qc(13,"Import"),W.Vb(),W.Rb(14,"span",8),W.Vb(),W.Vb()),2&t&&(W.Cb(10),W.oc("disabled",0==o.length))},directives:[d.e,D.a,d.c],styles:[".p-datatable[_ngcontent-%COMP%]   .p-datatable-tbody[_ngcontent-%COMP%] > tr[_ngcontent-%COMP%] > td[_ngcontent-%COMP%]{padding:.05rem 1px;white-space:normal;word-wrap:break-all}"]}),Object(V.__decorate)([Object(k.a)()],t.prototype,"blockUI",void 0),t})();var x=e("nnAt"),M=e("FKr1");function Q(t,o){if(1&t&&(W.Wb(0,"mat-option",28),W.Wb(1,"span",10),W.Wb(2,"b"),W.Qc(3),W.Vb(),W.Vb(),W.Rb(4,"br"),W.Wb(5,"span"),W.Wb(6,"small"),W.Qc(7),W.Vb(),W.Vb(),W.Vb()),2&t){const t=o.$implicit;W.oc("value",t),W.Cb(3),W.Rc(t.label),W.Cb(4),W.Rc(t.name)}}function R(t,o){if(1&t&&(W.Wb(0,"mat-error",29),W.Qc(1),W.Vb()),2&t){const t=W.hc();W.Cb(1),W.Rc(t.displayMessage.title)}}function N(t,o){if(1&t&&(W.Wb(0,"mat-error",29),W.Qc(1),W.Vb()),2&t){const t=W.hc();W.Cb(1),W.Rc(t.displayMessage.title)}}function L(t,o){if(1&t&&(W.Wb(0,"mat-error",29),W.Qc(1),W.Vb()),2&t){const t=W.hc();W.Cb(1),W.Rc(t.displayMessage.title)}}function G(t,o){if(1&t&&(W.Wb(0,"mat-error",29),W.Qc(1),W.Vb()),2&t){const t=W.hc();W.Cb(1),W.Rc(t.displayMessage.title)}}let B=(()=>{class t{constructor(t,o,e){var i;this.fb=t,this.fun=o,this.config=e,this.formSubmit=new W.o,this.formEditSave=new W.o,this.formClose=new W.o,this.columns=[],this.selectedColumns=[],this.displayMessage={},this.columns=this.config.formData.data.map(t=>({position:t.position,name:t.amharic_names+" - "+t.station_names+" ("+t.latitude+","+t.longitude+")",label:t.route_no+" "+t.position,value:t.id})),this.form=this.fb.group({id:(null===(i=this.config.formData)||void 0===i?void 0:i.id)||0,options:"a",columns:[this.columns,f.w.required],amharic_names:"",station_names:"",latitude:"",longitude:""}),this.genericValidator=new x.a(this.validationMessages)}ngOnInit(){this.form.valueChanges.subscribe()}onColumnsChange(t){this.selectedColumns="a"===t.value?this.columns:this.columns.filter(o=>o.position.toLowerCase()===t.value),this.form.controls.columns.patchValue(this.selectedColumns)}blur(){}keyDown(t,o){return t.key?this.fun.allowedKey(t.key,o):(t.target.value=this.fun.removeNotAllowedKey(t.target.value,o),!0)}getFile(t){this.form.controls.image.setValue((null==t?void 0:t.upload.length)>0?null==t?void 0:t.upload:[])}onSubmit(){this.formEditSave.emit(this.form.value)}onCancel(){this.formClose.emit()}}return t.\u0275fac=function(o){return new(o||t)(W.Qb(f.e),W.Qb(j.a),W.Qb(d.a))},t.\u0275cmp=W.Kb({type:t,selectors:[["app-notification-form"]],outputs:{formSubmit:"formSubmit",formEditSave:"formEditSave",formClose:"formClose"},decls:63,vars:9,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title","capitalize"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12"],[1,"full-width","p-mt-2"],["tabindex","1","formControlName","options",3,"selectionChange"],["value","a"],[1,"capitalize"],["value","r"],["value","l"],["tabindex","1","formControlName","columns","placeholder","choose rows want to edit","multiple","","required","",3,"value"],[3,"value",4,"ngFor","ngForOf"],[1,"full-width"],["matInput","","tabindex","0","type","text","value","","formControlName","amharic_names",3,"blur"],["class","error",4,"ngIf"],["matInput","","tabindex","0","type","text","value","","formControlName","station_names",3,"blur","input","keydown"],["matInput","","tabindex","0","type","text","value","","formControlName","longitude",3,"blur","input","keydown"],["matInput","","tabindex","0","type","text","value","","formControlName","latitude",3,"blur","input","keydown"],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"],[3,"value"],[1,"error"]],template:function(t,o){1&t&&(W.Wb(0,"form",0),W.ec("submit",function(){return o.onSubmit()}),W.Wb(1,"div",1),W.Wb(2,"div",2),W.Wb(3,"b"),W.Qc(4),W.Vb(),W.Vb(),W.Wb(5,"button",3),W.ec("click",function(){return o.onCancel()}),W.Vb(),W.Vb(),W.Wb(6,"div",4),W.Wb(7,"div",5),W.Wb(8,"div",6),W.Wb(9,"mat-form-field",7),W.Wb(10,"mat-label"),W.Qc(11,"Direction"),W.Vb(),W.Wb(12,"mat-select",8),W.ec("selectionChange",function(t){return o.onColumnsChange(t)}),W.Wb(13,"mat-option",9),W.Wb(14,"span",10),W.Qc(15,"All"),W.Vb(),W.Vb(),W.Wb(16,"mat-option",11),W.Wb(17,"span",10),W.Qc(18,"Right"),W.Vb(),W.Vb(),W.Wb(19,"mat-option",12),W.Wb(20,"span",10),W.Qc(21,"Left"),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Wb(22,"div",6),W.Wb(23,"mat-form-field",7),W.Wb(24,"mat-label"),W.Qc(25,"Rows"),W.Vb(),W.Wb(26,"mat-select",13),W.Oc(27,Q,8,3,"mat-option",14),W.Vb(),W.Vb(),W.Vb(),W.Wb(28,"div",6),W.Wb(29,"mat-form-field",15),W.Wb(30,"mat-label"),W.Qc(31,"Amharic Names"),W.Vb(),W.Wb(32,"input",16),W.ec("blur",function(){return o.blur()}),W.Vb(),W.Oc(33,R,2,1,"mat-error",17),W.Vb(),W.Vb(),W.Wb(34,"div",6),W.Wb(35,"mat-form-field",15),W.Wb(36,"mat-label"),W.Qc(37,"Station Names"),W.Vb(),W.Wb(38,"input",18),W.ec("blur",function(){return o.blur()})("input",function(t){return o.keyDown(t,"text")})("keydown",function(t){return o.keyDown(t,"text")}),W.Vb(),W.Oc(39,N,2,1,"mat-error",17),W.Vb(),W.Vb(),W.Wb(40,"div",6),W.Wb(41,"mat-form-field",15),W.Wb(42,"mat-label"),W.Qc(43,"Longitude"),W.Vb(),W.Wb(44,"input",19),W.ec("blur",function(){return o.blur()})("input",function(t){return o.keyDown(t,"price")})("keydown",function(t){return o.keyDown(t,"price")}),W.Vb(),W.Oc(45,L,2,1,"mat-error",17),W.Vb(),W.Vb(),W.Wb(46,"div",6),W.Wb(47,"mat-form-field",15),W.Wb(48,"mat-label"),W.Qc(49,"Latitude"),W.Vb(),W.Wb(50,"input",20),W.ec("blur",function(){return o.blur()})("input",function(t){return o.keyDown(t,"price")})("keydown",function(t){return o.keyDown(t,"price")}),W.Vb(),W.Oc(51,G,2,1,"mat-error",17),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Wb(52,"div",21),W.Wb(53,"button",22),W.ec("click",function(){return o.onCancel()}),W.Rb(54,"span",23),W.Wb(55,"span",24),W.Qc(56,"Cancel"),W.Vb(),W.Rb(57,"span",25),W.Vb(),W.Wb(58,"button",26),W.Rb(59,"span",27),W.Wb(60,"span",24),W.Qc(61,"Save"),W.Vb(),W.Rb(62,"span",25),W.Vb(),W.Vb(),W.Vb()),2&t&&(W.oc("formGroup",o.form),W.Cb(4),W.Rc(o.config.title),W.Cb(22),W.oc("value",o.selectedColumns),W.Cb(1),W.oc("ngForOf",o.columns),W.Cb(6),W.oc("ngIf",o.displayMessage.title),W.Cb(6),W.oc("ngIf",o.displayMessage.title),W.Cb(6),W.oc("ngIf",o.displayMessage.title),W.Cb(6),W.oc("ngIf",o.displayMessage.title),W.Cb(7),W.oc("disabled",!o.form.valid))},directives:[f.x,f.q,f.h,d.g,m.b,p.a,d.e,c.c,c.g,s.a,f.p,f.f,M.h,f.v,C.l,u.b,f.c,C.m,d.c,c.b],styles:[""]}),t})();var E=e("sSZD"),P=e("I/3d");let A=(()=>{class t{constructor(t,o,e){this.db=t,this.firestore=o,this.fun=e,this.url="/Notification"}get(t=null){const o=""+this.url;return t?this.firestore.collection(o).doc(t):this.firestore.collection(o)}add(t,o=null){return delete t.id,this.firestore.collection(this.url).add(t).then(t=>{var e;null==o||o.ref.close(),null===(e=null==o?void 0:o.block)||void 0===e||e.stop()}).catch(t=>{var e;null===(e=null==o?void 0:o.block)||void 0===e||e.stop()})}update(t,o,e=null){return delete o.id,this.firestore.collection(this.url).doc(t).update(o).then(t=>{null==e||e.ref.close(),null==e||e.block.stop()}).catch(t=>{var o;null===(o=null==e?void 0:e.block)||void 0===o||o.stop()})}delete(t){return this.firestore.collection(this.url).doc(t).delete()}}return t.\u0275fac=function(o){return new(o||t)(W.ac(E.a),W.ac(P.a),W.ac(j.a))},t.\u0275prov=W.Mb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var F=e("WLRH");const T=[{path:"",component:(()=>{class t{constructor(t,o){this.notificationService=t,this.dialogServices=o,this.caption="GPS",this.isGrouped=!1,this.isGroupedCoords=!1,this.columns=[],this.selectedColumns=[],this.actions=[{icon:"pencil",color:"warning",disable:!1},{icon:"trash",color:"danger"}],this.toolBarActions=[{position:"right",action:[{label:"Group",icon:"th-large",color:"",tooltip:null}]},{position:"left",action:[{label:"Export",icon:"download",color:"",tooltip:null},{label:"Import",icon:"cloud-upload",color:"",tooltip:null}]}],this.notification$=[],this.ungroupedData=[],this.dialogConfigGps={width:"550px",formComponent:B},this.dialogConfig={width:"650px",formComponent:I},this.dialogConfigModal={closable:!0,formComponent:y.a},this.timer=t=>new Promise(o=>setTimeout(o,t))}ngOnInit(){this.columns=[{label:"Route No.",name:"route_no",sortable:!0},{label:"Position",name:"position",sortable:!0},{label:"Station Names",name:"station_names",sortable:!0},{label:"Amharic Names",name:"amharic_names",sortable:!0},{label:"Longitude",name:"longitude",sortable:!0},{label:"Latitude",name:"latitude",sortable:!0}]}add(){this.dialogConfig.title="GPS Data",this.dialogConfig.formData="",this.dialogConfig.lookupData={columns:["Route No.","Position","Station Names","Amharic Names","Longitude","Latitude"]};const t=this.dialogServices.handleDialog(this.dialogConfig);this.handleModalChange(t)}update(t){this.dialogConfigGps.title=t.amharic_names+" - "+t.station_names,this.dialogConfigGps.formData={amharic_names:t.amharic_names,latitude:t.latitude,longitude:t.longitude,station_names:t.station_names,data:t.items};const o=this.dialogServices.handleDialog(this.dialogConfigGps);this.handleModalChange(o)}onActionClick(t){var o;if("pencil"===t.type&&this.isGroupedCoords)this.update(t.data);else if("trash"===t.type)this.notification$=this.notification$.filter(o=>o!==t.data);else if("link"===t.type){let e,i="";this.isGroupedCoords&&!this.isGrouped?(i=t.data.amharic_names+" - "+t.data.station_names+" ("+t.data.latitude+","+t.data.longitude+")",e=t.data.items):(i=(null===(o=t.data)||void 0===o?void 0:o.route_no)+""+(null==t?void 0:t.position),e=t.data.data["left"===t.position.toLowerCase()?"l":"r"]),this.showModalTable(i,e)}}showModalTable(t,o){this.dialogConfigModal.width="800px",this.dialogConfigModal.lookupData={caption:t,columns:[{label:"Route No.",name:"route_no",sortable:!0},{label:"Position",name:"position",sortable:!0},{label:"Station Names",name:"station_names",sortable:!0},{label:"Amharic Names",name:"amharic_names",sortable:!0},{label:"Longitude",name:"longitude",sortable:!0},{label:"Latitude",name:"latitude",sortable:!0}],data:o,button:"Export",isSaveMultiple:!0};const e=this.dialogServices.handleDialog(this.dialogConfigModal);this.handleModalChange(e)}onToolBarActionClick(t){"cloud-upload"===t?this.add():"download"===t?this.notification$.length>0&&(this.isGrouped?this.download(this.notification$):this.jsonToCSV(this.ungroupedData)):"th-large"===t&&(this.isGrouped=!this.isGrouped,this.notification$=this.isGrouped?this.groupBy(this.ungroupedData):this.groupCoords(this.ungroupedData),this.columns=this.selectedColumns=this.isGrouped?[{label:"Route No.",name:"route_no",sortable:!0},{label:"Left",name:"left",type:"link",sortable:!0},{label:"Right",name:"right",type:"link",sortable:!0}]:this.isGroupedCoords?[{label:"amharic names",name:"amharic_names",sortable:!0},{label:"station names",name:"station_names",sortable:!0},{label:"longitude",name:"longitude",sortable:!0},{label:"latitude",name:"latitude",sortable:!0},{label:"count",name:"count",type:"link",sortable:!0}]:[{label:"Route No.",name:"route_no",sortable:!0},{label:"Position",name:"position",sortable:!0},{label:"Station Names",name:"station_names",sortable:!0},{label:"Amharic Names",name:"amharic_names",sortable:!0},{label:"Longitude",name:"longitude",sortable:!0},{label:"Latitude",name:"latitude",sortable:!0}])}download(t){return Object(V.__awaiter)(this,void 0,void 0,function*(){let o=0;for(const e of t)for(const t in e.data)if(Object.prototype.hasOwnProperty.call(e.data,t)){const i=e.route_no+t.toUpperCase();40===o?(yield this.timer(3e3),o=0):o++,this.jsonToCSV(e.data[t],i)}})}jsonToCSV(t,o="gps"){"gps"!==o&&(t=t.map(t=>{var o=Object(V.__rest)(t,["route_no","position"]);return Object.assign({},o)})),t=t.map(t=>{var o=Object(V.__rest)(t,["fileID","id"]);return Object.assign({},o)});const e=(t,o)=>null===o?"":o,i=Object.keys(t[0]),n=[i.join(","),...t.map(t=>i.map(o=>JSON.stringify(t[o],e)).join(","))].join("\r\n"),a=new Blob(["\ufeff"+n],{type:"text/csv;charset=utf-8;"}),l=URL.createObjectURL(a),s=document.createElement("a");s.href=l,s.download=(o||"gps")+".csv",s.click(),s.remove(),window.webkitURL.revokeObjectURL(l)}jsonToExcel(t,o=""){t=t.map(t=>{var o=Object(V.__rest)(t,["fileID"]);return Object.assign({},o)})}downloadJson(t,o=""){t=t.map(t=>{var o=Object(V.__rest)(t,["fileID"]);return Object.assign({},o)});const e="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(t)),i=document.createElement("a");i.href=e,i.id="download_id",i.download=(o||"gps")+".json",i.click(),i.remove()}groupBy(t){const o=[];return null==t||t.forEach(e=>{0===o.filter(t=>t.route_no===e.route_no).length&&o.push({route_no:e.route_no,left:null==t?void 0:t.filter(t=>{var o;return t.route_no===e.route_no&&"l"===(null===(o=t.position)||void 0===o?void 0:o.toLowerCase())}).length,right:null==t?void 0:t.filter(t=>{var o;return t.route_no===e.route_no&&"r"===(null===(o=t.position)||void 0===o?void 0:o.toLowerCase())}).length,items:null==t?void 0:t.filter(t=>t.route_no===e.route_no),data:{l:null==t?void 0:t.filter(t=>{var o;return t.route_no===e.route_no&&"l"===(null===(o=t.position)||void 0===o?void 0:o.toLowerCase())}),r:null==t?void 0:t.filter(t=>{var o;return t.route_no===e.route_no&&"r"===(null===(o=t.position)||void 0===o?void 0:o.toLowerCase())})}})}),this.selectedColumns=this.columns=[{label:"Route No.",name:"route_no",sortable:!0},{label:"Left",name:"left",type:"link",sortable:!0},{label:"Right",name:"right",type:"link",sortable:!0}],this.ungroupedData=t,o}groupCoords(t,o=3){this.isGroupedCoords=!0;const e=[...t.map(t=>Object.assign(Object.assign({},t),{latitude:parseFloat(t.latitude).toFixed(o),longitude:parseFloat(t.longitude).toFixed(o)})).reduce((t,o)=>{const e=o.latitude+"-"+o.longitude,i=t.get(e)||Object.assign({},o,{items:[]});return i.items.push(o),t.set(e,i)},new Map).values()].map(o=>{var e;return{amharic_names:o.amharic_names,station_names:o.station_names,latitude:o.latitude,longitude:o.longitude,count:o.items.length,items:null===(e=o.items)||void 0===e?void 0:e.map(o=>Object.assign(Object.assign({},o),{latitude:t.filter(t=>t.route_no===o.route_no&&t.position===o.position&&t.no===o.no)[0].latitude,longitude:t.filter(t=>t.route_no===o.route_no&&t.position===o.position&&t.no===o.no)[0].longitude}))}});return this.selectedColumns=this.columns=[{label:"amharic names",name:"amharic_names",sortable:!0},{label:"station names",name:"station_names",sortable:!0},{label:"longitude",name:"longitude",sortable:!0},{label:"latitude",name:"latitude",sortable:!0},{label:"count",name:"count",type:"link",sortable:!0}],this.ungroupedData=t,e}onColumnsChange(t){this.notification$!==[]&&(this.notification$=this.groupCoords(this.ungroupedData,t.value))}handleModalChange(t){var o,e,i,n,a,l;null===(e=null===(o=t.componentInstance)||void 0===o?void 0:o.formImport)||void 0===e||e.subscribe(o=>{let e=0;const i=this.ungroupedData;i.push(...o);const n=i.filter((t,o,e)=>o===e.findIndex(o=>o.amharic_names===t.amharic_names&&o.station_names===t.station_names&&o.route_no===t.route_no&&o.position===t.position)).map(t=>(e++,Object.assign(Object.assign({},t),{id:e})));console.log(n),this.notification$=this.isGrouped?this.groupBy(n):this.groupCoords(n),t.close()}),null===(n=null===(i=t.componentInstance)||void 0===i?void 0:i.formSave)||void 0===n||n.subscribe(t=>{}),null===(l=null===(a=t.componentInstance)||void 0===a?void 0:a.formEditSave)||void 0===l||l.subscribe(o=>{const e={amharic_names:o.amharic_names||null,station_names:o.station_names||null,latitude:o.latitude||null,longitude:o.longitude||null},i=Object.keys(e).filter(t=>null!=e[t]).reduce((t,o)=>Object.assign(Object.assign({},t),{[o]:e[o]}),{});null==o||o.columns.forEach(t=>{this.ungroupedData=this.ungroupedData.map(o=>o.id===t.value?Object.assign(Object.assign({},o),i):o)}),this.notification$=this.groupCoords(this.ungroupedData),t.close()})}}return t.\u0275fac=function(o){return new(o||t)(W.Qb(A),W.Qb(O.a))},t.\u0275cmp=W.Kb({type:t,selectors:[["app-notification"]],decls:20,vars:10,consts:[[1,"p-mt-2"],["tabindex","1",3,"value","selectionChange"],["value","2"],[1,"capitalize"],["value","3"],["value","4"],["value","5"],["value","6"],[3,"caption","columns","selectedColumns","data","actions","first","rows","sortBy","toolBarActions","buttonClick","toolBarButtonClick"]],template:function(t,o){1&t&&(W.Wb(0,"mat-form-field",0),W.Wb(1,"mat-label"),W.Qc(2,"Rounding"),W.Vb(),W.Wb(3,"mat-select",1),W.ec("selectionChange",function(t){return o.onColumnsChange(t)}),W.Wb(4,"mat-option",2),W.Wb(5,"span",3),W.Qc(6,"2"),W.Vb(),W.Vb(),W.Wb(7,"mat-option",4),W.Wb(8,"span",3),W.Qc(9,"3"),W.Vb(),W.Vb(),W.Wb(10,"mat-option",5),W.Wb(11,"span",3),W.Qc(12,"4"),W.Vb(),W.Vb(),W.Wb(13,"mat-option",6),W.Wb(14,"span",3),W.Qc(15,"5"),W.Vb(),W.Vb(),W.Wb(16,"mat-option",7),W.Wb(17,"span",3),W.Qc(18,"6"),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Wb(19,"app-table-template",8),W.ec("buttonClick",function(t){return o.onActionClick(t)})("toolBarButtonClick",function(t){return o.onToolBarActionClick(t)}),W.Vb()),2&t&&(W.Cb(3),W.oc("value","3"),W.Cb(16),W.oc("caption",o.caption)("columns",o.columns)("selectedColumns",o.selectedColumns)("data",o.notification$)("actions",o.actions)("first",(null==o.currentPage?null:o.currentPage.first)||0)("rows",(null==o.currentPage?null:o.currentPage.rows)||10)("sortBy",o.sortBy)("toolBarActions",o.toolBarActions))},directives:[c.c,c.g,s.a,M.h,F.a],styles:[""]}),Object(V.__decorate)([Object(k.a)()],t.prototype,"blockUI",void 0),t})()},{path:"**",redirectTo:""}];let U=(()=>{class t{}return t.\u0275mod=W.Ob({type:t}),t.\u0275inj=W.Nb({factory:function(o){return new(o||t)},imports:[[w.e.forChild(T)],w.e]}),t})(),$=(()=>{class t{}return t.\u0275mod=W.Ob({type:t}),t.\u0275inj=W.Nb({factory:function(o){return new(o||t)},imports:[[C.c,U,v.a,g.f,f.j,f.u,h.b,m.c,_.a,p.b,b.a,d.f,c.e,u.c,r.a,s.b,l.b,a.a,n.a,i.a]]}),t})()}}]);