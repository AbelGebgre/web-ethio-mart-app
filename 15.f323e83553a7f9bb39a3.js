(window.webpackJsonp=window.webpackJsonp||[]).push([[15],{MYyV:function(e,t,i){"use strict";i.r(t),i.d(t,"ParkingModule",function(){return oe});var a=i("5EWq"),o=i("Xa2L"),n=i("/1cH"),r=i("iadO"),l=i("1jcm"),s=i("d3UM"),c=i("NFeN"),d=i("qFsG"),u=i("kmnG"),b=i("0IaG"),p=i("V5BG"),m=i("Q4Mo"),h=i("jIHw"),f=i("7kUa"),g=i("3Pt+"),v=i("rEr+"),C=i("PCNd"),D=i("n1FK"),y=i("ofXK"),k=i("mrSG"),V=i("LRne"),W=i("7+5H"),w=i("nnAt"),I=i("fXoL"),M=i("otk6"),Q=i("FKr1");function x(e,t){if(1&e&&(I.Wb(0,"mat-error",8),I.Qc(1),I.Vb()),2&e){const e=I.hc();I.Cb(1),I.Rc(e.displayMessage.price)}}let S=(()=>{class e{constructor(e,t,i,a){var o,n,r,l,s,c;this.fb=e,this.fun=t,this.dateAdapter=i,this.config=a,this.formSubmit=new I.o,this.formSave=new I.o,this.formClose=new I.o,this.isUpdate=!1,this.displayMessage={},this.dateAdapter.setLocale("en-GB"),this.isUpdate=!!(null===(o=this.config.formData)||void 0===o?void 0:o.price),this.day=(null===(n=this.config.formData)||void 0===n?void 0:n.day)||new Date,this.min=new Date(new Date(this.day).setHours(0,0,0,0)),this.max=new Date(new Date(this.day).setHours(23,59,59,59)),this.form=this.fb.group({id:null===(r=this.config.formData)||void 0===r?void 0:r.id,price:[null===(l=this.config.formData)||void 0===l?void 0:l.price,g.x.required],time:(null===(s=this.config.formData)||void 0===s?void 0:s.time)||this.day,place:null===(c=this.config.formData)||void 0===c?void 0:c.place}),this.validationMessages={price:{required:"field is required."}},this.genericValidator=new w.a(this.validationMessages)}ngOnInit(){this.form.valueChanges.subscribe(()=>this.displayMessage=this.genericValidator.processMessages(this.form))}blur(){this.displayMessage=this.genericValidator.processMessages(this.form)}keyDown(e,t){return e.key?this.fun.allowedKey(e.key,t):(e.target.value=this.fun.removeNotAllowedKey(e.target.value,t),!0)}getFile(e){this.form.controls.image.setValue((null==e?void 0:e.upload.length)>0?null==e?void 0:e.upload:[])}onSubmit(){this.formSave.emit({data:this.form.value,update:this.isUpdate})}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(I.Qb(g.e),I.Qb(M.a),I.Qb(Q.a),I.Qb(b.a))},e.\u0275cmp=I.Kb({type:e,selectors:[["app-parking-prices"]],outputs:{formSubmit:"formSubmit",formSave:"formSave",formClose:"formClose"},decls:39,vars:13,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title","capitalize"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12","p-md-6"],[1,"full-width"],[1,"error"],["matInput","","tabindex","0","type","text","value","","formControlName","price",3,"blur","input","keydown"],["class","error",4,"ngIf"],["matInput","","formControlName","time","readonly","",3,"ngxMatDatetimePicker","min","max"],["matSuffix","",3,"for"],[3,"showSeconds","stepHour","stepMinute","stepSecond","enableMeridian"],["picker",""],[1,"p-col-12"],["matInput","","tabindex","0","type","text","value","","formControlName","place",3,"blur","input","keydown"],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"]],template:function(e,t){if(1&e&&(I.Wb(0,"form",0),I.ec("submit",function(){return t.onSubmit()}),I.Wb(1,"div",1),I.Wb(2,"div",2),I.Qc(3),I.Vb(),I.Wb(4,"button",3),I.ec("click",function(){return t.onCancel()}),I.Vb(),I.Vb(),I.Wb(5,"div",4),I.Wb(6,"div",5),I.Wb(7,"div",6),I.Wb(8,"mat-form-field",7),I.Wb(9,"mat-label"),I.Qc(10,"Price"),I.Wb(11,"span",8),I.Qc(12,"*"),I.Vb(),I.Vb(),I.Wb(13,"input",9),I.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"price")})("keydown",function(e){return t.keyDown(e,"price")}),I.Vb(),I.Oc(14,x,2,1,"mat-error",10),I.Vb(),I.Vb(),I.Wb(15,"div",6),I.Wb(16,"mat-form-field",7),I.Wb(17,"mat-label"),I.Qc(18,"Time"),I.Vb(),I.Rb(19,"input",11),I.Rb(20,"mat-datepicker-toggle",12),I.Rb(21,"ngx-mat-datetime-picker",13,14),I.Vb(),I.Vb(),I.Wb(23,"div",15),I.Wb(24,"mat-form-field",7),I.Wb(25,"mat-label"),I.Qc(26,"Place"),I.Vb(),I.Wb(27,"textarea",16),I.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"text")})("keydown",function(e){return t.keyDown(e,"text")}),I.Vb(),I.Vb(),I.Vb(),I.Vb(),I.Vb(),I.Wb(28,"div",17),I.Wb(29,"button",18),I.ec("click",function(){return t.onCancel()}),I.Rb(30,"span",19),I.Wb(31,"span",20),I.Qc(32,"Cancel"),I.Vb(),I.Rb(33,"span",21),I.Vb(),I.Wb(34,"button",22),I.Rb(35,"span",23),I.Wb(36,"span",20),I.Qc(37,"Save"),I.Vb(),I.Rb(38,"span",21),I.Vb(),I.Vb(),I.Vb()),2&e){const e=I.Bc(22);I.oc("formGroup",t.form),I.Cb(3),I.Rc(t.config.title),I.Cb(11),I.oc("ngIf",t.displayMessage.price),I.Cb(5),I.oc("ngxMatDatetimePicker",e)("min",t.min)("max",t.max),I.Cb(1),I.oc("for",e),I.Cb(1),I.oc("showSeconds",!0)("stepHour",1)("stepMinute",1)("stepSecond",1)("enableMeridian",!0),I.Cb(13),I.oc("disabled",!t.form.valid)}},directives:[g.y,g.r,g.i,b.g,h.b,m.a,b.e,u.c,u.g,d.b,g.c,g.q,g.g,y.m,D.a,r.j,u.h,D.b,b.c,u.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}"]}),e})();var O=i("4ZtF"),N=i("12jx"),B=i("/vft"),P=i("H28f"),R=i("H0VJ"),j=i("WLRH"),A=i("xivw");function q(e,t){if(1&e&&(I.Wb(0,"mat-error",8),I.Qc(1),I.Vb()),2&e){const e=I.hc();I.Cb(1),I.Sc("",e.displayMessage.date," ")}}function $(e,t){if(1&e&&(I.Wb(0,"mat-error",8),I.Qc(1),I.Vb()),2&e){const e=I.hc();I.Cb(1),I.Sc("",e.displayMessage.price," ")}}function G(e,t){if(1&e&&(I.Wb(0,"mat-option",31),I.Wb(1,"span",32),I.Wb(2,"b"),I.Qc(3),I.Vb(),I.Vb(),I.Rb(4,"br"),I.Wb(5,"small",32),I.Qc(6),I.Vb(),I.Rb(7,"br"),I.Vb()),2&e){const e=t.$implicit;I.oc("value",e.id),I.Cb(3),I.Rc(e.plateNo),I.Cb(3),I.Rc(" "+e.brand+" - "+e.model)}}function F(e,t){if(1&e&&(I.Wb(0,"mat-error",8),I.Qc(1),I.Vb()),2&e){const e=I.hc();I.Cb(1),I.Rc(e.displayMessage.carID)}}function Y(e,t){if(1&e&&(I.Wb(0,"mat-option",31),I.Wb(1,"span",32),I.Qc(2),I.Vb(),I.Vb()),2&e){const e=t.$implicit;I.oc("value",e.id),I.Cb(2),I.Rc(e.name)}}function _(e,t){if(1&e&&(I.Wb(0,"mat-error",8),I.Qc(1),I.Vb()),2&e){const e=I.hc();I.Cb(1),I.Rc(e.displayMessage.driverID)}}const E=function(){return[]};let L=(()=>{class e{constructor(e,t,i,a,o,n,r){var l,s,c,d,u,b,p,m,h,f,v,C,D,y,k,V,W,M,Q,x;this.fb=e,this.fun=t,this.fieldsQuery=i,this.fieldService=a,this.dialogServices=o,this.dateAdapter=n,this.config=r,this.formSubmit=new I.o,this.formClose=new I.o,this.drivers=[],this.cars=[],this.columns=["time","place","price"],this.actions=[{icon:"pencil",color:"warning",disable:!1},{icon:"trash",color:"danger"}],this.isPublished=!0,this.prices=[],this.prices$=this.fieldsQuery.selectAll(),this.dialogConfig={width:"450px",formComponent:S},this.displayMessage={},this.dateAdapter.setLocale("en-GB"),this.image=Object(O.k)(null===(l=this.config.formData)||void 0===l?void 0:l.image)?null===(s=this.config.formData)||void 0===s?void 0:s.image:Object(O.p)(null===(c=this.config.formData)||void 0===c?void 0:c.image)?[null===(d=this.config.formData)||void 0===d?void 0:d.image]:Object(O.q)(null===(u=this.config.formData)||void 0===u?void 0:u.image)?[null===(b=this.config.formData)||void 0===b?void 0:b.image]:[],null===(m=null===(p=this.config.lookupData)||void 0===p?void 0:p.drivers)||void 0===m||m.subscribe(e=>{this.drivers=this.fun.extractData(e)}),null===(f=null===(h=this.config.lookupData)||void 0===h?void 0:h.cars)||void 0===f||f.subscribe(e=>{this.cars=this.fun.extractData(e)}),this.prices=(null===(v=this.config.formData)||void 0===v?void 0:v.prices)||[],this.fieldService.set(this.prices),this.isPublished=void 0===(null===(C=this.config.formData)||void 0===C?void 0:C.status)||(null===(D=this.config.formData)||void 0===D?void 0:D.status),this.form=this.fb.group({id:null===(y=this.config.formData)||void 0===y?void 0:y.id,date:[(null===(k=this.config.formData)||void 0===k?void 0:k.date)?new Date(null===(V=this.config.formData)||void 0===V?void 0:V.date):(new Date).toISOString(),[g.x.required,g.x.maxLength]],price:[null===(W=this.config.formData)||void 0===W?void 0:W.price,g.x.required],prices:this.prices,driverID:[null===(M=this.config.formData)||void 0===M?void 0:M.driverID,g.x.required],carID:[null===(Q=this.config.formData)||void 0===Q?void 0:Q.carID,g.x.required],image:this.image,created_at:null===(x=this.config.formData)||void 0===x?void 0:x.created_at}),this.validationMessages={driverID:{required:"field is required."},date:{required:"field is required.",maxLength:"date can't be pass current date"},price:{required:"field is required."},carID:{required:"field is required."}},this.genericValidator=new w.a(this.validationMessages)}ngOnInit(){this.prices$.subscribe(e=>{this.prices=e,e.length>0?(this.form.controls.price.patchValue(this.fun.sumObjArr(this.prices,"price")||null),this.form.controls.prices.patchValue(this.prices)):this.form.controls.price.patchValue(null)}),this.columns=this.fun.getColumns(this.columns),this.today=new Date,this.form.valueChanges.subscribe(()=>this.displayMessage=this.genericValidator.processMessages(this.form))}add(){var e;this.dialogConfig.title="New Parking Price",this.dialogConfig.formData={id:this.prices.length+1,day:null===(e=this.form.value)||void 0===e?void 0:e.date};const t=this.dialogServices.handleDialog(this.dialogConfig);this.handleModalChange(t)}update(e){var t;this.dialogConfig.title="Edit Parking Price",this.dialogConfig.formData=Object.assign(Object.assign({},e),{day:null===(t=this.form.value)||void 0===t?void 0:t.date});const i=this.dialogServices.handleDialog(this.dialogConfig);this.handleModalChange(i)}handleModalChange(e){var t;null===(t=e.componentInstance)||void 0===t||t.formSave.subscribe(t=>{var i;t.update?this.fieldService.update(t.data):(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.price)&&this.fieldService.add(t.data),e.close()})}blur(){this.displayMessage=this.genericValidator.processMessages(this.form)}keyDown(e,t){return e.key?this.fun.allowedKey(e.key,t):(e.target.value=this.fun.removeNotAllowedKey(e.target.value,t),!0)}onClick(){this.add()}onActionClick(e){"pencil"===e.type?this.update(e.data):"trash"===e.type&&(this.prices=this.prices.filter(t=>t.id!==e.data.id),this.fieldService.delete(e.data.id))}onChange(e,t="car"){var i,a;if("car"===t){const t=null===(i=this.cars.filter(t=>t.id===e.value)[0])||void 0===i?void 0:i.driverID;this.form.controls.driverID.patchValue(t||null)}else{const t=null===(a=this.cars.filter(t=>t.driverID===e.value)[0])||void 0===a?void 0:a.id;null===this.form.value.carID&&this.form.controls.carID.patchValue(t||null)}}setValidation(e=null){this.form.controls.plateNo.setErrors({found:!0}),this.displayMessage=this.genericValidator.processMessages(this.form)}getFile(e){this.form.controls.image.setValue((null==e?void 0:e.upload.length)>0?null==e?void 0:e.upload:[])}onSubmit(){var e,t,i;const a=this.form.value,o=null===(e=this.drivers)||void 0===e?void 0:e.filter(e=>e.id===a.driverID)[0],n=null===(t=this.cars)||void 0===t?void 0:t.filter(e=>e.id===a.carID)[0],r=(null==a?void 0:a.date)?new Date(null==a?void 0:a.date):null,l=Object.assign(Object.assign({},a),{driverName:null===(i=null==o?void 0:o.name)||void 0===i?void 0:i.split(" ")[0],plateNo:null==n?void 0:n.plateNo,prices:this.prices,date:r});this.formSubmit.emit(l)}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(I.Qb(g.e),I.Qb(M.a),I.Qb(B.a),I.Qb(P.a),I.Qb(R.a),I.Qb(Q.a),I.Qb(b.a))},e.\u0275cmp=I.Kb({type:e,selectors:[["app-parking-form"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:68,vars:27,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title","capitalize"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12","p-md-6"],[1,"full-width"],[1,"error"],["matInput","","formControlName","date",3,"matDatepicker","max","blur"],["matSuffix","",3,"for"],["dp3",""],["class","error",4,"ngIf"],["readonly","","matInput","","tabindex","0","type","text","value","","formControlName","price",3,"blur","input","keydown"],["price",""],["placeholder","choose car","formControlName","carID",3,"selectionChange","closed"],[3,"value",4,"ngFor","ngForOf"],["placeholder","choose driver","formControlName","driverID",3,"selectionChange","closed"],[1,"p-col-12"],[1,"buttons"],["pButton","","pRipple","","type","button","label","Add Price",3,"disabled","icon","click"],[3,"columns","data","isInModal","hasOrder","actions","toolBarActions","buttonClick"],[3,"uploadedFile","limit","fileDropped"],["fileImage",""],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"],[3,"value"],[1,"capitalize"]],template:function(e,t){if(1&e&&(I.Wb(0,"form",0),I.ec("submit",function(){return t.onSubmit()}),I.Wb(1,"div",1),I.Wb(2,"div",2),I.Qc(3),I.Vb(),I.Wb(4,"button",3),I.ec("click",function(){return t.onCancel()}),I.Vb(),I.Vb(),I.Wb(5,"div",4),I.Wb(6,"div",5),I.Wb(7,"div",6),I.Wb(8,"mat-form-field",7),I.Wb(9,"mat-label"),I.Qc(10,"Date"),I.Wb(11,"span",8),I.Qc(12,"*"),I.Vb(),I.Vb(),I.Wb(13,"input",9),I.ec("blur",function(){return t.blur()}),I.Vb(),I.Wb(14,"mat-hint"),I.Qc(15,"MM/DD/YYYY"),I.Vb(),I.Rb(16,"mat-datepicker-toggle",10),I.Rb(17,"mat-datepicker",null,11),I.Oc(19,q,2,1,"mat-error",12),I.Vb(),I.Vb(),I.Wb(20,"div",6),I.Wb(21,"mat-form-field",7),I.Wb(22,"mat-label"),I.Qc(23,"Price"),I.Wb(24,"span",8),I.Qc(25,"*"),I.Vb(),I.Vb(),I.Wb(26,"input",13,14),I.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"price")})("keydown",function(e){return t.keyDown(e,"price")}),I.Vb(),I.Oc(28,$,2,1,"mat-error",12),I.Vb(),I.Vb(),I.Wb(29,"div",6),I.Wb(30,"mat-form-field",7),I.Wb(31,"mat-label"),I.Qc(32,"Car"),I.Wb(33,"span",8),I.Qc(34,"*"),I.Vb(),I.Vb(),I.Wb(35,"mat-select",15),I.ec("selectionChange",function(e){return t.onChange(e,"car")})("closed",function(){return t.blur()}),I.Oc(36,G,8,3,"mat-option",16),I.Vb(),I.Oc(37,F,2,1,"mat-error",12),I.Vb(),I.Vb(),I.Wb(38,"div",6),I.Wb(39,"mat-form-field",7),I.Wb(40,"mat-label"),I.Qc(41,"Driver"),I.Wb(42,"span",8),I.Qc(43,"*"),I.Vb(),I.Vb(),I.Wb(44,"mat-select",17),I.ec("selectionChange",function(e){return t.onChange(e,"driver")})("closed",function(){return t.blur()}),I.Oc(45,Y,3,2,"mat-option",16),I.Vb(),I.Oc(46,_,2,1,"mat-error",12),I.Vb(),I.Vb(),I.Wb(47,"div",18),I.Wb(48,"div",7),I.Wb(49,"div",19),I.Wb(50,"button",20),I.ec("click",function(){return t.onClick()}),I.Vb(),I.Vb(),I.Wb(51,"app-table-template",21),I.ec("buttonClick",function(e){return t.onActionClick(e)}),I.ic(52,"async"),I.Vb(),I.Vb(),I.Vb(),I.Wb(53,"div",18),I.Wb(54,"div",7),I.Wb(55,"app-file-upload-template",22,23),I.ec("fileDropped",function(e){return t.getFile(e)}),I.Vb(),I.Vb(),I.Vb(),I.Vb(),I.Vb(),I.Wb(57,"div",24),I.Wb(58,"button",25),I.ec("click",function(){return t.onCancel()}),I.Rb(59,"span",26),I.Wb(60,"span",27),I.Qc(61,"Cancel"),I.Vb(),I.Rb(62,"span",28),I.Vb(),I.Wb(63,"button",29),I.Rb(64,"span",30),I.Wb(65,"span",27),I.Qc(66,"Save"),I.Vb(),I.Rb(67,"span",28),I.Vb(),I.Vb(),I.Vb()),2&e){const e=I.Bc(18);I.oc("formGroup",t.form),I.Cb(3),I.Rc(t.config.title),I.Cb(10),I.oc("matDatepicker",e)("max",t.today),I.Cb(3),I.oc("for",e),I.Cb(3),I.oc("ngIf",t.displayMessage.date),I.Cb(9),I.oc("ngIf",t.displayMessage.price),I.Cb(8),I.oc("ngForOf",t.cars),I.Cb(1),I.oc("ngIf",t.displayMessage.carID),I.Cb(8),I.oc("ngForOf",t.drivers),I.Cb(1),I.oc("ngIf",t.displayMessage.driverID),I.Cb(4),I.Eb("p-button-sm shadow-none p-mr-2"),I.oc("disabled",!(null!=t.form&&null!=t.form.value&&t.form.value.date))("icon","pi pi-plus"),I.Cb(1),I.oc("columns",t.columns)("data",I.jc(52,24,t.prices$))("isInModal",!0)("hasOrder",!1)("actions",t.actions)("toolBarActions",I.rc(26,E)),I.Cb(4),I.oc("uploadedFile",t.image)("limit",10),I.Cb(8),I.oc("disabled",!t.form.valid)}},directives:[g.y,g.r,g.i,b.g,h.b,m.a,b.e,u.c,u.g,d.b,g.c,r.g,g.q,g.g,u.f,r.j,u.h,r.f,y.m,s.a,y.l,j.a,A.a,b.c,u.b,Q.i],pipes:[y.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:flex-end}"],changeDetection:0}),Object(k.__decorate)([Object(N.a)()],e.prototype,"blockUI",void 0),e})();var U=i("wd/R"),H=i("DYbl"),K=i("/zas"),T=i("SRE/"),z=i("uNiC"),J=i("sSZD");function X(e,t){1&e&&(I.Wb(0,"mat-error"),I.Qc(1,"Invalid start date"),I.Vb())}function Z(e,t){1&e&&(I.Wb(0,"mat-error"),I.Qc(1,"Invalid end date"),I.Vb())}let ee=(()=>{class e{constructor(e,t,i,a,o,n,r,l){this.carService=e,this.sessionQuery=t,this.userService=i,this.parkingService=a,this.dialogServices=o,this.dateAdapter=n,this.db=r,this.fun=l,this.caption="Parking",this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"link",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],this.actions=[{icon:"pencil",color:"warning",disable:!1},{icon:"trash",color:"danger"}],this.toolBarActions=[{position:"right",action:[]},{position:"left",action:[{label:"Create",icon:"plus",color:"",tooltip:null}]}],this.dates=["monday","tuesday"],this.range=new g.h({start:new g.f(null),end:new g.f(null)}),this.today=new Date,this.duration="day",this.groupedBy=[],this.user$=this.sessionQuery.select(e=>e.user),this.dialogConfig={width:"600px",formComponent:L,service:this.parkingService},this.dialogConfigModal={closable:!0,formComponent:W.a}}ngOnInit(){let e,t;this.user$.subscribe(e=>{this.role=null==e?void 0:e.role,"supervisor"===(null==e?void 0:e.role)&&(this.actions=[],this.toolBarActions=[])}),this.dateAdapter.setLocale("en-GB"),this.onColumnsChange({value:this.duration}),this.onDateChange(),this.cars$=e=this.carService.get(!0).snapshotChanges(),e.subscribe(e=>this.cars=this.fun.extractData(e)),this.users$=t=this.userService.get("driver").snapshotChanges(),t.subscribe(e=>this.users=this.fun.extractData(e))}add(){this.dialogConfig.title="New Parking",this.dialogConfig.formData="",this.dialogConfig.lookupData={drivers:this.users$,cars:this.cars$},this.dialogServices.handleDialog(this.dialogConfig)}update(e){this.dialogConfig.title="Edit Parking Info",this.dialogConfig.formData=e,this.dialogConfig.lookupData={drivers:this.users$,cars:this.cars$},this.dialogServices.handleDialog(this.dialogConfig)}getChangedData(){var e;(null===(e=this.range.value)||void 0===e?void 0:e.end)&&(this.parking$=this.onDateChange())}onDateChange(){var e;if(null===(e=this.range.value)||void 0===e?void 0:e.end){let e;this.blockUI.start("Loading...");const{start:t,end:i}=this.range.value,a=U(t).subtract(1,"day").toDate();return e=this.data=this.parkingService.fitch({start:a,end:i}).snapshotChanges(),e.subscribe(e=>{this.parking=this.fun.extractData(e),this.blockUI.stop(),this.onGroupedByChange({value:this.groupedBy})}),e}}onGroupedByChange(e){var t;if((null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0){let t=this.parking;const i=this.fun.groupedBy(t,e.value);if(0===(null==i?void 0:i.length))return;t=i.map(e=>{var t;return{driverName:e.driverName,driverID:e.driverID,plateNo:e.plateNo,date:e.date,carID:e.carID,price:this.fun.sumObjArr(null==e?void 0:e.items,"price"),count:null===(t=e.items)||void 0===t?void 0:t.length,items:e.items}}),this.parking$=Object(V.a)(t),this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Parkings",name:"count",type:"link",sortable:!0}],this.actions=[]}else this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"link",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],this.parking$=this.data,this.actions=[{icon:"pencil",color:"warning",disable:!1},{icon:"trash",color:"danger"}]}onColumnsChange(e){if("isoWeek"===e.value||"month"===e.value||"day"===e.value){let t,i;const a=U().format("dddd").toLowerCase();i=this.dates.includes(a)&&"isoWeek"===e.value?U().subtract(1,"weeks").startOf("isoWeek").toDate():U().startOf(e.value).toDate(),t=U().endOf(e.value).toDate(),t=t>new Date?new Date:t,this.range.controls.start.patchValue(i),this.range.controls.end.patchValue(t)}}onActionClick(e){var t;if("pencil"===e.type)this.update(e.data);else if("trash"===e.type)this.blockUI.start("Deleting..."),this.parkingService.delete(e.data.id).then(this.blockUI.stop());else if("link"===e.type)if("driverName"===e.position)this.users$.subscribe(t=>{const i=this.fun.extractData(t).filter(t=>{var i;return(null==t?void 0:t.id)===(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.driverID)}).map(e=>{var{name:t,phone:i,email:a,image:o,role:n}=e;return Object(k.__rest)(e,["name","phone","email","image","role"]),{name:t,phone:i,email:a,image:o,role:n}});if(i.length>0){const e=Object.keys(i[0]),t=this.fun.getColumns(e);this.showModalTable("Driver Info",t,i)}});else if("plateNo"===e.position)this.cars$.subscribe(t=>{const i=this.fun.extractData(t).filter(t=>{var i;return(null==t?void 0:t.id)===(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.carID)}).map(e=>{var{plateNo:t,brand:i,model:a,driverName:o,image:n,status:r,company:l}=e;return Object(k.__rest)(e,["plateNo","brand","model","driverName","image","status","company"]),{plateNo:t,brand:i,model:a,driverName:o,image:n,status:r,company:l}});if(i.length>0){const e=Object.keys(i[0]),t=this.fun.getColumns(e);this.showModalTable("Car Info",t,i)}});else if("count"===e.position)this.showModalTable("Parking",[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],e.data.items);else if("price"===e.position){const i=this.fun.getColumns(["time","place","price"]);this.showModalTable("Prices",i,null===(t=e.data)||void 0===t?void 0:t.prices)}}showModalTable(e,t,i,a="1000px"){this.dialogConfigModal.width=a,this.dialogConfigModal.lookupData={caption:e,columns:t,data:i},this.dialogServices.handleDialog(this.dialogConfigModal)}onToolBarActionClick(e){"plus"===e&&this.add()}}return e.\u0275fac=function(t){return new(t||e)(I.Qb(H.a),I.Qb(K.a),I.Qb(T.a),I.Qb(z.a),I.Qb(R.a),I.Qb(Q.a),I.Qb(J.a),I.Qb(M.a))},e.\u0275cmp=I.Kb({type:e,selectors:[["app-parking"]],decls:40,vars:19,consts:[[1,"card"],[1,"p-toolbar-group-left"],[1,"p-mr-3"],[3,"value","valueChange","selectionChange"],["value","day"],["value","isoWeek"],["value","month"],[1,"p-ml-3"],["multiple","",3,"value","valueChange","selectionChange"],["value","driverID"],["value","carID"],["value","date"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date",3,"ngModelChange"],["matSuffix","",3,"for"],["openOnFocus","true","timeInterval","5"],["picker",""],[4,"ngIf"],["id","componentID"],[3,"caption","columns","data","actions","selectedColumns","first","rows","sortBy","toolBarActions","buttonClick","toolBarButtonClick"]],template:function(e,t){if(1&e&&(I.Wb(0,"div",0),I.Wb(1,"p-toolbar"),I.Wb(2,"div",1),I.Wb(3,"mat-form-field",2),I.Wb(4,"mat-label"),I.Qc(5,"Duration"),I.Vb(),I.Wb(6,"mat-select",3),I.ec("valueChange",function(e){return t.duration=e})("selectionChange",function(e){return t.onColumnsChange(e)}),I.Wb(7,"mat-option",4),I.Qc(8,"Daily"),I.Vb(),I.Wb(9,"mat-option",5),I.Qc(10,"Weekly"),I.Vb(),I.Wb(11,"mat-option",6),I.Qc(12,"Monthly"),I.Vb(),I.Vb(),I.Vb(),I.Wb(13,"mat-form-field",7),I.Wb(14,"mat-label"),I.Qc(15,"Grouped By"),I.Vb(),I.Wb(16,"mat-select",8),I.ec("valueChange",function(e){return t.groupedBy=e})("selectionChange",function(e){return t.onGroupedByChange(e)}),I.Wb(17,"mat-option",9),I.Qc(18,"Driver"),I.Vb(),I.Wb(19,"mat-option",10),I.Qc(20,"Car"),I.Vb(),I.Wb(21,"mat-option",11),I.Qc(22,"Date"),I.Vb(),I.Vb(),I.Vb(),I.Vb(),I.Wb(23,"div",1),I.Wb(24,"mat-form-field"),I.Wb(25,"mat-label"),I.Qc(26,"Enter a date range"),I.Vb(),I.Wb(27,"mat-date-range-input",12),I.Rb(28,"input",13),I.Wb(29,"input",14),I.ec("ngModelChange",function(){return t.getChangedData()}),I.Vb(),I.Vb(),I.Wb(30,"mat-hint"),I.Qc(31,"DD/MM/YYYY \u2013 DD/MM/YYYY"),I.Vb(),I.Rb(32,"mat-datepicker-toggle",15),I.Rb(33,"mat-date-range-picker",16,17),I.Oc(35,X,2,0,"mat-error",18),I.Oc(36,Z,2,0,"mat-error",18),I.Vb(),I.Vb(),I.Vb(),I.Vb(),I.Wb(37,"div",19),I.Wb(38,"app-table-template",20),I.ec("buttonClick",function(e){return t.onActionClick(e)})("toolBarButtonClick",function(e){return t.onToolBarActionClick(e)}),I.ic(39,"async"),I.Vb(),I.Vb()),2&e){const e=I.Bc(34);I.Cb(6),I.oc("value",t.duration),I.Cb(10),I.oc("value",t.groupedBy),I.Cb(11),I.oc("formGroup",t.range)("rangePicker",e)("max",t.today),I.Cb(5),I.oc("for",e),I.Cb(3),I.oc("ngIf",t.range.controls.start.hasError("matStartDateInvalid")),I.Cb(1),I.oc("ngIf",t.range.controls.end.hasError("matEndDateInvalid")),I.Cb(2),I.oc("caption",t.caption)("columns",t.columns)("data",I.jc(39,17,t.parking$))("actions",t.actions)("selectedColumns",t.columns)("first",(null==t.currentPage?null:t.currentPage.first)||0)("rows",(null==t.currentPage?null:t.currentPage.rows)||10)("sortBy",t.sortBy)("toolBarActions",t.toolBarActions)}},directives:[a.a,u.c,u.g,s.a,Q.i,r.d,g.r,g.i,r.l,g.c,g.q,g.g,r.k,u.f,r.j,u.h,r.e,y.m,j.a,u.b],pipes:[y.b],styles:["@media print{[_nghost-%COMP%]{display:none}}"]}),Object(k.__decorate)([Object(N.a)()],e.prototype,"blockUI",void 0),e})();var te=i("tyNb");const ie=[{path:"",component:ee},{path:"**",redirectTo:""}];let ae=(()=>{class e{}return e.\u0275mod=I.Ob({type:e}),e.\u0275inj=I.Nb({factory:function(t){return new(t||e)},imports:[[te.e.forChild(ie)],te.e]}),e})(),oe=(()=>{class e{}return e.\u0275mod=I.Ob({type:e}),e.\u0275inj=I.Nb({factory:function(t){return new(t||e)},imports:[[y.c,ae,C.a,v.f,g.k,g.v,f.b,h.c,m.b,a.b,D.e,D.c,p.a,b.f,u.e,d.c,c.b,s.b,l.b,r.i,n.a,o.a]]}),e})()}}]);