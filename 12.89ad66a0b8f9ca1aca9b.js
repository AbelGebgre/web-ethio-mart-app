(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"8OcI":function(e,t,i){"use strict";i.r(t),i.d(t,"AttendanceModule",function(){return xe});var n=i("n1FK"),o=i("hYoW"),a=i("5EWq"),l=i("Xa2L"),r=i("/1cH"),s=i("iadO"),d=i("1jcm"),c=i("d3UM"),u=i("NFeN"),b=i("qFsG"),h=i("kmnG"),v=i("0IaG"),p=i("V5BG"),m=i("Q4Mo"),g=i("jIHw"),f=i("7kUa"),D=i("3Pt+"),k=i("rEr+"),C=i("PCNd"),y=i("ofXK"),V=i("mrSG"),I=i("4ZtF"),M=i("nnAt"),W=i("fXoL"),w=i("12jx"),O=i("otk6"),j=i("/vft"),S=i("H28f"),Q=i("xivw"),x=i("FKr1");function N(e,t){1&e&&W.Rb(0,"p-tag",33),2&e&&W.oc("value","GPS permission denied")}function $(e,t){if(1&e&&(W.Wb(0,"mat-option",34),W.Wb(1,"span",3),W.Qc(2),W.Vb(),W.Vb()),2&e){const e=t.$implicit,i=W.hc();W.oc("value",e.id)("disabled",i.isTaken(e.id)),W.Cb(2),W.Rc(e.name)}}function T(e,t){if(1&e&&(W.Wb(0,"mat-error",10),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Rc(e.displayMessage.drivers)}}function A(e,t){if(1&e&&(W.Wb(0,"mat-error",10),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Sc("",e.displayMessage.range," ")}}function Y(e,t){if(1&e&&(W.Wb(0,"mat-error",10),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Sc("",e.displayMessage.latitude," ")}}function _(e,t){if(1&e&&(W.Wb(0,"mat-error",10),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Sc("",e.displayMessage.longitude," ")}}function B(e,t){if(1&e&&(W.Wb(0,"mat-error",10),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Sc("",e.displayMessage.place," ")}}const R=function(){return{standalone:!0}};let K=(()=>{class e{constructor(e,t,i,n,o){var a,l,r,s,d,c,u,b,h,v,p,m,g,f,k,C,y;this.fb=e,this.fun=t,this.fieldsQuery=i,this.fieldService=n,this.config=o,this.formSubmit=new W.o,this.formClose=new W.o,this.drivers=[],this.taken=[],this.obj$=this.fieldsQuery.selectAll(),this.isCurrentLocation=!1,this.isUpdate=!1,this.displayMessage={},this.image=Object(I.k)(null===(a=this.config.formData)||void 0===a?void 0:a.image)?null===(l=this.config.formData)||void 0===l?void 0:l.image:Object(I.p)(null===(r=this.config.formData)||void 0===r?void 0:r.image)?[null===(s=this.config.formData)||void 0===s?void 0:s.image]:Object(I.q)(null===(d=this.config.formData)||void 0===d?void 0:d.image)?[null===(c=this.config.formData)||void 0===c?void 0:c.image]:[];let V=[];null===(b=null===(u=this.config.lookupData)||void 0===u?void 0:u.drivers)||void 0===b||b.subscribe(e=>{this.drivers=V=this.fun.extractData(e)}),this.taken=null===(h=this.config.lookupData)||void 0===h?void 0:h.taken,this.isUpdate=void 0!==(null===(v=this.config.formData)||void 0===v?void 0:v.id),this.form=this.fb.group({id:null===(p=this.config.formData)||void 0===p?void 0:p.id,place:[null===(m=this.config.formData)||void 0===m?void 0:m.place,D.x.required],latitude:[null===(g=this.config.formData)||void 0===g?void 0:g.latitude,D.x.required],longitude:[null===(f=this.config.formData)||void 0===f?void 0:f.longitude,D.x.required],drivers:[null===(k=this.config.formData)||void 0===k?void 0:k.drivers,D.x.required],range:[null===(C=this.config.formData)||void 0===C?void 0:C.range,D.x.required],image:this.image,created_at:null===(y=this.config.formData)||void 0===y?void 0:y.created_at}),this.validationMessages={place:{required:"field is required"},latitude:{required:"field is required"},longitude:{required:"field is required"},drivers:{required:"field is required"},range:{required:"field is required"}},this.genericValidator=new M.a(this.validationMessages)}ngOnInit(){this.form.valueChanges.subscribe(()=>this.displayMessage=this.genericValidator.processMessages(this.form))}blur(e=""){this.displayMessage=this.genericValidator.processMessages(this.form)}rad(e){return e*Math.PI/180}currentLocation(){navigator.permissions.query({name:"geolocation"}).then(e=>{if("granted"!==e.state){const t={id:1,latLong:{latitude:null,longitude:null},isAllowed:!1,distance:0,permissions:e.state};clearInterval(this.interval),this.fieldService.set({obj:t})}}),navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:i}=e.coords,n={id:1,latLong:{latitude:t,longitude:i},isAllowed:!0,distance:0,permissions:"granted"};this.form.controls.latitude.patchValue(t),this.form.controls.longitude.patchValue(i),clearInterval(this.interval),this.fieldService.set({obj:n})})}calDistance(e,t){const i=this.rad((null==t?void 0:t.latitude)-(null==e?void 0:e.latitude)),n=this.rad((null==t?void 0:t.longitude)-(null==e?void 0:e.longitude)),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.rad(e.latitude))*Math.cos(this.rad(t.latitude))*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6378137}isTaken(e){var t,i,n;return(null===(t=this.taken.filter(t=>t.id===e))||void 0===t?void 0:t.length)>0&&!(null===(n=null===(i=this.config.formData)||void 0===i?void 0:i.drivers)||void 0===n?void 0:n.includes(e))}onChange(e){e.checked?this.interval=setInterval(()=>{this.currentLocation()},1e3):clearInterval(this.interval)}keyDown(e,t){return e.key?this.fun.allowedKey(e.key,t):(e.target.value=this.fun.removeNotAllowedKey(e.target.value,t),!0)}setValidation(e=null){this.form.controls.plateNo.setErrors({found:!0}),this.displayMessage=this.genericValidator.processMessages(this.form)}getFile(e){this.form.controls.image.setValue((null==e?void 0:e.upload.length)>0?null==e?void 0:e.upload:[])}onSubmit(){this.formSubmit.emit(this.form.value)}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(W.Qb(D.e),W.Qb(O.a),W.Qb(j.a),W.Qb(S.a),W.Qb(v.a))},e.\u0275cmp=W.Kb({type:e,selectors:[["app-attendance-location-form"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:74,vars:19,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title"],[1,"capitalize"],["styleClass","p-ml-3","severity","warning",3,"value",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12","p-md-6"],[1,"full-width"],[1,"error"],["placeholder","choose drivers","formControlName","drivers","multiple","",3,"closed"],[3,"value","disabled",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],["matInput","","tabindex","0","type","text","value","","formControlName","range",3,"blur","input","keydown"],["range",""],["matInput","","tabindex","0","type","text","value","","formControlName","latitude",3,"blur","input","keydown"],["latitude",""],["matInput","","tabindex","0","type","text","value","","formControlName","longitude",3,"blur","input","keydown"],["longitude",""],[1,"p-col-12"],["matInput","","tabindex","0","type","text","value","","formControlName","place",3,"blur","input","keydown"],["place",""],["color","primary",1,"example-section",3,"ngModel","ngModelOptions","ngModelChange","change"],[3,"uploadedFile","limit","fileDropped"],["fileImage",""],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"],["styleClass","p-ml-3","severity","warning",3,"value"],[3,"value","disabled"]],template:function(e,t){1&e&&(W.Wb(0,"form",0),W.ec("submit",function(){return t.onSubmit()}),W.Wb(1,"div",1),W.Wb(2,"div",2),W.Wb(3,"span",3),W.Qc(4),W.Vb(),W.Oc(5,N,1,1,"p-tag",4),W.ic(6,"async"),W.ic(7,"async"),W.Vb(),W.Wb(8,"button",5),W.ec("click",function(){return t.onCancel()}),W.Vb(),W.Vb(),W.Wb(9,"div",6),W.Wb(10,"div",7),W.Wb(11,"div",8),W.Wb(12,"mat-form-field",9),W.Wb(13,"mat-label"),W.Qc(14,"Drivers"),W.Wb(15,"span",10),W.Qc(16,"*"),W.Vb(),W.Vb(),W.Wb(17,"mat-select",11),W.ec("closed",function(){return t.blur()}),W.Oc(18,$,3,3,"mat-option",12),W.Vb(),W.Oc(19,T,2,1,"mat-error",13),W.Vb(),W.Vb(),W.Wb(20,"div",8),W.Wb(21,"mat-form-field",9),W.Wb(22,"mat-label"),W.Qc(23,"Range (meter)"),W.Wb(24,"span",10),W.Qc(25,"*"),W.Vb(),W.Vb(),W.Wb(26,"input",14,15),W.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"float")})("keydown",function(e){return t.keyDown(e,"float")}),W.Vb(),W.Oc(28,A,2,1,"mat-error",13),W.Vb(),W.Vb(),W.Wb(29,"div",8),W.Wb(30,"mat-form-field",9),W.Wb(31,"mat-label"),W.Qc(32,"Latitude"),W.Wb(33,"span",10),W.Qc(34,"*"),W.Vb(),W.Vb(),W.Wb(35,"input",16,17),W.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"float")})("keydown",function(e){return t.keyDown(e,"float")}),W.Vb(),W.Oc(37,Y,2,1,"mat-error",13),W.Vb(),W.Vb(),W.Wb(38,"div",8),W.Wb(39,"mat-form-field",9),W.Wb(40,"mat-label"),W.Qc(41,"Longitude"),W.Wb(42,"span",10),W.Qc(43,"*"),W.Vb(),W.Vb(),W.Wb(44,"input",18,19),W.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"float")})("keydown",function(e){return t.keyDown(e,"float")}),W.Vb(),W.Oc(46,_,2,1,"mat-error",13),W.Vb(),W.Vb(),W.Wb(47,"div",20),W.Wb(48,"mat-form-field",9),W.Wb(49,"mat-label"),W.Qc(50,"Place"),W.Wb(51,"span",10),W.Qc(52,"*"),W.Vb(),W.Vb(),W.Wb(53,"textarea",21,22),W.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"text")})("keydown",function(e){return t.keyDown(e,"text")}),W.Vb(),W.Oc(55,B,2,1,"mat-error",13),W.Vb(),W.Vb(),W.Wb(56,"mat-slide-toggle",23),W.ec("ngModelChange",function(e){return t.isCurrentLocation=e})("change",function(e){return t.onChange(e)}),W.Wb(57,"span"),W.Qc(58,"Current Location"),W.Vb(),W.Vb(),W.Wb(59,"div",20),W.Wb(60,"div",9),W.Wb(61,"app-file-upload-template",24,25),W.ec("fileDropped",function(e){return t.getFile(e)}),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Wb(63,"div",26),W.Wb(64,"button",27),W.ec("click",function(){return t.onCancel()}),W.Rb(65,"span",28),W.Wb(66,"span",29),W.Qc(67,"Cancel"),W.Vb(),W.Rb(68,"span",30),W.Vb(),W.Wb(69,"button",31),W.Rb(70,"span",32),W.Wb(71,"span",29),W.Qc(72,"Save"),W.Vb(),W.Rb(73,"span",30),W.Vb(),W.Vb(),W.Vb()),2&e&&(W.oc("formGroup",t.form),W.Cb(4),W.Rc(t.config.title),W.Cb(1),W.oc("ngIf",t.isCurrentLocation&&"granted"!==(null==W.jc(6,14,t.obj$)[0]?null:W.jc(6,14,t.obj$)[0].permissions)&&void 0!==(null==W.jc(7,16,t.obj$)[0]?null:W.jc(7,16,t.obj$)[0].permissions)),W.Cb(13),W.oc("ngForOf",t.drivers),W.Cb(1),W.oc("ngIf",t.displayMessage.drivers),W.Cb(9),W.oc("ngIf",t.displayMessage.range),W.Cb(9),W.oc("ngIf",t.displayMessage.latitude),W.Cb(9),W.oc("ngIf",t.displayMessage.longitude),W.Cb(9),W.oc("ngIf",t.displayMessage.place),W.Cb(1),W.oc("ngModel",t.isCurrentLocation)("ngModelOptions",W.rc(18,R)),W.Cb(5),W.oc("uploadedFile",t.image)("limit",1),W.Cb(8),W.oc("disabled",!t.form.valid))},directives:[D.y,D.r,D.i,v.g,y.m,g.b,m.a,v.e,h.c,h.g,c.a,D.q,D.g,y.l,b.b,D.c,d.a,D.t,Q.a,v.c,o.a,x.i,h.b],pipes:[y.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:flex-end}"],changeDetection:0}),Object(V.__decorate)([Object(w.a)()],e.prototype,"blockUI",void 0),e})();var q=i("7+5H"),L=i("LRne"),P=i("I/3d");let U=(()=>{class e{constructor(e,t){this.firestore=e,this.fun=t,this.url="/locations"}get(e=!1){const t=""+this.url;return e?this.firestore.collection(t,t=>t.where("status","==",e)):this.firestore.collection(t)}add(e,t=null){var i;delete e.id;const n=[],o=""+this.url;if((null===(i=null==e?void 0:e.image)||void 0===i?void 0:i.length)>0)return e.image.forEach((i,a)=>this.fun.storeToFirebase(i,this.url).then(i=>{if(n.push(i),a+1===e.image.length)return e.image=n,e.created_at=(new Date).toISOString(),this.firestore.collection(o).add(e).then(e=>{var i;null==t||t.ref.close(),null===(i=null==t?void 0:t.block)||void 0===i||i.stop()}).catch(e=>{var i;null===(i=null==t?void 0:t.block)||void 0===i||i.stop()});a++}).catch(e=>{t.block.stop(),this.fun.notify("",e,1e4)}));e.created_at=(new Date).toISOString(),this.firestore.collection(o).add(e).then(e=>{var i;null==t||t.ref.close(),null===(i=null==t?void 0:t.block)||void 0===i||i.stop()}).catch(e=>{var i;null===(i=null==t?void 0:t.block)||void 0===i||i.stop()})}update(e,t,i=null){var n;delete t.id;let o=0;const a=[];return(null===(n=null==t?void 0:t.image)||void 0===n?void 0:n.length)>0?t.image.forEach((n,l)=>null==(null==n?void 0:n.url)?this.fun.storeToFirebase(n,this.url).then(n=>{if(a.push(n),o++,l+1===t.image.length)return t.image=a,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==i||i.ref.close(),null===(t=null==i?void 0:i.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==i?void 0:i.block)||void 0===t||t.stop()});l++}).catch(e=>{i.block.stop(),this.fun.notify("","Something error occur",3e3)}):(a.push(null==n?void 0:n.url),0===o?(t.image=a,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==i||i.ref.close(),null===(t=null==i?void 0:i.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==i?void 0:i.block)||void 0===t||t.stop()})):void 0)):this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==i||i.ref.close(),null===(t=null==i?void 0:i.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==i?void 0:i.block)||void 0===t||t.stop()})}delete(e,t=null){return this.firestore.collection(this.url).doc(e).delete()}fitch(e){const t=new Date(new Date(null==e?void 0:e.start).setHours(0,0,0,0)),i=new Date(new Date(null==e?void 0:e.end).setHours(23,59,59,59)),n=null==e?void 0:e.userID;return this.firestore.collection(this.url,n?e=>e.where("date",">",t).where("date","<",i).where("driverID","==",n):e=>e.where("date",">",t).where("date","<",i))}}return e.\u0275fac=function(t){return new(t||e)(W.ac(P.a),W.ac(O.a))},e.\u0275prov=W.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var F=i("SRE/"),G=i("H0VJ"),E=i("WLRH");const H=function(){return[]};let z=(()=>{class e{constructor(e,t,i,n){this.fun=e,this.locationService=t,this.userService=i,this.dialogServices=n,this.formSubmit=new W.o,this.formClose=new W.o,this.drivers=[],this.columns=[{label:"Place",name:"place",sortable:!0},{label:"Latitude",name:"latitude",type:"price",sortable:!0},{label:"Longitude",name:"longitude",type:"price",sortable:!0},{label:"Drivers",name:"count",type:"link",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1},{label:"Range",name:"range",type:"price",sortable:!0}],this.actions=[{icon:"pencil",color:"warning",disable:!1},{icon:"trash",color:"danger"}],this.dialogConfig={width:"550px",formComponent:K,service:this.locationService},this.dialogConfigModal={closable:!0,formComponent:q.a}}ngOnInit(){let e,t;this.users$=e=this.userService.get("driver").snapshotChanges(),e.subscribe(e=>{this.drivers=this.fun.extractData(e)}),this.locations$=t=this.locationService.get().snapshotChanges(),t.subscribe(e=>{this.locations=this.fun.extractData(e);const t=[],i=this.locations.map(e=>{var i;return t.push(...null===(i=null==e?void 0:e.drivers)||void 0===i?void 0:i.map(e=>({id:e}))),Object.assign(Object.assign({},e),{count:null==e?void 0:e.drivers.length})});this.drivers$=t,this.data$=Object(L.a)(i)})}add(){this.dialogConfig.title="New Attendance Location",this.dialogConfig.formData="",this.dialogConfig.lookupData={drivers:this.users$,taken:this.drivers$},this.dialogServices.handleDialog(this.dialogConfig)}update(e){this.dialogConfig.title="Edit Attendance Location",this.dialogConfig.formData=e,this.dialogConfig.lookupData={drivers:this.users$,taken:this.drivers$},this.dialogServices.handleDialog(this.dialogConfig)}showModalTable(e,t,i,n="1000px"){this.dialogConfigModal.width=n,this.dialogConfigModal.lookupData={caption:e,columns:t,data:i},this.dialogServices.handleDialog(this.dialogConfigModal)}onClick(){this.add()}onActionClick(e){var t;if("pencil"===e.type)this.update(e.data);else if("trash"===e.type)this.blockUI.start("Deleting"),this.locationService.delete(e.data.id).then(e=>{this.blockUI.stop()});else if("link"===e.type){const i=null===(t=this.drivers)||void 0===t?void 0:t.filter(t=>{var i,n;return null===(n=null===(i=e.data)||void 0===i?void 0:i.drivers)||void 0===n?void 0:n.includes(t.id)}).map(e=>{var{name:t,phone:i,email:n,image:o,role:a}=e;return Object(V.__rest)(e,["name","phone","email","image","role"]),{name:t,phone:i,email:n,image:o,role:a}});if(i.length>0){const e=Object.keys(i[0]),t=this.fun.getColumns(e);this.showModalTable("Drivers Info",t,i,"900px")}}}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(W.Qb(O.a),W.Qb(U),W.Qb(F.a),W.Qb(G.a))},e.\u0275cmp=W.Kb({type:e,selectors:[["app-attendance-locations"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:18,vars:12,consts:[["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title","capitalize"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12"],[1,"full-width"],[1,"buttons"],["pButton","","pRipple","","type","button","label","Add Location",3,"icon","click"],[3,"columns","data","isInModal","hasOrder","actions","toolBarActions","buttonClick"],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"]],template:function(e,t){1&e&&(W.Wb(0,"div",0),W.Wb(1,"div",1),W.Qc(2,"Attendance Locations"),W.Vb(),W.Wb(3,"button",2),W.ec("click",function(){return t.onCancel()}),W.Vb(),W.Vb(),W.Wb(4,"div",3),W.Wb(5,"div",4),W.Wb(6,"div",5),W.Wb(7,"div",6),W.Wb(8,"div",7),W.Wb(9,"button",8),W.ec("click",function(){return t.onClick()}),W.Vb(),W.Vb(),W.Wb(10,"app-table-template",9),W.ec("buttonClick",function(e){return t.onActionClick(e)}),W.ic(11,"async"),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Wb(12,"div",10),W.Wb(13,"button",11),W.ec("click",function(){return t.onCancel()}),W.Rb(14,"span",12),W.Wb(15,"span",13),W.Qc(16,"Cancel"),W.Vb(),W.Rb(17,"span",14),W.Vb(),W.Vb()),2&e&&(W.Cb(9),W.Eb("p-button-sm shadow-none p-mr-2"),W.oc("icon","pi pi-plus"),W.Cb(1),W.oc("columns",t.columns)("data",W.jc(11,9,t.data$))("isInModal",!0)("hasOrder",!1)("actions",t.actions)("toolBarActions",W.rc(11,H)))},directives:[v.g,g.b,m.a,v.e,E.a,v.c],pipes:[y.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:flex-end}"]}),Object(V.__decorate)([Object(w.a)()],e.prototype,"blockUI",void 0),e})();var X=i("PqYM"),J=i("AytR"),Z=i("fbMX");function ee(e,t){if(1&e&&(W.Wb(0,"span",16),W.Qc(1),W.Vb()),2&e){const e=W.hc();let t=null;W.Cb(1),W.Rc(null==e.type||null==(t=e.type.split("-"))?null:t.join(" "))}}function te(e,t){if(1&e&&(W.Wb(0,"span",16),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Rc(e.config.title)}}function ie(e,t){if(1&e&&(W.Rb(0,"p-tag",32),W.ic(1,"async"),W.ic(2,"async")),2&e){const e=W.hc();W.oc("value","granted"!==(null==W.jc(1,1,e.obj$)[0]?null:W.jc(1,1,e.obj$)[0].permissions)?"GPS permission denied":"Off-Site  You Are ("+(null==W.jc(2,3,e.obj$)[0]?null:W.jc(2,3,e.obj$)[0].distance)+") meter away")}}function ne(e,t){if(1&e&&(W.Wb(0,"mat-option",33),W.Wb(1,"span",16),W.Qc(2),W.Vb(),W.Vb()),2&e){const e=t.$implicit;W.oc("value",e.id),W.Cb(2),W.Rc(e.name)}}function oe(e,t){if(1&e&&(W.Wb(0,"mat-error",10),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Rc(e.displayMessage.driverID)}}function ae(e,t){if(1&e&&(W.Wb(0,"mat-error",10),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Rc(e.displayMessage.mode)}}function le(e,t){if(1&e&&(W.Wb(0,"mat-error",10),W.Qc(1),W.Vb()),2&e){const e=W.hc();W.Cb(1),W.Sc("",e.displayMessage.currentKM," ")}}const re=function(){return{standalone:!0}};function se(e,t){if(1&e){const e=W.Xb();W.Wb(0,"mat-slide-toggle",34),W.ec("ngModelChange",function(t){return W.Ec(e),W.hc().isNeedUpdate=t}),W.Wb(1,"span"),W.Qc(2,"Update Time"),W.Vb(),W.Vb()}if(2&e){const e=W.hc();W.oc("ngModel",e.isNeedUpdate)("ngModelOptions",W.rc(2,re))}}function de(e,t){if(1&e&&(W.Wb(0,"div",8),W.Wb(1,"mat-form-field",9),W.Wb(2,"mat-label"),W.Qc(3,"Update Time"),W.Vb(),W.Rb(4,"input",35),W.Rb(5,"mat-datepicker-toggle",36),W.Rb(6,"ngx-mat-datetime-picker",37,38),W.Vb(),W.Vb()),2&e){const e=W.Bc(7),t=W.hc();W.Cb(4),W.oc("ngxMatDatetimePicker",e)("min",t.min)("max",t.max),W.Cb(1),W.oc("for",e),W.Cb(1),W.oc("showSeconds",!0)("stepHour",1)("stepMinute",1)("stepSecond",1)("enableMeridian",!0)}}let ce=(()=>{class e{constructor(e,t,i,n,o,a,l){var r,s,d,c,u,b,h,v,p,m,g,f,k,C,y,V,w,O,j,S,Q,x,N,$,T;this.fb=e,this.fun=t,this.storageService=i,this.fieldsQuery=n,this.fieldService=o,this.dateAdapter=a,this.config=l,this.formSubmit=new W.o,this.formClose=new W.o,this.drivers=[],this.attendances=[],this.locations=[],this.user=null===(r=this.storageService.get(J.a.sessionKey))||void 0===r?void 0:r.user,this.obj$=this.fieldsQuery.selectAll(),this.columns=["name","label","type","required"],this.actions=[{icon:"pencil",color:"warning",disable:!1},{icon:"trash",color:"danger"}],this.isPublished=!0,this.isNeedUpdate=!1,this.count=0,this.type="",this.displayMessage={},this.dateAdapter.setLocale("en-GB"),this.image=Object(I.k)(null===(s=this.config.formData)||void 0===s?void 0:s.image)?null===(d=this.config.formData)||void 0===d?void 0:d.image:Object(I.p)(null===(c=this.config.formData)||void 0===c?void 0:c.image)?[null===(u=this.config.formData)||void 0===u?void 0:u.image]:Object(I.q)(null===(b=this.config.formData)||void 0===b?void 0:b.image)?[null===(h=this.config.formData)||void 0===h?void 0:h.image]:[];let A=[];this.attendances=null===(v=this.config.lookupData)||void 0===v?void 0:v.daily,this.locations=null===(p=this.config.lookupData)||void 0===p?void 0:p.locations,null===(g=null===(m=this.config.lookupData)||void 0===m?void 0:m.drivers)||void 0===g||g.subscribe(e=>{var t,i;A=this.fun.extractData(e),"driver"===(null===(t=this.user)||void 0===t?void 0:t.role)?(this.driverID=this.user.tag,this.drivers=A.filter(e=>e.id===this.driverID),this.form.controls.driverID.patchValue(this.driverID),this.onChange({value:this.driverID})):(this.drivers=A,this.driverID=(null===(i=this.config.formData)||void 0===i?void 0:i.driverID)||null)}),this.attendanceID=null===(f=this.config.formData)||void 0===f?void 0:f.id,this.isPublished=void 0===(null===(k=this.config.formData)||void 0===k?void 0:k.status)||(null===(C=this.config.formData)||void 0===C?void 0:C.status),this.day=(null===(y=this.config.formData)||void 0===y?void 0:y.date)?new Date(null===(V=this.config.formData)||void 0===V?void 0:V.date):new Date,this.min=new Date(new Date(this.day).setHours(0,0,0,0)),this.max=new Date(new Date(this.day).setHours(23,59,59,59)),this.form=this.fb.group({id:null===(w=this.config.formData)||void 0===w?void 0:w.id,currentKM:[null===(O=this.config.formData)||void 0===O?void 0:O.currentKM,D.x.required],driverID:[null===(j=this.config.formData)||void 0===j?void 0:j.driverID,D.x.required],image:[this.image,D.x.required],mode:[null===(S=this.config.formData)||void 0===S?void 0:S.mode,D.x.required],date:this.day,approvedBy:(null===(Q=this.config.formData)||void 0===Q?void 0:Q.approvedBy)||"admin"===this.user.role&&!this.attendanceID?null===(x=this.user)||void 0===x?void 0:x.tag:null,isApproved:!(!(null===(N=this.config.formData)||void 0===N?void 0:N.isApproved)&&("admin"!==this.user.role||this.attendanceID)),isCanceled:null===($=this.config.formData)||void 0===$?void 0:$.isCanceled,updateTime:this.day,created_at:null===(T=this.config.formData)||void 0===T?void 0:T.created_at}),this.validationMessages={driverID:{required:"field is required."},mode:{required:"field is required."},currentKM:{required:"field is required."}},this.genericValidator=new M.a(this.validationMessages)}ngOnInit(){this.interval=setInterval(()=>{this.currentLocation()},1e3),this.form.valueChanges.subscribe(()=>this.displayMessage=this.genericValidator.processMessages(this.form))}blur(e=""){this.displayMessage=this.genericValidator.processMessages(this.form)}rad(e){return e*Math.PI/180}currentLocation(){navigator.permissions.query({name:"geolocation"}).then(e=>{var t;if("granted"!==e.state){const e={id:1,latLong:{latitude:null,longitude:null},isAllowed:!1,distance:0,permissions:"admin"===(null===(t=this.user)||void 0===t?void 0:t.role)?"granted":"denied"};this.latLong={latitude:null,longitude:null},this.fieldService.set({obj:e})}}),navigator.geolocation.getCurrentPosition(e=>{var t,i,n;const{latitude:o,longitude:a}=e.coords,l={id:1,latLong:{latitude:o,longitude:a},isAllowed:!0,distance:0,permissions:"granted"};this.latLong={latitude:o,longitude:a};let r,s=500;const d=this.locations.filter(e=>{var t;return(null==e?void 0:e.driverID)===(null===(t=this.user)||void 0===t?void 0:t.tag)});d.length>0?(r={latitude:d[0].latitude,longitude:d[0].longitude},s=d[0].radius):r={latitude:9.0131207,longitude:38.8031002};const c=this.distance=null===(t=this.calDistance({latitude:o,longitude:a},r))||void 0===t?void 0:t.toFixed(2);let u;u="admin"===(null===(i=this.user)||void 0===i?void 0:i.role)||!("driver"===(null===(n=this.user)||void 0===n?void 0:n.role)&&this.distance>s),l.isAllowed=u,l.distance=parseFloat(c),this.fieldService.set({obj:l})})}calDistance(e,t){const i=this.rad((null==t?void 0:t.latitude)-(null==e?void 0:e.latitude)),n=this.rad((null==t?void 0:t.longitude)-(null==e?void 0:e.longitude)),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.rad(e.latitude))*Math.cos(this.rad(t.latitude))*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6378137}onChange(e){if(e.value){const t=this.attendances.find(t=>t.driverID===e.value);this.attendanceID?this.type=void 0===t?"Update check-in":"Update check-out":(this.type=void 0===t?"check-in":"check-out",this.form.controls.mode.patchValue(this.type))}}keyDown(e,t){return e.key?this.fun.allowedKey(e.key,t):(e.target.value=this.fun.removeNotAllowedKey(e.target.value,t),!0)}setValidation(e=null){this.form.controls.plateNo.setErrors({found:!0}),this.displayMessage=this.genericValidator.processMessages(this.form)}getFile(e){this.form.controls.image.setValue((null==e?void 0:e.upload.length)>0?null==e?void 0:e.upload:[])}onSubmit(){var e,t;const i=this.form.value,n=null===(e=this.drivers)||void 0===e?void 0:e.filter(e=>e.id===i.driverID)[0],o=null===(t=null==n?void 0:n.name)||void 0===t?void 0:t.split(" ")[0],a=this.user.tag,l=a===i.driverID?"self":"admin",r=this.isNeedUpdate?i.updateTime:i.date;null==i||delete i.updateTime;const s=("driver"!==this.user.role||null===i.id)&&i.isCanceled,d=this.latLong,c=Object.assign(Object.assign({},i),{driverName:o,uploaderID:a,uploaderName:l,date:r,isCanceled:s,latLong:d});clearInterval(this.interval),this.formSubmit.emit(c)}onCancel(){clearInterval(this.interval),this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(W.Qb(D.e),W.Qb(O.a),W.Qb(Z.a),W.Qb(j.a),W.Qb(S.a),W.Qb(x.a),W.Qb(v.a))},e.\u0275cmp=W.Kb({type:e,selectors:[["app-attendance-form"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:62,vars:25,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title"],["class","capitalize",4,"ngIf"],["styleClass","p-ml-3","severity","warning",3,"value",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12","p-md-6"],[1,"full-width"],[1,"error"],["placeholder","choose driver","formControlName","driverID",3,"value","disabled","valueChange","selectionChange","closed"],[3,"value",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],["placeholder","choose mode","formControlName","mode",3,"value","disabled","valueChange","closed"],["value","check-in"],[1,"capitalize"],["value","check-out"],[1,"p-col-12"],["matInput","","tabindex","0","type","text","value","","formControlName","currentKM",3,"blur","input","keydown"],["currentKM",""],["class","example-section p-col-12 p-md-6","color","primary","forControlName","published",3,"ngModel","ngModelOptions","ngModelChange",4,"ngIf"],["class","p-col-12 p-md-6",4,"ngIf"],[3,"uploadedFile","limit","fileDropped"],["fileImage",""],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"],["styleClass","p-ml-3","severity","warning",3,"value"],[3,"value"],["color","primary","forControlName","published",1,"example-section","p-col-12","p-md-6",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","formControlName","updateTime","readonly","",3,"ngxMatDatetimePicker","min","max"],["matSuffix","",3,"for"],[3,"showSeconds","stepHour","stepMinute","stepSecond","enableMeridian"],["picker",""]],template:function(e,t){1&e&&(W.Wb(0,"form",0),W.ec("submit",function(){return t.onSubmit()}),W.Wb(1,"div",1),W.Wb(2,"div",2),W.Oc(3,ee,2,1,"span",3),W.Oc(4,te,2,1,"span",3),W.Oc(5,ie,3,5,"p-tag",4),W.ic(6,"async"),W.ic(7,"async"),W.Vb(),W.Wb(8,"button",5),W.ec("click",function(){return t.onCancel()}),W.Vb(),W.Vb(),W.Wb(9,"div",6),W.Wb(10,"div",7),W.Wb(11,"div",8),W.Wb(12,"mat-form-field",9),W.Wb(13,"mat-label"),W.Qc(14,"Driver"),W.Wb(15,"span",10),W.Qc(16,"*"),W.Vb(),W.Vb(),W.Wb(17,"mat-select",11),W.ec("valueChange",function(e){return t.driverID=e})("selectionChange",function(e){return t.onChange(e)})("closed",function(){return t.blur()}),W.Oc(18,ne,3,2,"mat-option",12),W.Vb(),W.Oc(19,oe,2,1,"mat-error",13),W.Vb(),W.Vb(),W.Wb(20,"div",8),W.Wb(21,"mat-form-field",9),W.Wb(22,"mat-label"),W.Qc(23,"Mode"),W.Wb(24,"span",10),W.Qc(25,"*"),W.Vb(),W.Vb(),W.Wb(26,"mat-select",14),W.ec("valueChange",function(e){return t.mode=e})("closed",function(){return t.blur()}),W.Wb(27,"mat-option",15),W.Wb(28,"span",16),W.Qc(29,"Check-In"),W.Vb(),W.Vb(),W.Wb(30,"mat-option",17),W.Wb(31,"span",16),W.Qc(32,"Check-Out"),W.Vb(),W.Vb(),W.Vb(),W.Oc(33,ae,2,1,"mat-error",13),W.Vb(),W.Vb(),W.Wb(34,"div",18),W.Wb(35,"mat-form-field",9),W.Wb(36,"mat-label"),W.Qc(37,"Current KM"),W.Wb(38,"span",10),W.Qc(39,"*"),W.Vb(),W.Vb(),W.Wb(40,"input",19,20),W.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"float")})("keydown",function(e){return t.keyDown(e,"float")}),W.Vb(),W.Oc(42,le,2,1,"mat-error",13),W.Vb(),W.Vb(),W.Oc(43,se,3,3,"mat-slide-toggle",21),W.Oc(44,de,8,9,"div",22),W.Wb(45,"div",18),W.Wb(46,"div",9),W.Wb(47,"app-file-upload-template",23,24),W.ec("fileDropped",function(e){return t.getFile(e)}),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Wb(49,"div",25),W.Wb(50,"button",26),W.ec("click",function(){return t.onCancel()}),W.Rb(51,"span",27),W.Wb(52,"span",28),W.Qc(53,"Cancel"),W.Vb(),W.Rb(54,"span",29),W.Vb(),W.Wb(55,"button",30),W.ic(56,"async"),W.ic(57,"async"),W.Rb(58,"span",31),W.Wb(59,"span",28),W.Qc(60,"Save"),W.Vb(),W.Rb(61,"span",29),W.Vb(),W.Vb(),W.Vb()),2&e&&(W.oc("formGroup",t.form),W.Cb(3),W.oc("ngIf","driver"===(null==t.user?null:t.user.role)),W.Cb(1),W.oc("ngIf","admin"===(null==t.user?null:t.user.role)),W.Cb(1),W.oc("ngIf","driver"===(null==t.user?null:t.user.role)&&(!1===(null==W.jc(6,17,t.obj$)[0]?null:W.jc(6,17,t.obj$)[0].isAllowed)||"granted"!==(null==W.jc(7,19,t.obj$)[0]?null:W.jc(7,19,t.obj$)[0].permissions))),W.Cb(12),W.oc("value",t.driverID)("disabled","driver"===t.user.role||t.attendanceID),W.Cb(1),W.oc("ngForOf",t.drivers),W.Cb(1),W.oc("ngIf",t.displayMessage.driverID),W.Cb(7),W.oc("value",t.mode)("disabled","driver"===t.user.role||t.attendanceID),W.Cb(7),W.oc("ngIf",t.displayMessage.mode),W.Cb(9),W.oc("ngIf",t.displayMessage.currentKM),W.Cb(1),W.oc("ngIf","driver"!==t.user.role&&t.attendanceID),W.Cb(1),W.oc("ngIf",t.isNeedUpdate),W.Cb(3),W.oc("uploadedFile",t.image)("limit",1),W.Cb(8),W.oc("disabled",!t.form.valid||!1===(null==W.jc(56,21,t.obj$)[0]?null:W.jc(56,21,t.obj$)[0].isAllowed)||"granted"!==(null==W.jc(57,23,t.obj$)[0]?null:W.jc(57,23,t.obj$)[0].permissions)&&"driver"===t.user.role))},directives:[D.y,D.r,D.i,v.g,y.m,g.b,m.a,v.e,h.c,h.g,c.a,D.q,D.g,y.l,x.i,b.b,D.c,Q.a,v.c,o.a,h.b,d.a,D.t,n.a,s.j,h.h,n.b],pipes:[y.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:flex-end}"],changeDetection:0}),Object(V.__decorate)([Object(w.a)()],e.prototype,"blockUI",void 0),e})();var ue=i("wd/R"),be=i("DYbl"),he=i("/zas"),ve=i("YJ4X"),pe=i("VCSl"),me=i("NAU6"),ge=i("uNiC"),fe=i("sSZD");let De=(()=>{class e{constructor(e,t,i){this.db=e,this.firestore=t,this.fun=i,this.url="/attendance"}get(e=!1){const t=""+this.url;return e?this.firestore.collection(t,t=>t.where("status","==",e)):this.firestore.collection(t)}add(e,t=null){var i;delete e.id;const n=[],o=""+this.url;if((null===(i=null==e?void 0:e.image)||void 0===i?void 0:i.length)>0)return e.image.forEach((i,a)=>this.fun.storeToFirebase(i,this.url).then(i=>{if(n.push(i),a+1===e.image.length)return e.image=n,e.created_at=(new Date).toISOString(),this.firestore.collection(o).add(e).then(e=>{var i;null==t||t.ref.close(),null===(i=null==t?void 0:t.block)||void 0===i||i.stop()}).catch(e=>{var i;null===(i=null==t?void 0:t.block)||void 0===i||i.stop()});a++}).catch(e=>{t.block.stop(),this.fun.notify("",e,1e4)}));e.created_at=(new Date).toISOString(),this.firestore.collection(o).add(e).then(e=>{var i;null==t||t.ref.close(),null===(i=null==t?void 0:t.block)||void 0===i||i.stop()}).catch(e=>{var i;null===(i=null==t?void 0:t.block)||void 0===i||i.stop()})}update(e,t,i=null){var n;delete t.id;let o=0;const a=[];return(null===(n=null==t?void 0:t.image)||void 0===n?void 0:n.length)>0?t.image.forEach((n,l)=>null==(null==n?void 0:n.url)?this.fun.storeToFirebase(n,this.url).then(n=>{if(a.push(n),o++,l+1===t.image.length)return t.image=a,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==i||i.ref.close(),null===(t=null==i?void 0:i.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==i?void 0:i.block)||void 0===t||t.stop()});l++}).catch(e=>{i.block.stop(),this.fun.notify("","Something error occur",3e3)}):(a.push(null==n?void 0:n.url),0===o?(t.image=a,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==i||i.ref.close(),null===(t=null==i?void 0:i.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==i?void 0:i.block)||void 0===t||t.stop()})):void 0)):this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==i||i.ref.close(),null===(t=null==i?void 0:i.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==i?void 0:i.block)||void 0===t||t.stop()})}delete(e,t=null){return this.firestore.collection(this.url).doc(e).delete()}fitch(e){const t=new Date(new Date(null==e?void 0:e.start).setHours(0,0,0,0)),i=new Date(new Date(null==e?void 0:e.end).setHours(23,59,59,59)),n=null==e?void 0:e.userID;return this.firestore.collection(this.url,n?e=>e.where("date",">",t).where("date","<",i).where("driverID","==",n):e=>e.where("date",">",t).where("date","<",i))}}return e.\u0275fac=function(t){return new(t||e)(W.ac(fe.a),W.ac(P.a),W.ac(O.a))},e.\u0275prov=W.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var ke=i("7zfz");function Ce(e,t){1&e&&(W.Wb(0,"mat-error"),W.Qc(1,"Invalid start date"),W.Vb())}function ye(e,t){1&e&&(W.Wb(0,"mat-error"),W.Qc(1,"Invalid end date"),W.Vb())}function Ve(e,t){1&e&&W.Rb(0,"div",26)}function Ie(e,t){if(1&e&&(W.Wb(0,"div",26),W.Wb(1,"div",27),W.Wb(2,"div",28),W.Wb(3,"h5",29),W.Qc(4,"Check In"),W.Vb(),W.Rb(5,"i",30),W.Wb(6,"span",31),W.Wb(7,"span",32),W.Qc(8),W.ic(9,"date"),W.ic(10,"async"),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Vb()),2&e){const e=W.hc(2);W.Cb(8),W.Sc(" ",W.kc(9,1,null==W.jc(10,4,e.obj$)[0]?null:W.jc(10,4,e.obj$)[0].checkIn,"medium")," ")}}function Me(e,t){if(1&e&&(W.Wb(0,"div",26),W.Wb(1,"div",27),W.Wb(2,"div",28),W.Wb(3,"h5",29),W.Qc(4,"Check Out"),W.Vb(),W.Rb(5,"i",30),W.Wb(6,"span",31),W.Wb(7,"span",32),W.Qc(8),W.ic(9,"date"),W.ic(10,"async"),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Vb()),2&e){const e=W.hc(2);W.Cb(8),W.Sc(" ",W.kc(9,1,null==W.jc(10,4,e.obj$)[0]?null:W.jc(10,4,e.obj$)[0].checkOut,"medium")," ")}}function We(e,t){if(1&e&&(W.Wb(0,"div",2),W.Wb(1,"div",27),W.Wb(2,"div",28),W.Wb(3,"h5",29),W.Qc(4,"Duration"),W.Vb(),W.Rb(5,"i",30),W.Wb(6,"span",31),W.Wb(7,"span",32),W.Qc(8),W.ic(9,"async"),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Vb()),2&e){const e=W.hc(2);W.Cb(8),W.Sc(" ",(null==W.jc(9,1,e.obj$)[0]?null:W.jc(9,1,e.obj$)[0].duration)||" - "," ")}}function we(e,t){if(1&e){const e=W.Xb();W.Wb(0,"p-toolbar",22),W.Oc(1,Ve,1,0,"div",23),W.Oc(2,Ie,11,6,"div",23),W.Oc(3,Me,11,6,"div",23),W.Oc(4,We,10,3,"div",24),W.Wb(5,"div",2),W.Wb(6,"button",25),W.ec("click",function(t){W.Ec(e);const i=W.hc();return i.add(t,0===i.currentDriver.length?"checkIn":"checkOut")}),W.ic(7,"async"),W.Vb(),W.Vb(),W.Vb()}if(2&e){const e=W.hc();W.Cb(1),W.oc("ngIf",0===e.currentDriver.length),W.Cb(1),W.oc("ngIf",e.currentDriver.length>0),W.Cb(1),W.oc("ngIf",e.currentDriver.length>0),W.Cb(1),W.oc("ngIf",e.currentDriver.length>0),W.Cb(2),W.Eb("p-button-sm shadow-none p-mr-2"),W.oc("disabled",2===e.currentDriver.length||!(null!=W.jc(7,8,e.obj$)[0]&&W.jc(7,8,e.obj$)[0].isApproved)&&e.currentDriver.length>0)("label",0===e.currentDriver.length?"Check In":"Check Out")}}let Oe=(()=>{class e{constructor(e,t,i,n,o,a,l,r,s,d,c,u,b){this.carService=e,this.sessionQuery=t,this.optionsQuery=i,this.optionsService=n,this.userService=o,this.refuelService=a,this.parkingService=l,this.attendanceService=r,this.dialogServices=s,this.dateAdapter=d,this.confirmationService=c,this.locationService=u,this.fun=b,this.caption="Attendance",this.columns=[],this.actions=[],this.toolBarActions=[{position:"right",action:[{label:"Locations",icon:"map-marker",color:"",tooltip:null}]},{position:"left",action:[{label:"Create",icon:"plus",color:"",tooltip:null}]}],this.dates=["monday","tuesday"],this.attendance=[],this.refuel=[],this.parking=[],this.locations$=[],this.currentDriver=[],this.range=new D.h({start:new D.f(null),end:new D.f(null)}),this.today=new Date,this.duration="day",this.groupedBy=[],this.tableType=[],this.user$=this.sessionQuery.select(e=>e.user),this.obj$=this.optionsQuery.selectAll(),this.userID=null,this.userTag=null,this.dialogConfig={width:"550px",formComponent:ce,service:this.attendanceService},this.dialogConfigModal={closable:!0,formComponent:q.a},this.dialogConfigLocation={width:"95%",formComponent:z}}ngOnInit(){let e,t,i;this.user$.subscribe(e=>{this.role=null==e?void 0:e.role,"supervisor"===(null==e?void 0:e.role)?(this.actions=[],this.toolBarActions=[{position:"right",action:[{label:"Locations",icon:"map-marker",color:"",tooltip:null}]}]):"driver"===(null==e?void 0:e.role)&&(this.toolBarActions=[],this.userID=null==e?void 0:e.tag),this.userTag=null==e?void 0:e.tag}),this.dateAdapter.setLocale("en-GB"),this.onColumnsChange({value:this.duration}),this.onDateChange(),this.cars$=e=this.carService.get(!0).snapshotChanges(),e.subscribe(e=>{this.cars=this.fun.extractData(e)}),i=this.locationService.get().snapshotChanges(),i.subscribe(e=>{const t=[];this.fun.extractData(e).map(e=>{var i;null===(i=null==e?void 0:e.drivers)||void 0===i||i.map(i=>{t.push({driverID:i,location:{latitude:null==e?void 0:e.latitude,longitude:e.longitude},radius:null==e?void 0:e.radius})})}),this.locations$=t}),this.users$=t=this.userService.get("driver").snapshotChanges(),t.subscribe(e=>{this.users=this.fun.extractData(e)})}add(e=null,t=""){this.dialogConfig.title="driver"===this.role?"Attendance":"New Attendance",this.dialogConfig.formData="",this.dialogConfig.lookupData={drivers:this.users$,daily:this.daily,locations:this.locations$},null!==e&&"checkOut"===t?(this.confirmationService.close(),this.confirmationService.confirm({target:null==e?void 0:e.target,message:"Are you sure you want to Check Out?",icon:"pi pi-exclamation-triangle",accept:()=>{this.dialogServices.handleDialog(this.dialogConfig)}})):this.dialogServices.handleDialog(this.dialogConfig)}update(e){ue(new Date).toDate(),ue(new Date).toDate(),this.dialogConfig.title="driver"===this.role?"Attendance":"Update Attendance",this.dialogConfig.formData=e,this.dialogConfig.lookupData={drivers:this.users$,daily:this.daily,locations:this.locations$},this.dialogServices.handleDialog(this.dialogConfig)}locations(){this.dialogServices.handleDialog(this.dialogConfigLocation)}getChangedData(){var e;(null===(e=this.range.value)||void 0===e?void 0:e.end)&&(this.attendance$=this.onDateChange())}onDateChange(){var e;if(null===(e=this.range.value)||void 0===e?void 0:e.end){let e;this.blockUI.start("Loading...");const{start:t,end:i}=this.range.value,n=ue(t).toDate(),o=ue(i).toDate();return ue(t).subtract(1,"day").toDate(),this.refuelService.fitch({start:n,end:o,userID:this.userID}).snapshotChanges().subscribe(e=>{this.refuel$=this.fun.extractData(e)}),this.parkingService.fitch({start:n,end:o,userID:this.userID}).snapshotChanges().subscribe(e=>{this.parking$=this.fun.extractData(e)}),e=this.data=this.attendanceService.fitch({start:n,end:o,userID:this.userID}).snapshotChanges(),e.subscribe(e=>{var t;if(this.attendance=this.fun.extractData(e),this.blockUI.stop(),"day"===this.duration&&ue(n).format("YYYY-MM-DD")===ue().format("YYYY-MM-DD")&&(this.daily=this.attendance,this.userID)){const e=null===(t=this.daily)||void 0===t?void 0:t.filter(e=>e.driverID===this.userID);this.currentDriver=e,e.length>0&&this.observableTimer()}this.onGroupedByChange({value:this.groupedBy})}),e}return Object(L.a)([])}onTableChange(){var e;if((null===(e=this.groupedBy)||void 0===e?void 0:e.length)>0){this.refuel$=this.refuel$.map(e=>Object.assign(Object.assign({},e),{dates:ue(e.date).format("YYYY-MM-DD")}));let e=this.fun.groupedBy(this.refuel$,this.groupedBy);this.refuel=e=this.onGrouping(e,"refuel"),this.parking$=this.parking$.map(e=>Object.assign(Object.assign({},e),{dates:ue(e.date).format("YYYY-MM-DD")}));let t=this.fun.groupedBy(this.parking$,this.groupedBy);this.parking=t=this.onGrouping(t,"parking");let i=this.onCombine(e,t);i=this.onCombine(this.arrays,i);const n=this.groupedBy,o=2===n.length?"both":1===n.length&&n.includes("dates")?"date":1===n.length&&n.includes("driverID")?"driver":null;this.columns=this.onColumns(o),this.attendance$=Object(L.a)(i)}}onGrouping(e,t=""){return null==e?void 0:e.map(e=>{const i="parking"===t?{parking:this.fun.sumObjArr(null==e?void 0:e.items,"price"),parking_items:null==e?void 0:e.items}:{},n="refuel"===t?{refuel:this.fun.sumObjArr(null==e?void 0:e.items,"price"),refuel_items:null==e?void 0:e.items}:{};return Object.assign(Object.assign({driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:ue(null==e?void 0:e.date).format("YYYY-MM-DD")},n),i)})}onGroupedByChange(e){var t;if((null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0){this.attendance=this.attendance.map(e=>Object.assign(Object.assign({},e),{dates:ue(e.date).format("YYYY-MM-DD")}));const t=this.fun.groupedBy(this.attendance,e.value),i=this.mapping(t,e.value);this.refuel$=this.refuel$.map(e=>Object.assign(Object.assign({},e),{dates:ue(e.date).format("YYYY-MM-DD")}));let n=this.fun.groupedBy(this.refuel$,e.value);n=this.onGrouping(n,"refuel"),this.parking$=this.parking$.map(e=>Object.assign(Object.assign({},e),{dates:ue(e.date).format("YYYY-MM-DD")}));let o=this.fun.groupedBy(this.parking$,e.value);o=this.onGrouping(o,"parking");const a=this.groupedBy,l=2===a.length?"both":1===a.length&&a.includes("dates")?"date":1===a.length&&a.includes("driverID")?"driver":null;if(this.columns=this.onColumns(l),this.arrays=i,this.tableType.length>0){let e=n.length>=o.length?this.onCombine(n,o):this.onCombine(o,n);e=this.onCombine(i,e),this.attendance$=Object(L.a)(e)}else this.attendance$=Object(L.a)(i);this.actions=[]}else{this.columns=this.onColumns();const e=this.attendance.map(e=>Object.assign(Object.assign({},e),{dates:ue(e.date).format("YYYY-MM-DD"),disable:e.isApproved,approve:e.isApproved?e.isApproved:e.isCanceled?"Canceled":"Pending"}));this.attendance$=Object(L.a)(e),"admin"===this.role?this.actions=[{icon:"pencil",color:"warning"},{icon:"times",color:"danger"},{icon:"check",color:""}]:"driver"===this.role&&(this.actions=[{icon:"pencil",color:"warning"}])}}onCombine(e,t){return e.map(e=>{const i=this.groupedBy,n=2===i.length?t.find(t=>(null==t?void 0:t.driverID)===(null==e?void 0:e.driverID)&&(null==t?void 0:t.dates)===(null==e?void 0:e.dates)):1===i.length&&i.includes("dates")?t.find(t=>(null==t?void 0:t.dates)===(null==e?void 0:e.dates)):1===i.length&&i.includes("driverID")?t.find(t=>(null==t?void 0:t.driverID)===(null==e?void 0:e.driverID)):null;return Object.assign(Object.assign({},e),n)})}mapping(e,t){return null==e?void 0:e.map((e,i,n)=>{var o,a,l,r,s,d,c,u,b,h;const v=null===(o=null==e?void 0:e.items)||void 0===o?void 0:o.filter(e=>"check-in"===e.mode)[0],p=null===(a=null==e?void 0:e.items)||void 0===a?void 0:a.filter(e=>"check-out"===e.mode)[0],m=null===(r=null===(l=n[i-1])||void 0===l?void 0:l.items)||void 0===r?void 0:r.filter(e=>"check-out"===e.mode)[0],g=(null==p?void 0:p.currentKM)?new Date(null==p?void 0:p.date).getTime()/1e3-new Date(null==v?void 0:v.date).getTime()/1e3:(new Date).getTime()/1e3-new Date(null==v?void 0:v.date).getTime()/1e3,f=ue.duration(Number(g),"seconds").days(),D=ue.duration(Number(g),"seconds").hours(),k=ue.duration(Number(g),"seconds").minutes(),C=ue.duration(Number(g),"seconds").seconds(),y=parseFloat(null==p?void 0:p.currentKM)-parseFloat(null==v?void 0:v.currentKM),V=parseFloat(null==v?void 0:v.currentKM)-parseFloat(null==m?void 0:m.currentKM);let I=[],M="";return 0!==f?(I=[f],M="d"):0!==D?(I=[D<10?"0"+D:D,k<10?"0"+k:k],M=D>1?"hrs":"hr"):0!==k?(I=[k<10?"0"+k:k,C<10?"0"+C:C],M=k>1?"mins":"min"):0!==C&&(I=[k<10?"0"+k:k,C<10?"0"+C:C],M=D>1?"secs":"sec"),2===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:ue(null==e?void 0:e.date).format("YYYY-MM-DD"),check_in_time:(null==v?void 0:v.date)||null,check_in_km:(null==v?void 0:v.currentKM)||"-",check_out_time:(null==p?void 0:p.date)||null,check_out_km:(null==p?void 0:p.currentKM)||"-",duration:I.join(":")+M,travel:(null==p?void 0:p.currentKM)?y+" km":"-",advance:V?V+" km":"-",count:e.items.length,items:e.items}:(null==t?void 0:t.includes("dates"))&&1===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:ue(null==e?void 0:e.date).format("YYYY-MM-DD"),checkIn:null===(s=null==e?void 0:e.items)||void 0===s?void 0:s.filter(e=>"check-in"===e.mode).length,checkOut:null===(d=e.items)||void 0===d?void 0:d.filter(e=>"check-out"===e.mode).length,count:Math.max(null==e?void 0:e.items.filter(e=>"check-in"===e.mode).length,null===(c=e.items)||void 0===c?void 0:c.filter(e=>"check-out"===e.mode).length),items:null==e?void 0:e.items}:(null==t?void 0:t.includes("driverID"))&&1===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,dates:ue(null==e?void 0:e.date).format("YYYY-MM-DD"),checkIn:null===(u=null==e?void 0:e.items)||void 0===u?void 0:u.filter(e=>"check-in"===e.mode).length,checkOut:null===(b=e.items)||void 0===b?void 0:b.filter(e=>"check-out"===e.mode).length,count:Math.max(null==e?void 0:e.items.filter(e=>"check-in"===e.mode).length,null===(h=e.items)||void 0===h?void 0:h.filter(e=>"check-out"===e.mode).length),items:null==e?void 0:e.items}:void 0})}onColumns(e=null){const t=this.tableType,i=2===t.length?[{label:"Refuel",name:"refuel",type:"link",sortable:!0},{label:"Parking",name:"parking",type:"link",sortable:!0}]:1===t.length&&t.includes("refuel")?[{label:"Refuel",name:"refuel",type:"link",sortable:!0}]:1===t.length&&t.includes("parking")?[{label:"Parking",name:"parking",type:"link",sortable:!0}]:[];if(null===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Type",name:"mode",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1},{label:"Status",name:"approve",type:"status",sortable:!0}];return"driver"===this.role&&e.shift(),e}if("both"===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In Time",name:"check_in_time",type:"mediumTime",sortable:!0},{label:"Check In KM",name:"check_in_km",sortable:!0},{label:"Check Out Time",name:"check_out_time",type:"mediumTime",sortable:!0},{label:"Check Out KM",name:"check_out_km",sortable:!0},{label:"Duration",name:"duration",sortable:!0},{label:"Travel",name:"travel",sortable:!0},{label:"Advance",name:"advance",sortable:!0},...i];return"driver"===this.role&&e.shift(),e}if("date"===e)return[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In",name:"checkIn",type:"link",sortable:!0},{label:"Check Out",name:"checkOut",type:"link",sortable:!0},{label:"Attendance",name:"count",type:"link",sortable:!0},...i];if("driver"===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Check In",name:"checkIn",type:"link",sortable:!0},{label:"Check Out",name:"checkOut",type:"link",sortable:!0},{label:"Attendance",name:"count",type:"link",sortable:!0},...i];return"driver"===this.role&&e.shift(),e}}onColumnsChange(e){if("isoWeek"===e.value||"month"===e.value||"day"===e.value){let t,i;const n=ue().format("dddd").toLowerCase();i=this.dates.includes(n)&&"isoWeek"===e.value?ue().subtract(1,"weeks").startOf("isoWeek").toDate():ue().startOf(e.value).toDate(),t=ue().endOf(e.value).toDate(),t=t>new Date?new Date:t,this.range.controls.start.patchValue(i),this.range.controls.end.patchValue(t)}}onActionClick(e){var t,i,n,o,a,l,r,s,d,c,u,b,h,v,p,m,g,f,D,k,C,y,I,M;if("pencil"===e.type)this.update(e.data);else if("times"===e.type)this.blockUI.start("Updating..."),this.attendanceService.update(e.data.id,{isCanceled:!0,isApproved:!1,approvedBy:null}).then(e=>{this.blockUI.stop()});else if("check"===e.type)this.blockUI.start("Updating..."),this.attendanceService.update(e.data.id,{isCanceled:!1,isApproved:!0,approvedBy:this.userTag}).then(e=>{this.blockUI.stop()});else if("trash"===e.type)this.blockUI.start("Deleting..."),this.attendanceService.delete(e.data.id).then(e=>{this.blockUI.stop()});else if("link"===e.type){let W,w;const O=this.groupedBy;if("checkIn"===e.position)W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],w=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.items)||void 0===i?void 0:i.filter(e=>"check-in"===e.mode),this.showModalTable("Check In - "+((null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.driverName)||(null===(a=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.date)||void 0===a?void 0:a.split("T")[0])),W,w);else if("checkOut"===e.position)W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],w=null===(r=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.items)||void 0===r?void 0:r.filter(e=>"check-out"===e.mode),this.showModalTable("Check Out - "+((null===(s=null==e?void 0:e.data)||void 0===s?void 0:s.driverName)||(null===(c=null===(d=null==e?void 0:e.data)||void 0===d?void 0:d.date)||void 0===c?void 0:c.split("T")[0])),W,w);else if("count"===e.position){W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In Time",name:"check_in_time",type:"mediumTime",sortable:!0},{label:"Check In KM",name:"check_in_km",sortable:!0},{label:"Check Out Time",name:"check_out_time",type:"mediumTime",sortable:!0},{label:"Check Out KM",name:"check_out_km",sortable:!0},{label:"Duration",name:"duration",sortable:!0},{label:"Travel",name:"travel",sortable:!0},{label:"Advance",name:"advance",sortable:!0}];const t=this.fun.groupedBy(null===(u=null==e?void 0:e.data)||void 0===u?void 0:u.items,["driverID","dates"]);w=this.mapping(t,["driverID","dates"]);const i=this.groupedBy,n=2===i.length?(null===(b=null==e?void 0:e.data)||void 0===b?void 0:b.driverName)+" - "+(null===(h=null==e?void 0:e.data)||void 0===h?void 0:h.dates):1===i.length&&i.includes("dates")?null===(v=null==e?void 0:e.data)||void 0===v?void 0:v.dates:1===i.length&&i.includes("driverID")?null===(p=null==e?void 0:e.data)||void 0===p?void 0:p.driverName:null;this.showModalTable("Attendance - "+n,W,w,"95%")}else if("driverName"===e.position){const t=null===(m=this.users)||void 0===m?void 0:m.filter(t=>{var i;return(null==t?void 0:t.id)===(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.driverID)}).map(e=>{var{name:t,phone:i,email:n,image:o,role:a}=e;return Object(V.__rest)(e,["name","phone","email","image","role"]),{name:t,phone:i,email:n,image:o,role:a}});if(t.length>0){const e=Object.keys(t[0]),i=this.fun.getColumns(e);this.showModalTable("Driver Info",i,t)}}else if("refuel"===e.position){W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Car",name:"plateNo",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1},{label:"Liter",name:"liter",sortable:!0},{label:"Previous KM",name:"previous_KM_On_Refuel",type:"price",sortable:!0},{label:"Current KM",name:"current_KM_On_Refuel",type:"price",sortable:!0}];const t=null===(g=null==e?void 0:e.data)||void 0===g?void 0:g.refuel_items,i=this.groupedBy,n=2===i.length?"Refuel: "+(null===(f=null==e?void 0:e.data)||void 0===f?void 0:f.driverName):1===i.length&&i.includes("dates")?"Refuel: "+(null===(D=null==e?void 0:e.data)||void 0===D?void 0:D.dates):1===i.length&&i.includes("driverID")?"Refuel: "+(null===(k=null==e?void 0:e.data)||void 0===k?void 0:k.driverName):null;this.showModalTable(n,W,t)}else if("parking"===e.position){W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Car",name:"plateNo",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}];const t=null===(C=null==e?void 0:e.data)||void 0===C?void 0:C.parking_items,i=this.groupedBy,n=2===i.length?null===(y=null==e?void 0:e.data)||void 0===y?void 0:y.driverName:1===i.length&&i.includes("dates")?null===(I=null==e?void 0:e.data)||void 0===I?void 0:I.dates:1===i.length&&i.includes("driverID")?"Refuel: "+(null===(M=null==e?void 0:e.data)||void 0===M?void 0:M.driverName):null;this.showModalTable(n,W,t,"1200px")}}}showModalTable(e,t,i,n="1000px"){this.dialogConfigModal.width=n,this.dialogConfigModal.lookupData={caption:e,columns:t,data:i},this.dialogServices.handleDialog(this.dialogConfigModal)}observableTimer(){Object(X.a)(0,1e3).subscribe(e=>{var t,i,n,o,a,l,r;const s=this.currentDriver.filter(e=>"check-in"===e.mode),d=this.currentDriver.filter(e=>"check-out"===e.mode);let c;c=(null==d?void 0:d.length)>0?new Date(null===(t=d[0])||void 0===t?void 0:t.date).getTime()/1e3-new Date(null===(i=s[0])||void 0===i?void 0:i.date).getTime()/1e3:(new Date).getTime()/1e3-new Date(null===(n=s[0])||void 0===n?void 0:n.date).getTime()/1e3;let u=[],b="";const h=ue.duration(Number(c),"seconds").days(),v=ue.duration(Number(c),"seconds").hours(),p=ue.duration(Number(c),"seconds").minutes(),m=ue.duration(Number(c),"seconds").seconds();0!==h?(u=[h],b="d"):0!==v?(u=[v<10?"0"+v:v,p<10?"0"+p:p],b=v>1?"hrs":"hr"):0!==p?(u=[p<10?"0"+p:p,m<10?"0"+m:m],b=p>1?"mins":"min"):0!==m&&(u=[p<10?"0"+p:p,m<10?"0"+m:m],b=v>1?"secs":"sec");const g={duration:(null==u?void 0:u.join(":"))+" "+b,checkIn:null===(o=s[0])||void 0===o?void 0:o.date,checkOut:(null==d?void 0:d.length)>0?null===(a=d[0])||void 0===a?void 0:a.date:(new Date).toISOString(),isApproved:(null==d?void 0:d.length)>0?null===(l=d[0])||void 0===l?void 0:l.isApproved:null===(r=s[0])||void 0===r?void 0:r.isApproved};this.optionsService.set({obj:g})})}onToolBarActionClick(e){"plus"===e?this.add():"map-marker"===e&&this.locations()}}return e.\u0275fac=function(t){return new(t||e)(W.Qb(be.a),W.Qb(he.a),W.Qb(ve.a),W.Qb(pe.a),W.Qb(F.a),W.Qb(me.a),W.Qb(ge.a),W.Qb(De),W.Qb(G.a),W.Qb(x.a),W.Qb(ke.a),W.Qb(U),W.Qb(O.a))},e.\u0275cmp=W.Kb({type:e,selectors:[["app-attendance"]],decls:46,vars:22,consts:[[1,"card"],[1,"p-mb-2"],[1,"p-toolbar-group-left"],[1,"p-mr-3"],[3,"value","valueChange","selectionChange"],["value","day"],["value","isoWeek"],["value","month"],[1,"p-ml-3"],["multiple","",3,"value","valueChange","selectionChange"],["value","driverID"],["value","dates"],["value","refuel"],["value","parking"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date",3,"ngModelChange"],["matSuffix","",3,"for"],["picker",""],[4,"ngIf"],["class","p-mt-2",4,"ngIf"],[3,"caption","columns","data","actions","selectedColumns","first","rows","sortBy","toolBarActions","buttonClick","toolBarButtonClick"],[1,"p-mt-2"],["class","p-toolbar-group-right",4,"ngIf"],["class","p-toolbar-group-left",4,"ngIf"],["type","button","pButton","","pRipple","",3,"disabled","label","click"],[1,"p-toolbar-group-right"],[1,"product-list-item"],[1,"product-list-detail"],[1,"mb-2"],[1,"pi","pi-clock","product-category-icon"],[1,"product-category"],[1,"product-badge","status-instock"]],template:function(e,t){if(1&e&&(W.Wb(0,"div",0),W.Wb(1,"p-toolbar",1),W.Wb(2,"div",2),W.Wb(3,"mat-form-field",3),W.Wb(4,"mat-label"),W.Qc(5,"Duration"),W.Vb(),W.Wb(6,"mat-select",4),W.ec("valueChange",function(e){return t.duration=e})("selectionChange",function(e){return t.onColumnsChange(e)}),W.Wb(7,"mat-option",5),W.Qc(8,"Daily"),W.Vb(),W.Wb(9,"mat-option",6),W.Qc(10,"Weekly"),W.Vb(),W.Wb(11,"mat-option",7),W.Qc(12,"Monthly"),W.Vb(),W.Vb(),W.Vb(),W.Wb(13,"mat-form-field",8),W.Wb(14,"mat-label"),W.Qc(15,"Grouped By"),W.Vb(),W.Wb(16,"mat-select",9),W.ec("valueChange",function(e){return t.groupedBy=e})("selectionChange",function(e){return t.onGroupedByChange(e)}),W.Wb(17,"mat-option",10),W.Qc(18),W.Vb(),W.Wb(19,"mat-option",11),W.Qc(20,"Date"),W.Vb(),W.Vb(),W.Vb(),W.Vb(),W.Wb(21,"div",2),W.Wb(22,"mat-form-field",3),W.Wb(23,"mat-label"),W.Qc(24,"Tables"),W.Vb(),W.Wb(25,"mat-select",9),W.ec("valueChange",function(e){return t.tableType=e})("selectionChange",function(){return t.onTableChange()}),W.Wb(26,"mat-option",12),W.Qc(27,"Refuel"),W.Vb(),W.Wb(28,"mat-option",13),W.Qc(29,"Parking"),W.Vb(),W.Vb(),W.Vb(),W.Wb(30,"mat-form-field",8),W.Wb(31,"mat-label"),W.Qc(32,"Enter a date range"),W.Vb(),W.Wb(33,"mat-date-range-input",14),W.Rb(34,"input",15),W.Wb(35,"input",16),W.ec("ngModelChange",function(){return t.getChangedData()}),W.Vb(),W.Vb(),W.Wb(36,"mat-hint"),W.Qc(37,"DD/MM/YYYY \u2013 DD/MM/YYYY"),W.Vb(),W.Rb(38,"mat-datepicker-toggle",17),W.Rb(39,"mat-date-range-picker",null,18),W.Oc(41,Ce,2,0,"mat-error",19),W.Oc(42,ye,2,0,"mat-error",19),W.Vb(),W.Vb(),W.Vb(),W.Oc(43,we,8,10,"p-toolbar",20),W.Vb(),W.Wb(44,"app-table-template",21),W.ec("buttonClick",function(e){return t.onActionClick(e)})("toolBarButtonClick",function(e){return t.onToolBarActionClick(e)}),W.ic(45,"async"),W.Vb()),2&e){const e=W.Bc(40);W.Cb(6),W.oc("value",t.duration),W.Cb(10),W.oc("value",t.groupedBy),W.Cb(2),W.Rc("driver"===t.role?"User":"Driver"),W.Cb(7),W.oc("value",t.tableType),W.Cb(8),W.oc("formGroup",t.range)("rangePicker",e)("max",t.today),W.Cb(5),W.oc("for",e),W.Cb(3),W.oc("ngIf",t.range.controls.start.hasError("matStartDateInvalid")),W.Cb(1),W.oc("ngIf",t.range.controls.end.hasError("matEndDateInvalid")),W.Cb(1),W.oc("ngIf","driver"===t.role),W.Cb(1),W.oc("caption",t.caption)("columns",t.columns)("data",W.jc(45,20,t.attendance$))("actions",t.actions)("selectedColumns",t.columns)("first",(null==t.currentPage?null:t.currentPage.first)||0)("rows",(null==t.currentPage?null:t.currentPage.rows)||10)("sortBy",t.sortBy)("toolBarActions",t.toolBarActions)}},directives:[a.a,h.c,h.g,c.a,x.i,s.d,D.r,D.i,s.l,D.c,D.q,D.g,s.k,h.f,s.j,h.h,s.e,y.m,E.a,h.b,g.b,m.a],pipes:[y.b,y.e],styles:["@media print{[_nghost-%COMP%]{display:none}}"]}),Object(V.__decorate)([Object(w.a)()],e.prototype,"blockUI",void 0),e})();var je=i("tyNb");const Se=[{path:"",component:Oe},{path:"**",redirectTo:""}];let Qe=(()=>{class e{}return e.\u0275mod=W.Ob({type:e}),e.\u0275inj=W.Nb({factory:function(t){return new(t||e)},imports:[[je.e.forChild(Se)],je.e]}),e})(),xe=(()=>{class e{}return e.\u0275mod=W.Ob({type:e}),e.\u0275inj=W.Nb({factory:function(t){return new(t||e)},imports:[[y.c,Qe,C.a,k.f,D.k,D.v,f.b,g.c,m.b,a.b,o.b,n.e,n.c,p.a,v.f,h.e,b.c,u.b,c.b,d.b,s.i,r.a,l.a]]}),e})()}}]);