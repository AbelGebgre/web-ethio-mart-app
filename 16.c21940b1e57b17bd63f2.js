(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{"8OcI":function(e,t,i){"use strict";i.r(t),i.d(t,"AttendanceModule",function(){return Se});var n=i("n1FK"),o=i("hYoW"),a=i("5EWq"),l=i("Xa2L"),r=i("/1cH"),s=i("iadO"),d=i("1jcm"),c=i("d3UM"),u=i("NFeN"),b=i("qFsG"),h=i("kmnG"),p=i("0IaG"),m=i("V5BG"),v=i("Q4Mo"),g=i("jIHw"),f=i("7kUa"),C=i("3Pt+"),D=i("rEr+"),y=i("PCNd"),k=i("ofXK"),V=i("mrSG"),M=i("YTlH"),I=i("4ZtF"),W=i("nnAt"),w=i("fXoL"),O=i("12jx"),j=i("otk6"),Q=i("/vft"),S=i("H28f"),x=i("xivw"),N=i("FKr1");function _(e,t){1&e&&w.Rb(0,"p-tag",33),2&e&&w.oc("value","GPS permission denied")}function R(e,t){if(1&e&&(w.Wb(0,"mat-option",34),w.Wb(1,"span",3),w.Qc(2),w.Vb(),w.Vb()),2&e){const e=t.$implicit,i=w.hc();w.oc("value",e.id)("disabled",i.isTaken(e.id)),w.Cb(2),w.Rc(e.name)}}function $(e,t){if(1&e&&(w.Wb(0,"mat-error",10),w.Qc(1),w.Vb()),2&e){const e=w.hc();w.Cb(1),w.Rc(e.displayMessage.drivers)}}function T(e,t){if(1&e&&(w.Wb(0,"mat-error",10),w.Qc(1),w.Vb()),2&e){const e=w.hc();w.Cb(1),w.Sc("",e.displayMessage.range," ")}}function A(e,t){if(1&e&&(w.Wb(0,"mat-error",10),w.Qc(1),w.Vb()),2&e){const e=w.hc();w.Cb(1),w.Sc("",e.displayMessage.latitude," ")}}function Y(e,t){if(1&e&&(w.Wb(0,"mat-error",10),w.Qc(1),w.Vb()),2&e){const e=w.hc();w.Cb(1),w.Sc("",e.displayMessage.longitude," ")}}function B(e,t){if(1&e&&(w.Wb(0,"mat-error",10),w.Qc(1),w.Vb()),2&e){const e=w.hc();w.Cb(1),w.Sc("",e.displayMessage.place," ")}}const K=function(){return{standalone:!0}};let q=(()=>{class e{constructor(e,t,i,n,o){var a,l,r,s,d,c,u,b,h,p,m,v,g,f,D,y,k;this.fb=e,this.fun=t,this.fieldsQuery=i,this.fieldService=n,this.config=o,this.formSubmit=new w.o,this.formClose=new w.o,this.drivers=[],this.taken=[],this.obj$=this.fieldsQuery.selectAll(),this.isCurrentLocation=!1,this.isUpdate=!1,this.displayMessage={},this.image=Object(I.k)(null===(a=this.config.formData)||void 0===a?void 0:a.image)?null===(l=this.config.formData)||void 0===l?void 0:l.image:Object(I.p)(null===(r=this.config.formData)||void 0===r?void 0:r.image)?[null===(s=this.config.formData)||void 0===s?void 0:s.image]:Object(I.q)(null===(d=this.config.formData)||void 0===d?void 0:d.image)?[null===(c=this.config.formData)||void 0===c?void 0:c.image]:[];let V=[];null===(b=null===(u=this.config.lookupData)||void 0===u?void 0:u.drivers)||void 0===b||b.subscribe(e=>{this.drivers=V=this.fun.extractData(e)}),this.taken=null===(h=this.config.lookupData)||void 0===h?void 0:h.taken,this.isUpdate=void 0!==(null===(p=this.config.formData)||void 0===p?void 0:p.id),this.form=this.fb.group({id:null===(m=this.config.formData)||void 0===m?void 0:m.id,place:[null===(v=this.config.formData)||void 0===v?void 0:v.place,C.x.required],latitude:[null===(g=this.config.formData)||void 0===g?void 0:g.latitude,C.x.required],longitude:[null===(f=this.config.formData)||void 0===f?void 0:f.longitude,C.x.required],drivers:[null===(D=this.config.formData)||void 0===D?void 0:D.drivers,C.x.required],range:[null===(y=this.config.formData)||void 0===y?void 0:y.range,C.x.required],image:this.image,created_at:null===(k=this.config.formData)||void 0===k?void 0:k.created_at}),this.validationMessages={place:{required:"field is required"},latitude:{required:"field is required"},longitude:{required:"field is required"},drivers:{required:"field is required"},range:{required:"field is required"}},this.genericValidator=new W.a(this.validationMessages)}ngOnInit(){this.form.valueChanges.subscribe(()=>this.displayMessage=this.genericValidator.processMessages(this.form))}blur(e=""){this.displayMessage=this.genericValidator.processMessages(this.form)}rad(e){return e*Math.PI/180}currentLocation(){navigator.permissions.query({name:"geolocation"}).then(e=>{if("granted"!==e.state){const t={id:1,latLong:{latitude:null,longitude:null},isAllowed:!1,distance:0,permissions:e.state};clearInterval(this.interval),this.fieldService.set({obj:t})}}),navigator.geolocation.getCurrentPosition(e=>{const{latitude:t,longitude:i}=e.coords,n={id:1,latLong:{latitude:t,longitude:i},isAllowed:!0,distance:0,permissions:"granted"};this.form.controls.latitude.patchValue(t),this.form.controls.longitude.patchValue(i),clearInterval(this.interval),this.fieldService.set({obj:n})})}calDistance(e,t){const i=this.rad((null==t?void 0:t.latitude)-(null==e?void 0:e.latitude)),n=this.rad((null==t?void 0:t.longitude)-(null==e?void 0:e.longitude)),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.rad(e.latitude))*Math.cos(this.rad(t.latitude))*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6378137}isTaken(e){var t,i,n;return(null===(t=this.taken.filter(t=>t.id===e))||void 0===t?void 0:t.length)>0&&!(null===(n=null===(i=this.config.formData)||void 0===i?void 0:i.drivers)||void 0===n?void 0:n.includes(e))}onChange(e){e.checked?this.interval=setInterval(()=>{this.currentLocation()},1e3):clearInterval(this.interval)}keyDown(e,t){return e.key?this.fun.allowedKey(e.key,t):(e.target.value=this.fun.removeNotAllowedKey(e.target.value,t),!0)}setValidation(e=null){this.form.controls.plateNo.setErrors({found:!0}),this.displayMessage=this.genericValidator.processMessages(this.form)}getFile(e){this.form.controls.image.setValue((null==e?void 0:e.upload.length)>0?null==e?void 0:e.upload:[])}onSubmit(){this.formSubmit.emit(this.form.value)}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(w.Qb(C.e),w.Qb(j.a),w.Qb(Q.a),w.Qb(S.a),w.Qb(p.a))},e.\u0275cmp=w.Kb({type:e,selectors:[["app-attendance-location-form"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:74,vars:19,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title"],[1,"capitalize"],["styleClass","p-ml-3","severity","warning",3,"value",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12","p-md-6"],[1,"full-width"],[1,"error"],["placeholder","choose drivers","formControlName","drivers","multiple","",3,"closed"],[3,"value","disabled",4,"ngFor","ngForOf"],["class","error",4,"ngIf"],["matInput","","tabindex","0","type","text","value","","formControlName","range",3,"blur","input","keydown"],["range",""],["matInput","","tabindex","0","type","text","value","","formControlName","latitude",3,"blur","input","keydown"],["latitude",""],["matInput","","tabindex","0","type","text","value","","formControlName","longitude",3,"blur","input","keydown"],["longitude",""],[1,"p-col-12"],["matInput","","tabindex","0","type","text","value","","formControlName","place",3,"blur","input","keydown"],["place",""],["color","primary",1,"example-section",3,"ngModel","ngModelOptions","ngModelChange","change"],[3,"uploadedFile","limit","fileDropped"],["fileImage",""],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"],["styleClass","p-ml-3","severity","warning",3,"value"],[3,"value","disabled"]],template:function(e,t){1&e&&(w.Wb(0,"form",0),w.ec("submit",function(){return t.onSubmit()}),w.Wb(1,"div",1),w.Wb(2,"div",2),w.Wb(3,"span",3),w.Qc(4),w.Vb(),w.Oc(5,_,1,1,"p-tag",4),w.ic(6,"async"),w.ic(7,"async"),w.Vb(),w.Wb(8,"button",5),w.ec("click",function(){return t.onCancel()}),w.Vb(),w.Vb(),w.Wb(9,"div",6),w.Wb(10,"div",7),w.Wb(11,"div",8),w.Wb(12,"mat-form-field",9),w.Wb(13,"mat-label"),w.Qc(14,"Drivers"),w.Wb(15,"span",10),w.Qc(16,"*"),w.Vb(),w.Vb(),w.Wb(17,"mat-select",11),w.ec("closed",function(){return t.blur()}),w.Oc(18,R,3,3,"mat-option",12),w.Vb(),w.Oc(19,$,2,1,"mat-error",13),w.Vb(),w.Vb(),w.Wb(20,"div",8),w.Wb(21,"mat-form-field",9),w.Wb(22,"mat-label"),w.Qc(23,"Range (meter)"),w.Wb(24,"span",10),w.Qc(25,"*"),w.Vb(),w.Vb(),w.Wb(26,"input",14,15),w.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"float")})("keydown",function(e){return t.keyDown(e,"float")}),w.Vb(),w.Oc(28,T,2,1,"mat-error",13),w.Vb(),w.Vb(),w.Wb(29,"div",8),w.Wb(30,"mat-form-field",9),w.Wb(31,"mat-label"),w.Qc(32,"Latitude"),w.Wb(33,"span",10),w.Qc(34,"*"),w.Vb(),w.Vb(),w.Wb(35,"input",16,17),w.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"float")})("keydown",function(e){return t.keyDown(e,"float")}),w.Vb(),w.Oc(37,A,2,1,"mat-error",13),w.Vb(),w.Vb(),w.Wb(38,"div",8),w.Wb(39,"mat-form-field",9),w.Wb(40,"mat-label"),w.Qc(41,"Longitude"),w.Wb(42,"span",10),w.Qc(43,"*"),w.Vb(),w.Vb(),w.Wb(44,"input",18,19),w.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"float")})("keydown",function(e){return t.keyDown(e,"float")}),w.Vb(),w.Oc(46,Y,2,1,"mat-error",13),w.Vb(),w.Vb(),w.Wb(47,"div",20),w.Wb(48,"mat-form-field",9),w.Wb(49,"mat-label"),w.Qc(50,"Place"),w.Wb(51,"span",10),w.Qc(52,"*"),w.Vb(),w.Vb(),w.Wb(53,"textarea",21,22),w.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"text")})("keydown",function(e){return t.keyDown(e,"text")}),w.Vb(),w.Oc(55,B,2,1,"mat-error",13),w.Vb(),w.Vb(),w.Wb(56,"mat-slide-toggle",23),w.ec("ngModelChange",function(e){return t.isCurrentLocation=e})("change",function(e){return t.onChange(e)}),w.Wb(57,"span"),w.Qc(58,"Current Location"),w.Vb(),w.Vb(),w.Wb(59,"div",20),w.Wb(60,"div",9),w.Wb(61,"app-file-upload-template",24,25),w.ec("fileDropped",function(e){return t.getFile(e)}),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Wb(63,"div",26),w.Wb(64,"button",27),w.ec("click",function(){return t.onCancel()}),w.Rb(65,"span",28),w.Wb(66,"span",29),w.Qc(67,"Cancel"),w.Vb(),w.Rb(68,"span",30),w.Vb(),w.Wb(69,"button",31),w.Rb(70,"span",32),w.Wb(71,"span",29),w.Qc(72,"Save"),w.Vb(),w.Rb(73,"span",30),w.Vb(),w.Vb(),w.Vb()),2&e&&(w.oc("formGroup",t.form),w.Cb(4),w.Rc(t.config.title),w.Cb(1),w.oc("ngIf",t.isCurrentLocation&&"granted"!==(null==w.jc(6,14,t.obj$)[0]?null:w.jc(6,14,t.obj$)[0].permissions)&&void 0!==(null==w.jc(7,16,t.obj$)[0]?null:w.jc(7,16,t.obj$)[0].permissions)),w.Cb(13),w.oc("ngForOf",t.drivers),w.Cb(1),w.oc("ngIf",t.displayMessage.drivers),w.Cb(9),w.oc("ngIf",t.displayMessage.range),w.Cb(9),w.oc("ngIf",t.displayMessage.latitude),w.Cb(9),w.oc("ngIf",t.displayMessage.longitude),w.Cb(9),w.oc("ngIf",t.displayMessage.place),w.Cb(1),w.oc("ngModel",t.isCurrentLocation)("ngModelOptions",w.rc(18,K)),w.Cb(5),w.oc("uploadedFile",t.image)("limit",1),w.Cb(8),w.oc("disabled",!t.form.valid))},directives:[C.y,C.r,C.i,p.g,k.m,g.b,v.a,p.e,h.c,h.g,c.a,C.q,C.g,k.l,b.b,C.c,d.a,C.t,x.a,p.c,o.a,N.i,h.b],pipes:[k.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:flex-end}"],changeDetection:0}),Object(V.__decorate)([Object(O.a)()],e.prototype,"blockUI",void 0),e})();var L=i("7+5H"),P=i("LRne"),U=i("V5Mw"),F=i("SRE/"),G=i("H0VJ"),E=i("WLRH");const H=function(){return[]};let X=(()=>{class e{constructor(e,t,i,n){this.fun=e,this.locationService=t,this.userService=i,this.dialogServices=n,this.formSubmit=new w.o,this.formClose=new w.o,this.drivers=[],this.columns=[{label:"Place",name:"place",sortable:!0},{label:"Latitude",name:"latitude",type:"price",sortable:!0},{label:"Longitude",name:"longitude",type:"price",sortable:!0},{label:"Drivers",name:"count",type:"link",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1},{label:"Range",name:"range",type:"price",sortable:!0}],this.actions=[{icon:"pencil",color:"warning",disable:!1}],this.dialogConfig={width:"550px",formComponent:q,service:this.locationService},this.dialogConfigModal={closable:!0,formComponent:L.a},this.dialogConfigReport={width:"95%",formComponent:M.a}}ngOnInit(){let e,t;this.users$=e=this.userService.get("driver").snapshotChanges(),e.subscribe(e=>{this.drivers=this.fun.extractData(e)}),this.locations$=t=this.locationService.get().snapshotChanges(),t.subscribe(e=>{this.locations=this.fun.extractData(e);const t=[],i=this.locations.map(e=>{var i;return t.push(...null===(i=null==e?void 0:e.drivers)||void 0===i?void 0:i.map(e=>({id:e}))),Object.assign(Object.assign({},e),{count:null==e?void 0:e.drivers.length})});this.drivers$=t,this.data$=Object(P.a)(i)})}add(){this.dialogConfig.title="New Attendance Location",this.dialogConfig.formData="",this.dialogConfig.lookupData={drivers:this.users$,taken:this.drivers$},this.dialogServices.handleDialog(this.dialogConfig)}update(e){this.dialogConfig.title="Edit Attendance Location",this.dialogConfig.formData=e,this.dialogConfig.lookupData={drivers:this.users$,taken:this.drivers$},this.dialogServices.handleDialog(this.dialogConfig)}report(){this.dialogConfigReport.title="location",this.dialogServices.handleDialog(this.dialogConfigReport)}showModalTable(e,t,i,n="1000px"){this.dialogConfigModal.width=n,this.dialogConfigModal.lookupData={caption:e,columns:t,data:i},this.dialogServices.handleDialog(this.dialogConfigModal)}onClick(e="add"){"add"===e?this.add():this.report()}onActionClick(e){var t;if("pencil"===e.type)this.update(e.data);else if("trash"===e.type)this.blockUI.start("Deleting"),this.locationService.delete(e.data.id).then(e=>{this.blockUI.stop()});else if("link"===e.type){const i=null===(t=this.drivers)||void 0===t?void 0:t.filter(t=>{var i,n;return null===(n=null===(i=e.data)||void 0===i?void 0:i.drivers)||void 0===n?void 0:n.includes(t.id)}).map(e=>{var{name:t,phone:i,email:n,image:o,role:a}=e;return Object(V.__rest)(e,["name","phone","email","image","role"]),{name:t,phone:i,email:n,image:o,role:a}});if(i.length>0){const e=Object.keys(i[0]),t=this.fun.getColumns(e);this.showModalTable("Drivers Info",t,i,"900px")}}}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(w.Qb(j.a),w.Qb(U.a),w.Qb(F.a),w.Qb(G.a))},e.\u0275cmp=w.Kb({type:e,selectors:[["app-attendance-locations"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:19,vars:15,consts:[["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title","capitalize"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12"],[1,"full-width"],[1,"buttons"],["pButton","","pRipple","","type","button","label","Report",3,"icon","click"],["pButton","","pRipple","","type","button","label","Add Location",3,"icon","click"],[3,"columns","data","isInModal","hasOrder","actions","toolBarActions","buttonClick"],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"]],template:function(e,t){1&e&&(w.Wb(0,"div",0),w.Wb(1,"div",1),w.Qc(2,"Attendance Locations"),w.Vb(),w.Wb(3,"button",2),w.ec("click",function(){return t.onCancel()}),w.Vb(),w.Vb(),w.Wb(4,"div",3),w.Wb(5,"div",4),w.Wb(6,"div",5),w.Wb(7,"div",6),w.Wb(8,"div",7),w.Wb(9,"button",8),w.ec("click",function(){return t.onClick("report")}),w.Vb(),w.Wb(10,"button",9),w.ec("click",function(){return t.onClick()}),w.Vb(),w.Vb(),w.Wb(11,"app-table-template",10),w.ec("buttonClick",function(e){return t.onActionClick(e)}),w.ic(12,"async"),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Wb(13,"div",11),w.Wb(14,"button",12),w.ec("click",function(){return t.onCancel()}),w.Rb(15,"span",13),w.Wb(16,"span",14),w.Qc(17,"Cancel"),w.Vb(),w.Rb(18,"span",15),w.Vb(),w.Vb()),2&e&&(w.Cb(9),w.Eb("p-button-sm shadow-none p-mr-2"),w.oc("icon","pi pi-chart-bar"),w.Cb(1),w.Eb("p-button-sm shadow-none p-mr-2"),w.oc("icon","pi pi-plus"),w.Cb(1),w.oc("columns",t.columns)("data",w.jc(12,12,t.data$))("isInModal",!0)("hasOrder",!1)("actions",t.actions)("toolBarActions",w.rc(14,H)))},directives:[p.g,g.b,v.a,p.e,E.a,p.c],pipes:[k.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:flex-end}"]}),Object(V.__decorate)([Object(O.a)()],e.prototype,"blockUI",void 0),e})();var z=i("PqYM"),J=i("AytR"),Z=i("fbMX");function ee(e,t){if(1&e&&(w.Wb(0,"span",27),w.Qc(1),w.Vb()),2&e){const e=w.hc();let t=null;w.Cb(1),w.Rc(null==e.type||null==(t=e.type.split("-"))?null:t.join(" "))}}function te(e,t){if(1&e&&(w.Wb(0,"span",27),w.Qc(1),w.Vb()),2&e){const e=w.hc();w.Cb(1),w.Rc(e.config.title)}}function ie(e,t){if(1&e&&(w.Rb(0,"p-tag",28),w.ic(1,"async"),w.ic(2,"async")),2&e){const e=w.hc();w.oc("value","granted"!==(null==w.jc(1,1,e.obj$)[0]?null:w.jc(1,1,e.obj$)[0].permissions)?"GPS permission denied":"Off-Site  You Are ("+(null==w.jc(2,3,e.obj$)[0]?null:w.jc(2,3,e.obj$)[0].distance)+") meter away")}}function ne(e,t){if(1&e&&(w.Wb(0,"mat-option",31),w.Wb(1,"span",27),w.Qc(2),w.Vb(),w.Vb()),2&e){const e=t.$implicit;w.oc("value",e.id),w.Cb(2),w.Rc(e.name)}}function oe(e,t){if(1&e&&(w.Wb(0,"mat-error",12),w.Qc(1),w.Vb()),2&e){const e=w.hc(2);w.Cb(1),w.Rc(e.displayMessage.driverID)}}function ae(e,t){if(1&e){const e=w.Xb();w.Wb(0,"mat-form-field",11),w.Wb(1,"mat-label"),w.Qc(2,"Driver"),w.Wb(3,"span",12),w.Qc(4,"*"),w.Vb(),w.Vb(),w.Wb(5,"mat-select",29),w.ec("valueChange",function(t){return w.Ec(e),w.hc().driverID=t})("selectionChange",function(t){return w.Ec(e),w.hc().onChange(t)})("closed",function(){return w.Ec(e),w.hc().blur()}),w.Oc(6,ne,3,2,"mat-option",30),w.Vb(),w.Oc(7,oe,2,1,"mat-error",15),w.Vb()}if(2&e){const e=w.hc();w.Cb(5),w.oc("value",e.driverID)("disabled",e.attendanceID),w.Cb(1),w.oc("ngForOf",e.drivers),w.Cb(1),w.oc("ngIf",e.displayMessage.driverID)}}function le(e,t){if(1&e&&(w.Wb(0,"mat-error",12),w.Qc(1),w.Vb()),2&e){const e=w.hc(2);w.Cb(1),w.Rc(e.displayMessage.mode)}}function re(e,t){if(1&e){const e=w.Xb();w.Wb(0,"mat-form-field",11),w.Wb(1,"mat-label"),w.Qc(2,"Mode"),w.Wb(3,"span",12),w.Qc(4,"*"),w.Vb(),w.Vb(),w.Wb(5,"mat-select",32),w.ec("valueChange",function(t){return w.Ec(e),w.hc().mode=t})("closed",function(){return w.Ec(e),w.hc().blur()}),w.Wb(6,"mat-option",33),w.Wb(7,"span",27),w.Qc(8,"Check-In"),w.Vb(),w.Vb(),w.Wb(9,"mat-option",34),w.Wb(10,"span",27),w.Qc(11,"Check-Out"),w.Vb(),w.Vb(),w.Vb(),w.Oc(12,le,2,1,"mat-error",15),w.Vb()}if(2&e){const e=w.hc();w.Cb(5),w.oc("value",e.mode)("disabled",e.attendanceID),w.Cb(7),w.oc("ngIf",e.displayMessage.mode)}}function se(e,t){if(1&e&&(w.Wb(0,"mat-error",12),w.Qc(1),w.Vb()),2&e){const e=w.hc();w.Cb(1),w.Sc("",e.displayMessage.currentKM," ")}}const de=function(){return{standalone:!0}};function ce(e,t){if(1&e){const e=w.Xb();w.Wb(0,"mat-slide-toggle",35),w.ec("ngModelChange",function(t){return w.Ec(e),w.hc().isNeedUpdate=t}),w.Wb(1,"span"),w.Qc(2,"Update Time"),w.Vb(),w.Vb()}if(2&e){const e=w.hc();w.oc("ngModel",e.isNeedUpdate)("ngModelOptions",w.rc(2,de))}}function ue(e,t){if(1&e&&(w.Wb(0,"div",8),w.Wb(1,"mat-form-field",11),w.Wb(2,"mat-label"),w.Qc(3),w.Vb(),w.Rb(4,"input",36),w.Rb(5,"mat-datepicker-toggle",37),w.Rb(6,"ngx-mat-datetime-picker",38,39),w.Vb(),w.Vb()),2&e){const e=w.Bc(7),t=w.hc();w.Cb(3),w.Rc(t.attendanceID?"Update Time":"Date"),w.Cb(1),w.oc("ngxMatDatetimePicker",e)("min",t.min)("max",t.max),w.Cb(1),w.oc("for",e),w.Cb(1),w.oc("showSeconds",!0)("stepHour",1)("stepMinute",1)("stepSecond",1)("enableMeridian",!0)("disabled","driver"===t.user.role)}}let be=(()=>{class e{constructor(e,t,i,n,o,a,l){var r,s,d,c,u,b,h,p,m,v,g,f,D,y,k,V,M,O,j,Q,S,x,N,_,R;this.fb=e,this.fun=t,this.storageService=i,this.fieldsQuery=n,this.fieldService=o,this.dateAdapter=a,this.config=l,this.formSubmit=new w.o,this.formClose=new w.o,this.drivers=[],this.attendances=[],this.locations=[],this.user=null===(r=this.storageService.get(J.a.sessionKey))||void 0===r?void 0:r.user,this.obj$=this.fieldsQuery.selectAll(),this.columns=["name","label","type","required"],this.actions=[{icon:"pencil",color:"warning",disable:!1}],this.isPublished=!0,this.isNeedUpdate=!1,this.count=0,this.type="",this.displayMessage={},this.dateAdapter.setLocale("en-GB"),this.image=Object(I.k)(null===(s=this.config.formData)||void 0===s?void 0:s.image)?null===(d=this.config.formData)||void 0===d?void 0:d.image:Object(I.p)(null===(c=this.config.formData)||void 0===c?void 0:c.image)?[null===(u=this.config.formData)||void 0===u?void 0:u.image]:Object(I.q)(null===(b=this.config.formData)||void 0===b?void 0:b.image)?[null===(h=this.config.formData)||void 0===h?void 0:h.image]:[];let $=[];this.attendances=null===(p=this.config.lookupData)||void 0===p?void 0:p.daily,this.locations=null===(m=this.config.lookupData)||void 0===m?void 0:m.locations,null===(g=null===(v=this.config.lookupData)||void 0===v?void 0:v.drivers)||void 0===g||g.subscribe(e=>{var t,i;$=this.fun.extractData(e),"driver"===(null===(t=this.user)||void 0===t?void 0:t.role)?(this.driverID=this.user.tag,this.drivers=$.filter(e=>e.id===this.driverID),this.form.controls.driverID.patchValue(this.driverID),this.onChange({value:this.driverID})):(this.drivers=$,this.driverID=(null===(i=this.config.formData)||void 0===i?void 0:i.driverID)||null)}),this.attendanceID=null===(f=this.config.formData)||void 0===f?void 0:f.id,this.isPublished=void 0===(null===(D=this.config.formData)||void 0===D?void 0:D.status)||(null===(y=this.config.formData)||void 0===y?void 0:y.status),this.day=(null===(k=this.config.formData)||void 0===k?void 0:k.date)?new Date(null===(V=this.config.formData)||void 0===V?void 0:V.date):new Date,this.min="driver"===this.user.role?new Date(new Date(this.day).setHours(0,0,0,0)):null,this.max=new Date(new Date(this.day).setHours(23,59,59,59)),this.form=this.fb.group({id:null===(M=this.config.formData)||void 0===M?void 0:M.id,currentKM:[null===(O=this.config.formData)||void 0===O?void 0:O.currentKM,C.x.required],driverID:[null===(j=this.config.formData)||void 0===j?void 0:j.driverID,C.x.required],image:[this.image,"driver"===this.user.role?C.x.required:null],mode:[null===(Q=this.config.formData)||void 0===Q?void 0:Q.mode,C.x.required],date:this.day,approvedBy:(null===(S=this.config.formData)||void 0===S?void 0:S.approvedBy)||"admin"===this.user.role&&!this.attendanceID?null===(x=this.user)||void 0===x?void 0:x.tag:null,isApproved:!(!(null===(N=this.config.formData)||void 0===N?void 0:N.isApproved)&&("admin"!==this.user.role||this.attendanceID)),isCanceled:null===(_=this.config.formData)||void 0===_?void 0:_.isCanceled,updateTime:this.day,created_at:null===(R=this.config.formData)||void 0===R?void 0:R.created_at}),this.validationMessages={driverID:{required:"field is required."},mode:{required:"field is required."},currentKM:{required:"field is required."}},this.genericValidator=new W.a(this.validationMessages)}ngOnInit(){this.interval=setInterval(()=>{this.currentLocation()},1e3),setInterval(()=>{"driver"!==this.user.role||this.attendanceID||(this.form.controls.date.patchValue(new Date),this.form.controls.updateTime.patchValue(new Date))},1e3),this.form.valueChanges.subscribe(()=>this.displayMessage=this.genericValidator.processMessages(this.form))}blur(e=""){this.displayMessage=this.genericValidator.processMessages(this.form)}rad(e){return e*Math.PI/180}currentLocation(){navigator.permissions.query({name:"geolocation"}).then(e=>{var t;if("granted"!==e.state){const e={id:1,latLong:{latitude:null,longitude:null},isAllowed:!1,distance:0,permissions:"admin"===(null===(t=this.user)||void 0===t?void 0:t.role)?"granted":"denied"};this.latLong={latitude:null,longitude:null},this.fieldService.set({obj:e})}}),navigator.geolocation.getCurrentPosition(e=>{var t,i,n;const{latitude:o,longitude:a}=e.coords,l={id:1,latLong:{latitude:o,longitude:a},isAllowed:!0,distance:0,permissions:"granted"};this.latLong={latitude:o,longitude:a};let r,s=500;const d=this.locations.filter(e=>{var t;return(null==e?void 0:e.driverID)===(null===(t=this.user)||void 0===t?void 0:t.tag)});d.length>0?(r={latitude:d[0].latitude,longitude:d[0].longitude},s=d[0].radius):r={latitude:9.0131207,longitude:38.8031002};const c=this.distance=null===(t=this.calDistance({latitude:o,longitude:a},r))||void 0===t?void 0:t.toFixed(2);let u;u="admin"===(null===(i=this.user)||void 0===i?void 0:i.role)||!("driver"===(null===(n=this.user)||void 0===n?void 0:n.role)&&this.distance>s),l.isAllowed=u,l.distance=parseFloat(c),this.fieldService.set({obj:l})})}calDistance(e,t){const i=this.rad((null==t?void 0:t.latitude)-(null==e?void 0:e.latitude)),n=this.rad((null==t?void 0:t.longitude)-(null==e?void 0:e.longitude)),o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(this.rad(e.latitude))*Math.cos(this.rad(t.latitude))*Math.sin(n/2)*Math.sin(n/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6378137}onChange(e){if(e.value){const t=this.attendances.find(t=>t.driverID===e.value);this.attendanceID?this.type=void 0===t?"Update check-in":"Update check-out":(this.type=void 0===t?"check-in":"check-out",this.form.controls.mode.patchValue(this.type))}}keyDown(e,t){return e.key?this.fun.allowedKey(e.key,t):(e.target.value=this.fun.removeNotAllowedKey(e.target.value,t),!0)}setValidation(e=null){this.form.controls.plateNo.setErrors({found:!0}),this.displayMessage=this.genericValidator.processMessages(this.form)}getFile(e){this.form.controls.image.setValue((null==e?void 0:e.upload.length)>0?null==e?void 0:e.upload:[])}onSubmit(){var e,t;const i=this.form.value,n=null===(e=this.drivers)||void 0===e?void 0:e.filter(e=>e.id===i.driverID)[0],o=null===(t=null==n?void 0:n.name)||void 0===t?void 0:t.split(" ")[0],a=this.user.tag,l=a===i.driverID?"self":"admin",r=this.isNeedUpdate&&this.attendanceID?i.updateTime:"driver"===this.user.role||this.attendanceID?i.date:i.updateTime;null==i||delete i.updateTime;const s=("driver"!==this.user.role||null===i.id)&&i.isCanceled,d=this.latLong,c=Object.assign(Object.assign({},i),{driverName:o,uploaderID:a,uploaderName:l,date:r,isCanceled:s,latLong:d});clearInterval(this.interval),this.formSubmit.emit(c)}onCancel(){clearInterval(this.interval),this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(w.Qb(C.e),w.Qb(j.a),w.Qb(Z.a),w.Qb(Q.a),w.Qb(S.a),w.Qb(N.a),w.Qb(p.a))},e.\u0275cmp=w.Kb({type:e,selectors:[["app-attendance-form"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:43,vars:20,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title"],["class","capitalize",4,"ngIf"],["styleClass","p-ml-3","severity","warning",3,"value",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12","p-md-6"],["class","full-width",4,"ngIf"],[1,"p-col-12"],[1,"full-width"],[1,"error"],["matInput","","tabindex","0","type","text","value","","formControlName","currentKM",3,"blur","input","keydown"],["currentKM",""],["class","error",4,"ngIf"],["class","example-section p-col-12 p-md-6","color","primary","forControlName","published",3,"ngModel","ngModelOptions","ngModelChange",4,"ngIf"],["class","p-col-12 p-md-6",4,"ngIf"],[3,"uploadedFile","limit","fileDropped"],["fileImage",""],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"],[1,"capitalize"],["styleClass","p-ml-3","severity","warning",3,"value"],["placeholder","choose driver","formControlName","driverID",3,"value","disabled","valueChange","selectionChange","closed"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["placeholder","choose mode","formControlName","mode",3,"value","disabled","valueChange","closed"],["value","check-in"],["value","check-out"],["color","primary","forControlName","published",1,"example-section","p-col-12","p-md-6",3,"ngModel","ngModelOptions","ngModelChange"],["matInput","","formControlName","updateTime","readonly","",3,"ngxMatDatetimePicker","min","max"],["matSuffix","",3,"for"],[3,"showSeconds","stepHour","stepMinute","stepSecond","enableMeridian","disabled"],["picker",""]],template:function(e,t){1&e&&(w.Wb(0,"form",0),w.ec("submit",function(){return t.onSubmit()}),w.Wb(1,"div",1),w.Wb(2,"div",2),w.Oc(3,ee,2,1,"span",3),w.Oc(4,te,2,1,"span",3),w.Oc(5,ie,3,5,"p-tag",4),w.ic(6,"async"),w.ic(7,"async"),w.Vb(),w.Wb(8,"button",5),w.ec("click",function(){return t.onCancel()}),w.Vb(),w.Vb(),w.Wb(9,"div",6),w.Wb(10,"div",7),w.Wb(11,"div",8),w.Oc(12,ae,8,4,"mat-form-field",9),w.Vb(),w.Wb(13,"div",8),w.Oc(14,re,13,3,"mat-form-field",9),w.Vb(),w.Wb(15,"div",10),w.Wb(16,"mat-form-field",11),w.Wb(17,"mat-label"),w.Qc(18,"Current KM"),w.Wb(19,"span",12),w.Qc(20,"*"),w.Vb(),w.Vb(),w.Wb(21,"input",13,14),w.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"float")})("keydown",function(e){return t.keyDown(e,"float")}),w.Vb(),w.Oc(23,se,2,1,"mat-error",15),w.Vb(),w.Vb(),w.Oc(24,ce,3,3,"mat-slide-toggle",16),w.Oc(25,ue,8,11,"div",17),w.Wb(26,"div",10),w.Wb(27,"div",11),w.Wb(28,"app-file-upload-template",18,19),w.ec("fileDropped",function(e){return t.getFile(e)}),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Wb(30,"div",20),w.Wb(31,"button",21),w.ec("click",function(){return t.onCancel()}),w.Rb(32,"span",22),w.Wb(33,"span",23),w.Qc(34,"Cancel"),w.Vb(),w.Rb(35,"span",24),w.Vb(),w.Wb(36,"button",25),w.ic(37,"async"),w.ic(38,"async"),w.Rb(39,"span",26),w.Wb(40,"span",23),w.Qc(41,"Save"),w.Vb(),w.Rb(42,"span",24),w.Vb(),w.Vb(),w.Vb()),2&e&&(w.oc("formGroup",t.form),w.Cb(3),w.oc("ngIf","driver"===(null==t.user?null:t.user.role)),w.Cb(1),w.oc("ngIf","admin"===(null==t.user?null:t.user.role)),w.Cb(1),w.oc("ngIf","driver"===(null==t.user?null:t.user.role)&&(!1===(null==w.jc(6,12,t.obj$)[0]?null:w.jc(6,12,t.obj$)[0].isAllowed)||"granted"!==(null==w.jc(7,14,t.obj$)[0]?null:w.jc(7,14,t.obj$)[0].permissions))),w.Cb(7),w.oc("ngIf","driver"!==t.user.role),w.Cb(2),w.oc("ngIf","driver"!==t.user.role),w.Cb(9),w.oc("ngIf",t.displayMessage.currentKM),w.Cb(1),w.oc("ngIf","driver"!==t.user.role&&t.attendanceID),w.Cb(1),w.oc("ngIf",t.isNeedUpdate||"driver"===t.user.role||!t.attendanceID),w.Cb(3),w.oc("uploadedFile",t.image)("limit",1),w.Cb(8),w.oc("disabled",!t.form.valid||!1===(null==w.jc(37,16,t.obj$)[0]?null:w.jc(37,16,t.obj$)[0].isAllowed)||"granted"!==(null==w.jc(38,18,t.obj$)[0]?null:w.jc(38,18,t.obj$)[0].permissions)&&"driver"===t.user.role))},directives:[C.y,C.r,C.i,p.g,k.m,g.b,v.a,p.e,h.c,h.g,b.b,C.c,C.q,C.g,x.a,p.c,o.a,c.a,k.l,N.i,h.b,d.a,C.t,n.a,s.j,h.h,n.b],pipes:[k.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:flex-end}"],changeDetection:0}),Object(V.__decorate)([Object(O.a)()],e.prototype,"blockUI",void 0),e})();var he=i("wd/R"),pe=i("DYbl"),me=i("/zas"),ve=i("YJ4X"),ge=i("VCSl"),fe=i("NAU6"),Ce=i("uNiC"),De=i("h1pn"),ye=i("7zfz");function ke(e,t){1&e&&w.Rb(0,"div",25)}function Ve(e,t){if(1&e&&(w.Wb(0,"div",25),w.Wb(1,"div",26),w.Wb(2,"div",27),w.Wb(3,"h5",28),w.Qc(4,"Check In"),w.Vb(),w.Rb(5,"i",29),w.Wb(6,"span",30),w.Wb(7,"span",31),w.Qc(8),w.ic(9,"date"),w.ic(10,"async"),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Vb()),2&e){const e=w.hc(2);w.Cb(8),w.Sc(" ",w.kc(9,1,null==w.jc(10,4,e.obj$)[0]?null:w.jc(10,4,e.obj$)[0].checkIn,"medium")," ")}}function Me(e,t){if(1&e&&(w.Wb(0,"div",25),w.Wb(1,"div",26),w.Wb(2,"div",27),w.Wb(3,"h5",28),w.Qc(4,"Check Out"),w.Vb(),w.Rb(5,"i",29),w.Wb(6,"span",30),w.Wb(7,"span",31),w.Qc(8),w.ic(9,"date"),w.ic(10,"async"),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Vb()),2&e){const e=w.hc(2);w.Cb(8),w.Sc(" ",w.kc(9,1,null==w.jc(10,4,e.obj$)[0]?null:w.jc(10,4,e.obj$)[0].checkOut,"medium")," ")}}function Ie(e,t){if(1&e&&(w.Wb(0,"div",2),w.Wb(1,"div",26),w.Wb(2,"div",27),w.Wb(3,"h5",28),w.Qc(4,"Duration"),w.Vb(),w.Rb(5,"i",29),w.Wb(6,"span",30),w.Wb(7,"span",31),w.Qc(8),w.ic(9,"async"),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Vb()),2&e){const e=w.hc(2);w.Cb(8),w.Sc(" ",(null==w.jc(9,1,e.obj$)[0]?null:w.jc(9,1,e.obj$)[0].duration)||" - "," ")}}function We(e,t){if(1&e){const e=w.Xb();w.Wb(0,"p-toolbar",21),w.Oc(1,ke,1,0,"div",22),w.Oc(2,Ve,11,6,"div",22),w.Oc(3,Me,11,6,"div",22),w.Oc(4,Ie,10,3,"div",23),w.Wb(5,"div",2),w.Wb(6,"button",24),w.ec("click",function(t){w.Ec(e);const i=w.hc();return i.add(t,0===i.currentDriver.length?"checkIn":"checkOut")}),w.ic(7,"async"),w.Vb(),w.Vb(),w.Vb()}if(2&e){const e=w.hc();w.Cb(1),w.oc("ngIf",0===e.currentDriver.length),w.Cb(1),w.oc("ngIf",e.currentDriver.length>0),w.Cb(1),w.oc("ngIf",e.currentDriver.length>0),w.Cb(1),w.oc("ngIf",e.currentDriver.length>0),w.Cb(2),w.Eb("p-button-sm shadow-none p-mr-2"),w.oc("disabled",2===e.currentDriver.length||!(null!=w.jc(7,8,e.obj$)[0]&&w.jc(7,8,e.obj$)[0].isApproved)&&e.currentDriver.length>0)("label",0===e.currentDriver.length?"Check In":"Check Out")}}let we=(()=>{class e{constructor(e,t,i,n,o,a,l,r,s,d,c,u,b){this.carService=e,this.sessionQuery=t,this.optionsQuery=i,this.optionsService=n,this.userService=o,this.refuelService=a,this.parkingService=l,this.attendanceService=r,this.dialogServices=s,this.dateAdapter=d,this.confirmationService=c,this.locationService=u,this.fun=b,this.caption="Attendance",this.columns=[],this.actions=[],this.toolBarActions=[{position:"right",action:[{label:"Locations",icon:"map-marker",color:"",tooltip:null}]},{position:"left",action:[{label:"Report",icon:"chart-bar",color:"",tooltip:null},{label:"Create",icon:"plus",color:"",tooltip:null}]}],this.dates=["monday","tuesday"],this.attendance=[],this.refuel=[],this.parking=[],this.locations$=[],this.currentDriver=[],this.range=new C.h({start:new C.f(null),end:new C.f(null)}),this.today=new Date,this.duration="day",this.groupedBy=[],this.tableType=[],this.user$=this.sessionQuery.select(e=>e.user),this.obj$=this.optionsQuery.selectAll(),this.userID=null,this.userTag=null,this.dialogConfig={width:"550px",formComponent:be,service:this.attendanceService},this.dialogConfigModal={closable:!0,formComponent:L.a},this.dialogConfigLocation={width:"95%",formComponent:X},this.dialogConfigReport={width:"95%",formComponent:M.a}}ngOnInit(){let e,t,i;this.user$.subscribe(e=>{this.role=null==e?void 0:e.role,"supervisor"===(null==e?void 0:e.role)?(this.actions=[],this.toolBarActions=[{position:"right",action:[{label:"Locations",icon:"map-marker",color:"",tooltip:null}]},{position:"left",action:[{label:"Report",icon:"chart-bar",color:"",tooltip:null}]}]):"driver"===(null==e?void 0:e.role)&&(this.toolBarActions=[{position:"right",action:[]},{position:"left",action:[{label:"Report",icon:"chart-bar",color:"",tooltip:null}]}],this.userID=null==e?void 0:e.tag),this.userTag=null==e?void 0:e.tag}),this.dateAdapter.setLocale("en-GB"),this.onColumnsChange({value:this.duration}),this.onDateChange(),this.cars$=e=this.carService.get(!0).snapshotChanges(),e.subscribe(e=>{this.cars=this.fun.extractData(e)}),i=this.locationService.get().snapshotChanges(),i.subscribe(e=>{const t=[];this.fun.extractData(e).map(e=>{var i;null===(i=null==e?void 0:e.drivers)||void 0===i||i.map(i=>{t.push({driverID:i,location:{latitude:null==e?void 0:e.latitude,longitude:e.longitude},radius:null==e?void 0:e.radius})})}),this.locations$=t}),this.users$=t=this.userService.get("driver").snapshotChanges(),t.subscribe(e=>{this.users=this.fun.extractData(e)})}add(e=null,t=""){this.dialogConfig.title="driver"===this.role?"Attendance":"New Attendance",this.dialogConfig.formData="",this.dialogConfig.lookupData={drivers:this.users$,daily:this.daily,locations:this.locations$},null!==e&&"checkOut"===t?(this.confirmationService.close(),this.confirmationService.confirm({target:null==e?void 0:e.target,message:"Are you sure you want to Check Out?",icon:"pi pi-exclamation-triangle",accept:()=>{this.dialogServices.handleDialog(this.dialogConfig)}})):this.dialogServices.handleDialog(this.dialogConfig)}update(e){he(new Date).toDate(),he(new Date).toDate(),this.dialogConfig.title="driver"===this.role?"Attendance":"Update Attendance",this.dialogConfig.formData=e,this.dialogConfig.lookupData={drivers:this.users$,daily:this.daily,locations:this.locations$},this.dialogServices.handleDialog(this.dialogConfig)}locations(){this.dialogServices.handleDialog(this.dialogConfigLocation)}report(){this.dialogConfigReport.title="attendance",this.dialogConfigReport.lookupData={duration:this.duration,groupedBy:this.groupedBy,tableType:this.tableType,range:this.range},this.dialogServices.handleDialog(this.dialogConfigReport)}getChangedData(){var e;(null===(e=this.range.value)||void 0===e?void 0:e.end)&&(this.attendance$=this.onDateChange())}onDateChange(){var e;if(null===(e=this.range.value)||void 0===e?void 0:e.end){let e;this.blockUI.start("Loading...");const{start:t,end:i}=this.range.value,n=he(t).toDate(),o=he(i).toDate();return he(t).subtract(1,"day").toDate(),this.refuelService.fitch({start:n,end:o,userID:this.userID}).snapshotChanges().subscribe(e=>{this.refuel$=this.fun.extractData(e)}),this.parkingService.fitch({start:n,end:o,userID:this.userID}).snapshotChanges().subscribe(e=>{this.parking$=this.fun.extractData(e)}),e=this.data=this.attendanceService.fitch({start:n,end:o,userID:this.userID}).snapshotChanges(),e.subscribe(e=>{var t;if(this.attendance=this.fun.extractData(e),this.blockUI.stop(),"day"===this.duration&&he(n).format("YYYY-MM-DD")===he().format("YYYY-MM-DD")&&(this.daily=this.attendance,this.userID)){const e=null===(t=this.daily)||void 0===t?void 0:t.filter(e=>e.driverID===this.userID);this.currentDriver=e,e.length>0&&this.observableTimer()}this.onGroupedByChange({value:this.groupedBy})}),e}return Object(P.a)([])}onTableChange(){var e;if((null===(e=this.groupedBy)||void 0===e?void 0:e.length)>0){this.refuel$=this.refuel$.map(e=>Object.assign(Object.assign({},e),{dates:he(e.date).format("YYYY-MM-DD"),travel:e.current_KM_On_Refuel-e.previous_KM_On_Refuel}));let e=this.fun.groupedBy(this.refuel$,this.groupedBy);this.refuel=e=this.onGrouping(e,"refuel"),this.parking$=this.parking$.map(e=>Object.assign(Object.assign({},e),{dates:he(e.date).format("YYYY-MM-DD")}));let t=this.fun.groupedBy(this.parking$,this.groupedBy);this.parking=t=this.onGrouping(t,"parking");let i=this.onCombine(e,t);i=this.onCombine(this.arrays,i);const n=this.groupedBy,o=2===n.length?"both":1===n.length&&n.includes("dates")?"date":1===n.length&&n.includes("driverID")?"driver":null;this.columns=this.onColumns(o),this.attendance$=Object(P.a)(i)}}onGrouping(e,t=""){return null==e?void 0:e.map(e=>{const i="parking"===t?{parking:this.fun.sumObjArr(null==e?void 0:e.items,"price"),parking_items:null==e?void 0:e.items}:{},n="refuel"===t?{refuel:this.fun.sumObjArr(null==e?void 0:e.items,"price"),refuel_items:null==e?void 0:e.items}:{};return Object.assign(Object.assign({driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:he(null==e?void 0:e.date).format("YYYY-MM-DD")},n),i)})}onGroupedByChange(e){var t;if((null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0){this.attendance=this.attendance.map(e=>Object.assign(Object.assign({},e),{dates:he(e.date).format("YYYY-MM-DD")}));const t=this.fun.groupedBy(this.attendance,e.value),i=this.mapping(t,e.value);this.refuel$=this.refuel$.map(e=>Object.assign(Object.assign({},e),{dates:he(e.date).format("YYYY-MM-DD"),travel:e.current_KM_On_Refuel-e.previous_KM_On_Refuel}));let n=this.fun.groupedBy(this.refuel$,e.value);n=this.onGrouping(n,"refuel"),this.parking$=this.parking$.map(e=>Object.assign(Object.assign({},e),{dates:he(e.date).format("YYYY-MM-DD")}));let o=this.fun.groupedBy(this.parking$,e.value);o=this.onGrouping(o,"parking");const a=this.groupedBy,l=2===a.length?"both":1===a.length&&a.includes("dates")?"date":1===a.length&&a.includes("driverID")?"driver":null;if(this.columns=this.onColumns(l),this.arrays=i,this.tableType.length>0){let e=n.length>=o.length?this.onCombine(n,o):this.onCombine(o,n);e=this.onCombine(i,e),this.attendance$=Object(P.a)(e)}else this.attendance$=Object(P.a)(i);this.actions=[]}else{this.columns=this.onColumns();const e=this.attendance.map(e=>Object.assign(Object.assign({},e),{dates:he(e.date).format("YYYY-MM-DD"),disable:e.isApproved,approve:e.isApproved?e.isApproved:e.isCanceled?"Canceled":"Pending"}));this.attendance$=Object(P.a)(e),"admin"===this.role?this.actions=[{icon:"pencil",color:"warning"},{icon:"times",color:"danger"},{icon:"check",color:""}]:"driver"===this.role&&(this.actions=[{icon:"pencil",color:"warning"}])}}onCombine(e,t){return e.map(e=>{const i=this.groupedBy,n=2===i.length?t.find(t=>(null==t?void 0:t.driverID)===(null==e?void 0:e.driverID)&&(null==t?void 0:t.dates)===(null==e?void 0:e.dates)):1===i.length&&i.includes("dates")?t.find(t=>(null==t?void 0:t.dates)===(null==e?void 0:e.dates)):1===i.length&&i.includes("driverID")?t.find(t=>(null==t?void 0:t.driverID)===(null==e?void 0:e.driverID)):null,o=(n.refuel||0)+(n.parking||0);return Object.assign(Object.assign(Object.assign({},e),n),{total:o})})}mapping(e,t){return null==e?void 0:e.map((e,i,n)=>{var o,a,l,r,s,d,c,u,b,h;const p=null===(o=null==e?void 0:e.items)||void 0===o?void 0:o.filter(e=>"check-in"===e.mode)[0],m=null===(a=null==e?void 0:e.items)||void 0===a?void 0:a.filter(e=>"check-out"===e.mode)[0],v=null===(r=null===(l=n[i-1])||void 0===l?void 0:l.items)||void 0===r?void 0:r.filter(e=>"check-out"===e.mode)[0],g=(null==m?void 0:m.currentKM)?new Date(null==m?void 0:m.date).getTime()/1e3-new Date(null==p?void 0:p.date).getTime()/1e3:(new Date).getTime()/1e3-new Date(null==p?void 0:p.date).getTime()/1e3,f=he.duration(Number(g),"seconds").days(),C=he.duration(Number(g),"seconds").hours(),D=he.duration(Number(g),"seconds").minutes(),y=he.duration(Number(g),"seconds").seconds(),k=parseFloat(null==m?void 0:m.currentKM)-parseFloat(null==p?void 0:p.currentKM),V=parseFloat(null==p?void 0:p.currentKM)-parseFloat(null==v?void 0:v.currentKM);let M=[],I="";return 0!==f?(M=[f],I="d"):0!==C?(M=[C<10?"0"+C:C,D<10?"0"+D:D],I=C>1?"hrs":"hr"):0!==D?(M=[D<10?"0"+D:D,y<10?"0"+y:y],I=D>1?"mins":"min"):0!==y&&(M=[D<10?"0"+D:D,y<10?"0"+y:y],I=C>1?"secs":"sec"),2===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:he(null==e?void 0:e.date).format("YYYY-MM-DD"),check_in_time:(null==p?void 0:p.date)||null,check_in_km:(null==p?void 0:p.currentKM)||"-",check_out_time:(null==m?void 0:m.date)||null,check_out_km:(null==m?void 0:m.currentKM)||"-",duration:M.join(":")+I,travel:(null==m?void 0:m.currentKM)?k+" km":"-",advance:V?V+" km":"-",count:e.items.length,items:e.items}:(null==t?void 0:t.includes("dates"))&&1===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:he(null==e?void 0:e.date).format("YYYY-MM-DD"),checkIn:null===(s=null==e?void 0:e.items)||void 0===s?void 0:s.filter(e=>"check-in"===e.mode).length,checkOut:null===(d=e.items)||void 0===d?void 0:d.filter(e=>"check-out"===e.mode).length,count:Math.max(null==e?void 0:e.items.filter(e=>"check-in"===e.mode).length,null===(c=e.items)||void 0===c?void 0:c.filter(e=>"check-out"===e.mode).length),items:null==e?void 0:e.items}:(null==t?void 0:t.includes("driverID"))&&1===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,dates:he(null==e?void 0:e.date).format("YYYY-MM-DD"),checkIn:null===(u=null==e?void 0:e.items)||void 0===u?void 0:u.filter(e=>"check-in"===e.mode).length,checkOut:null===(b=e.items)||void 0===b?void 0:b.filter(e=>"check-out"===e.mode).length,count:Math.max(null==e?void 0:e.items.filter(e=>"check-in"===e.mode).length,null===(h=e.items)||void 0===h?void 0:h.filter(e=>"check-out"===e.mode).length),items:null==e?void 0:e.items}:void 0})}onColumns(e=null){const t=this.tableType,i=2===t.length?[{label:"Refuel",name:"refuel",type:"link",sortable:!0},{label:"Parking",name:"parking",type:"link",sortable:!0},{label:"Total",name:"total",type:"price",sortable:!0}]:1===t.length&&t.includes("refuel")?[{label:"Refuel",name:"refuel",type:"link",sortable:!0}]:1===t.length&&t.includes("parking")?[{label:"Parking",name:"parking",type:"link",sortable:!0}]:[];if(null===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Type",name:"mode",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1},{label:"Status",name:"approve",type:"status",sortable:!0}];return"driver"===this.role&&e.shift(),e}if("both"===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In Time",name:"check_in_time",type:"mediumTime",sortable:!0},{label:"Check In KM",name:"check_in_km",sortable:!0},{label:"Check Out Time",name:"check_out_time",type:"mediumTime",sortable:!0},{label:"Check Out KM",name:"check_out_km",sortable:!0},{label:"Duration",name:"duration",sortable:!0},{label:"Travel",name:"travel",sortable:!0},{label:"Advance",name:"advance",sortable:!0},...i];return"driver"===this.role&&e.shift(),e}if("date"===e)return[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In",name:"checkIn",type:"link",sortable:!0},{label:"Check Out",name:"checkOut",type:"link",sortable:!0},{label:"Attendance",name:"count",type:"link",sortable:!0},...i];if("driver"===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Check In",name:"checkIn",type:"link",sortable:!0},{label:"Check Out",name:"checkOut",type:"link",sortable:!0},{label:"Attendance",name:"count",type:"link",sortable:!0},...i];return"driver"===this.role&&e.shift(),e}}onColumnsChange(e){if("isoWeek"===e.value||"month"===e.value||"day"===e.value){let t,i;const n=he().format("dddd").toLowerCase();i=this.dates.includes(n)&&"isoWeek"===e.value?he().subtract(1,"weeks").startOf("isoWeek").toDate():he().startOf(e.value).toDate(),t=he().endOf(e.value).toDate(),t=t>new Date?new Date:t,this.range.controls.start.patchValue(i),this.range.controls.end.patchValue(t)}}onActionClick(e){var t,i,n,o,a,l,r,s,d,c,u,b,h,p,m,v,g,f,C,D,y,k,M,I;if("pencil"===e.type)this.update(e.data);else if("times"===e.type)this.blockUI.start("Updating..."),this.attendanceService.update(e.data.id,{isCanceled:!0,isApproved:!1,approvedBy:null}).then(e=>{this.blockUI.stop()});else if("check"===e.type)this.blockUI.start("Updating..."),this.attendanceService.update(e.data.id,{isCanceled:!1,isApproved:!0,approvedBy:this.userTag}).then(e=>{this.blockUI.stop()});else if("trash"===e.type)this.blockUI.start("Deleting..."),this.attendanceService.delete(e.data.id).then(e=>{this.blockUI.stop()});else if("link"===e.type){let W,w;const O=this.groupedBy;if("checkIn"===e.position)W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],w=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.items)||void 0===i?void 0:i.filter(e=>"check-in"===e.mode),this.showModalTable("Check In - "+((null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.driverName)||(null===(a=null===(o=null==e?void 0:e.data)||void 0===o?void 0:o.date)||void 0===a?void 0:a.split("T")[0])),W,w);else if("checkOut"===e.position)W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],w=null===(r=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.items)||void 0===r?void 0:r.filter(e=>"check-out"===e.mode),this.showModalTable("Check Out - "+((null===(s=null==e?void 0:e.data)||void 0===s?void 0:s.driverName)||(null===(c=null===(d=null==e?void 0:e.data)||void 0===d?void 0:d.date)||void 0===c?void 0:c.split("T")[0])),W,w);else if("count"===e.position){W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In Time",name:"check_in_time",type:"mediumTime",sortable:!0},{label:"Check In KM",name:"check_in_km",sortable:!0},{label:"Check Out Time",name:"check_out_time",type:"mediumTime",sortable:!0},{label:"Check Out KM",name:"check_out_km",sortable:!0},{label:"Duration",name:"duration",sortable:!0},{label:"Travel",name:"travel",sortable:!0},{label:"Advance",name:"advance",sortable:!0}];const t=this.fun.groupedBy(null===(u=null==e?void 0:e.data)||void 0===u?void 0:u.items,["driverID","dates"]);w=this.mapping(t,["driverID","dates"]);const i=this.groupedBy,n=2===i.length?(null===(b=null==e?void 0:e.data)||void 0===b?void 0:b.driverName)+" - "+(null===(h=null==e?void 0:e.data)||void 0===h?void 0:h.dates):1===i.length&&i.includes("dates")?null===(p=null==e?void 0:e.data)||void 0===p?void 0:p.dates:1===i.length&&i.includes("driverID")?null===(m=null==e?void 0:e.data)||void 0===m?void 0:m.driverName:null;this.showModalTable("Attendance - "+n,W,w,"95%")}else if("driverName"===e.position){const t=null===(v=this.users)||void 0===v?void 0:v.filter(t=>{var i;return(null==t?void 0:t.id)===(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.driverID)}).map(e=>{var{name:t,phone:i,email:n,image:o,role:a}=e;return Object(V.__rest)(e,["name","phone","email","image","role"]),{name:t,phone:i,email:n,image:o,role:a}});if(t.length>0){const e=Object.keys(t[0]),i=this.fun.getColumns(e);this.showModalTable("Driver Info",i,t)}}else if("refuel"===e.position){W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Car",name:"plateNo",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1},{label:"Liter",name:"liter",sortable:!0},{label:"Previous KM",name:"previous_KM_On_Refuel",sortable:!0},{label:"Current KM",name:"current_KM_On_Refuel",sortable:!0},{label:"Travel",name:"travel",sortable:!0}];const t=null===(g=null==e?void 0:e.data)||void 0===g?void 0:g.refuel_items,i=this.groupedBy,n=2===i.length?"Refuel: "+(null===(f=null==e?void 0:e.data)||void 0===f?void 0:f.driverName):1===i.length&&i.includes("dates")?"Refuel: "+(null===(C=null==e?void 0:e.data)||void 0===C?void 0:C.dates):1===i.length&&i.includes("driverID")?"Refuel: "+(null===(D=null==e?void 0:e.data)||void 0===D?void 0:D.driverName):null;this.showModalTable(n,W,t)}else if("parking"===e.position){W=[O.includes("dates")&&1===O.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Car",name:"plateNo",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}];const t=null===(y=null==e?void 0:e.data)||void 0===y?void 0:y.parking_items,i=this.groupedBy,n=2===i.length?null===(k=null==e?void 0:e.data)||void 0===k?void 0:k.driverName:1===i.length&&i.includes("dates")?null===(M=null==e?void 0:e.data)||void 0===M?void 0:M.dates:1===i.length&&i.includes("driverID")?"Parking: "+(null===(I=null==e?void 0:e.data)||void 0===I?void 0:I.driverName):null;this.showModalTable(n,W,t,"1200px")}}}showModalTable(e,t,i,n="1000px"){this.dialogConfigModal.width=n,this.dialogConfigModal.lookupData={caption:e,columns:t,data:i},this.dialogServices.handleDialog(this.dialogConfigModal)}observableTimer(){Object(z.a)(0,1e3).subscribe(e=>{var t,i,n,o,a,l,r;const s=this.currentDriver.filter(e=>"check-in"===e.mode),d=this.currentDriver.filter(e=>"check-out"===e.mode);let c;c=(null==d?void 0:d.length)>0?new Date(null===(t=d[0])||void 0===t?void 0:t.date).getTime()/1e3-new Date(null===(i=s[0])||void 0===i?void 0:i.date).getTime()/1e3:(new Date).getTime()/1e3-new Date(null===(n=s[0])||void 0===n?void 0:n.date).getTime()/1e3;let u=[],b="";const h=he.duration(Number(c),"seconds").days(),p=he.duration(Number(c),"seconds").hours(),m=he.duration(Number(c),"seconds").minutes(),v=he.duration(Number(c),"seconds").seconds();0!==h?(u=[h],b="d"):0!==p?(u=[p<10?"0"+p:p,m<10?"0"+m:m],b=p>1?"hrs":"hr"):0!==m?(u=[m<10?"0"+m:m,v<10?"0"+v:v],b=m>1?"mins":"min"):0!==v&&(u=[m<10?"0"+m:m,v<10?"0"+v:v],b=p>1?"secs":"sec");const g={duration:(null==u?void 0:u.join(":"))+" "+b,checkIn:null===(o=s[0])||void 0===o?void 0:o.date,checkOut:(null==d?void 0:d.length)>0?null===(a=d[0])||void 0===a?void 0:a.date:(new Date).toISOString(),isApproved:(null==d?void 0:d.length)>0?null===(l=d[0])||void 0===l?void 0:l.isApproved:null===(r=s[0])||void 0===r?void 0:r.isApproved};this.optionsService.set({obj:g})})}onToolBarActionClick(e){"plus"===e?this.add():"map-marker"===e?this.locations():"chart-bar"===e&&this.report()}}return e.\u0275fac=function(t){return new(t||e)(w.Qb(pe.a),w.Qb(me.a),w.Qb(ve.a),w.Qb(ge.a),w.Qb(F.a),w.Qb(fe.a),w.Qb(Ce.a),w.Qb(De.a),w.Qb(G.a),w.Qb(N.a),w.Qb(ye.a),w.Qb(U.a),w.Qb(j.a))},e.\u0275cmp=w.Kb({type:e,selectors:[["app-attendance"]],decls:44,vars:20,consts:[[1,"card"],[1,"p-mb-2"],[1,"p-toolbar-group-left"],[1,"p-mr-3"],[3,"value","valueChange","selectionChange"],["value","day"],["value","isoWeek"],["value","month"],[1,"p-ml-3"],["multiple","",3,"value","valueChange","selectionChange"],["value","driverID"],["value","dates"],["value","refuel"],["value","parking"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date",3,"ngModelChange"],["matSuffix","",3,"for"],["picker",""],["class","p-mt-2",4,"ngIf"],[3,"caption","columns","data","actions","selectedColumns","first","rows","sortBy","toolBarActions","buttonClick","toolBarButtonClick"],[1,"p-mt-2"],["class","p-toolbar-group-right",4,"ngIf"],["class","p-toolbar-group-left",4,"ngIf"],["type","button","pButton","","pRipple","",3,"disabled","label","click"],[1,"p-toolbar-group-right"],[1,"product-list-item"],[1,"product-list-detail"],[1,"mb-2"],[1,"pi","pi-clock","product-category-icon"],[1,"product-category"],[1,"product-badge","status-instock"]],template:function(e,t){if(1&e&&(w.Wb(0,"div",0),w.Wb(1,"p-toolbar",1),w.Wb(2,"div",2),w.Wb(3,"mat-form-field",3),w.Wb(4,"mat-label"),w.Qc(5,"Duration"),w.Vb(),w.Wb(6,"mat-select",4),w.ec("valueChange",function(e){return t.duration=e})("selectionChange",function(e){return t.onColumnsChange(e)}),w.Wb(7,"mat-option",5),w.Qc(8,"Daily"),w.Vb(),w.Wb(9,"mat-option",6),w.Qc(10,"Weekly"),w.Vb(),w.Wb(11,"mat-option",7),w.Qc(12,"Monthly"),w.Vb(),w.Vb(),w.Vb(),w.Wb(13,"mat-form-field",8),w.Wb(14,"mat-label"),w.Qc(15,"Grouped By"),w.Vb(),w.Wb(16,"mat-select",9),w.ec("valueChange",function(e){return t.groupedBy=e})("selectionChange",function(e){return t.onGroupedByChange(e)}),w.Wb(17,"mat-option",10),w.Qc(18),w.Vb(),w.Wb(19,"mat-option",11),w.Qc(20,"Date"),w.Vb(),w.Vb(),w.Vb(),w.Vb(),w.Wb(21,"div",2),w.Wb(22,"mat-form-field",3),w.Wb(23,"mat-label"),w.Qc(24,"Contents"),w.Vb(),w.Wb(25,"mat-select",9),w.ec("valueChange",function(e){return t.tableType=e})("selectionChange",function(){return t.onTableChange()}),w.Wb(26,"mat-option",12),w.Qc(27,"Refuel"),w.Vb(),w.Wb(28,"mat-option",13),w.Qc(29,"Parking"),w.Vb(),w.Vb(),w.Vb(),w.Wb(30,"mat-form-field",8),w.Wb(31,"mat-label"),w.Qc(32,"Enter a date range"),w.Vb(),w.Wb(33,"mat-date-range-input",14),w.Rb(34,"input",15),w.Wb(35,"input",16),w.ec("ngModelChange",function(){return t.getChangedData()}),w.Vb(),w.Vb(),w.Wb(36,"mat-hint"),w.Qc(37,"DD/MM/YYYY \u2013 DD/MM/YYYY"),w.Vb(),w.Rb(38,"mat-datepicker-toggle",17),w.Rb(39,"mat-date-range-picker",null,18),w.Vb(),w.Vb(),w.Vb(),w.Oc(41,We,8,10,"p-toolbar",19),w.Vb(),w.Wb(42,"app-table-template",20),w.ec("buttonClick",function(e){return t.onActionClick(e)})("toolBarButtonClick",function(e){return t.onToolBarActionClick(e)}),w.ic(43,"async"),w.Vb()),2&e){const e=w.Bc(40);w.Cb(6),w.oc("value",t.duration),w.Cb(10),w.oc("value",t.groupedBy),w.Cb(2),w.Rc("driver"===t.role?"User":"Driver"),w.Cb(7),w.oc("value",t.tableType),w.Cb(8),w.oc("formGroup",t.range)("rangePicker",e)("max",t.today),w.Cb(5),w.oc("for",e),w.Cb(3),w.oc("ngIf","driver"===t.role),w.Cb(1),w.oc("caption",t.caption)("columns",t.columns)("data",w.jc(43,18,t.attendance$))("actions",t.actions)("selectedColumns",t.columns)("first",(null==t.currentPage?null:t.currentPage.first)||0)("rows",(null==t.currentPage?null:t.currentPage.rows)||10)("sortBy",t.sortBy)("toolBarActions",t.toolBarActions)}},directives:[a.a,h.c,h.g,c.a,N.i,s.d,C.r,C.i,s.l,C.c,C.q,C.g,s.k,h.f,s.j,h.h,s.e,k.m,E.a,g.b,v.a],pipes:[k.b,k.e],styles:["@media print{[_nghost-%COMP%]{display:none}}"],changeDetection:0}),Object(V.__decorate)([Object(O.a)()],e.prototype,"blockUI",void 0),e})();var Oe=i("tyNb");const je=[{path:"",component:we},{path:"**",redirectTo:""}];let Qe=(()=>{class e{}return e.\u0275mod=w.Ob({type:e}),e.\u0275inj=w.Nb({factory:function(t){return new(t||e)},imports:[[Oe.e.forChild(je)],Oe.e]}),e})(),Se=(()=>{class e{}return e.\u0275mod=w.Ob({type:e}),e.\u0275inj=w.Nb({factory:function(t){return new(t||e)},imports:[[k.c,Qe,y.a,D.f,C.k,C.v,f.b,g.c,v.b,a.b,o.b,n.e,n.c,m.a,p.f,h.e,b.c,u.b,c.b,d.b,s.i,r.a,l.a]]}),e})()}}]);