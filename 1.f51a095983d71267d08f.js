(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"7+5H":function(e,t,l){"use strict";l.d(t,"a",function(){return s});var o=l("0IaG"),i=l("fXoL"),n=l("WLRH"),a=l("ofXK");function r(e,t){if(1&e){const e=i.Xb();i.Wb(0,"button",9),i.ec("click",function(){return i.Ec(e),i.hc().onSave()}),i.Rb(1,"span",10),i.Wb(2,"span",6),i.Qc(3),i.Vb(),i.Rb(4,"span",7),i.Vb()}if(2&e){const e=i.hc();i.oc("disabled",0===e.data.length),i.Cb(3),i.Rc(e.button)}}let s=(()=>{class e{constructor(e){this.config=e,this.formSubmit=new i.o,this.modalAction=new i.o,this.formSave=new i.o,this.formClose=new i.o,this.columns=[],this.data=[],this.actions=[],this.toolBarActions=[],this.save=!0,this.isSaveMultiple=!1}ngOnInit(){var e,t,l,o,i,n,a,r,s,u,c,d,h,v;this.caption=null===(t=null===(e=this.config)||void 0===e?void 0:e.lookupData)||void 0===t?void 0:t.caption,this.button=null===(o=null===(l=this.config)||void 0===l?void 0:l.lookupData)||void 0===o?void 0:o.button,this.id=null===(n=null===(i=this.config)||void 0===i?void 0:i.lookupData)||void 0===n?void 0:n.id,this.columns=(null===(r=null===(a=this.config)||void 0===a?void 0:a.lookupData)||void 0===r?void 0:r.columns)||[],this.data=(null===(u=null===(s=this.config)||void 0===s?void 0:s.lookupData)||void 0===u?void 0:u.data)||[],this.actions=(null===(d=null===(c=this.config)||void 0===c?void 0:c.lookupData)||void 0===d?void 0:d.actions)||[],this.toolBarActions=(null===(v=null===(h=this.config)||void 0===h?void 0:h.lookupData)||void 0===v?void 0:v.toolBarActions)||[]}onActionClick(e){this.modalAction.emit(e),"trash"===e.type&&(this.data=this.data.filter(t=>t.id!==e.data.id))}onToolBarActionClick(e){}onCancel(){this.formClose.emit()}onSave(){"save"===this.button.toLowerCase()?this.formSave.emit(this.data):this.id&&"detail"===this.button.toLowerCase()&&this.formSave.emit(this.id)}}return e.\u0275fac=function(t){return new(t||e)(i.Qb(o.a))},e.\u0275cmp=i.Kb({type:e,selectors:[["app-model-table"]],inputs:{data:"data"},outputs:{formSubmit:"formSubmit",modalAction:"modalAction",formSave:"formSave",formClose:"formClose"},decls:11,vars:8,consts:[[1,"p-dialog-content",2,"overflow","hidden","overflow-x","auto"],[1,"capitalize",2,"font-size","large"],[3,"columns","data","isInModal","hasOrder","actions","toolBarActions","buttonClick","toolBarButtonClick"],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",2,"margin-bottom","0!important",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","icon","pi pi-check","class","p-button-text p-ripple p-button p-component shadow-none",3,"disabled","click",4,"ngIf"],["pbutton","","pripple","","icon","pi pi-check",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled","click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"]],template:function(e,t){1&e&&(i.Wb(0,"div",0),i.Wb(1,"div",1),i.Qc(2),i.Vb(),i.Wb(3,"app-table-template",2),i.ec("buttonClick",function(e){return t.onActionClick(e)})("toolBarButtonClick",function(e){return t.onToolBarActionClick(e)}),i.Vb(),i.Vb(),i.Wb(4,"div",3),i.Wb(5,"button",4),i.ec("click",function(){return t.onCancel()}),i.Rb(6,"span",5),i.Wb(7,"span",6),i.Qc(8,"Cancel"),i.Vb(),i.Rb(9,"span",7),i.Vb(),i.Oc(10,r,5,2,"button",8),i.Vb()),2&e&&(i.Cb(2),i.Sc("=> ",t.caption,""),i.Cb(1),i.oc("columns",t.columns)("data",t.data)("isInModal",!0)("hasOrder",!1)("actions",t.actions)("toolBarActions",t.toolBarActions),i.Cb(7),i.oc("ngIf",void 0!==t.button))},directives:[n.a,o.c,a.m],styles:[""]}),e})()},DYbl:function(e,t,l){"use strict";l.d(t,"a",function(){return r});var o=l("fXoL"),i=l("sSZD"),n=l("I/3d"),a=l("otk6");let r=(()=>{class e{constructor(e,t,l){this.db=e,this.firestore=t,this.fun=l,this.url="/cars"}get(e=!1){const t=""+this.url;return e?this.firestore.collection(t,t=>t.where("status","==",e)):this.firestore.collection(t)}add(e,t=null){var l;delete e.id;const o=[],i=""+this.url;if((null===(l=null==e?void 0:e.image)||void 0===l?void 0:l.length)>0)return e.image.forEach((l,n)=>this.fun.storeToFirebase(l,this.url).then(l=>{if(o.push(l),n+1===e.image.length)return e.image=o,e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()});n++}).catch(e=>{t.block.stop(),this.fun.notify("",e,1e4)}));e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()})}update(e,t,l=null){var o;delete t.id;let i=0;const n=[];return(null===(o=null==t?void 0:t.image)||void 0===o?void 0:o.length)>0?t.image.forEach((o,a)=>null==(null==o?void 0:o.url)?this.fun.storeToFirebase(o,this.url).then(o=>{if(n.push(o),i++,a+1===t.image.length)return t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()});a++}).catch(e=>{l.block.stop(),this.fun.notify("","Something error occur",3e3)}):(n.push(null==o?void 0:o.url),0===i?(t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})):void 0)):this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})}delete(e,t=null){return this.firestore.collection(this.url).doc(e).delete()}fitch(e){return this.firestore.collection(this.url).doc(e).collection(e+"s").snapshotChanges()}}return e.\u0275fac=function(t){return new(t||e)(o.ac(i.a),o.ac(n.a),o.ac(a.a))},e.\u0275prov=o.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},NAU6:function(e,t,l){"use strict";l.d(t,"a",function(){return r});var o=l("fXoL"),i=l("sSZD"),n=l("I/3d"),a=l("otk6");let r=(()=>{class e{constructor(e,t,l){this.db=e,this.firestore=t,this.fun=l,this.url="/refuel"}get(e=!1){const t=""+this.url;return e?this.firestore.collection(t,t=>t.where("status","==",e)):this.firestore.collection(t)}add(e,t=null){var l;delete e.id;const o=[],i=""+this.url;if((null===(l=null==e?void 0:e.image)||void 0===l?void 0:l.length)>0)return e.image.forEach((l,n)=>this.fun.storeToFirebase(l,this.url).then(l=>{if(o.push(l),n+1===e.image.length)return e.image=o,e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()});n++}).catch(e=>{t.block.stop(),this.fun.notify("",e,1e4)}));e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()})}update(e,t,l=null){var o;delete t.id;let i=0;const n=[];return(null===(o=null==t?void 0:t.image)||void 0===o?void 0:o.length)>0?t.image.forEach((o,a)=>null==(null==o?void 0:o.url)?this.fun.storeToFirebase(o,this.url).then(o=>{if(n.push(o),i++,a+1===t.image.length)return t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()});a++}).catch(e=>{l.block.stop(),this.fun.notify("","Something error occur",3e3)}):(n.push(null==o?void 0:o.url),0===i?(t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})):void 0)):this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})}delete(e,t=null){return this.firestore.collection(this.url).doc(e).delete()}fitch(e){const t=new Date(new Date(null==e?void 0:e.start).setHours(0,0,0,0)),l=new Date(new Date(null==e?void 0:e.end).setHours(23,59,59,59)),o=null==e?void 0:e.userID;return this.firestore.collection(this.url,o?e=>e.where("date",">",t).where("date","<=",l).where("driverID","==",o):e=>e.where("date",">",t).where("date","<=",l))}}return e.\u0275fac=function(t){return new(t||e)(o.ac(i.a),o.ac(n.a),o.ac(a.a))},e.\u0275prov=o.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},V5Mw:function(e,t,l){"use strict";l.d(t,"a",function(){return a});var o=l("fXoL"),i=l("I/3d"),n=l("otk6");let a=(()=>{class e{constructor(e,t){this.firestore=e,this.fun=t,this.url="/locations"}get(e=!1){const t=""+this.url;return e?this.firestore.collection(t,t=>t.where("status","==",e)):this.firestore.collection(t)}add(e,t=null){var l;delete e.id;const o=[],i=""+this.url;if((null===(l=null==e?void 0:e.image)||void 0===l?void 0:l.length)>0)return e.image.forEach((l,n)=>this.fun.storeToFirebase(l,this.url).then(l=>{if(o.push(l),n+1===e.image.length)return e.image=o,e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()});n++}).catch(e=>{t.block.stop(),this.fun.notify("",e,1e4)}));e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()})}update(e,t,l=null){var o;delete t.id;let i=0;const n=[];return(null===(o=null==t?void 0:t.image)||void 0===o?void 0:o.length)>0?t.image.forEach((o,a)=>null==(null==o?void 0:o.url)?this.fun.storeToFirebase(o,this.url).then(o=>{if(n.push(o),i++,a+1===t.image.length)return t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()});a++}).catch(e=>{l.block.stop(),this.fun.notify("","Something error occur",3e3)}):(n.push(null==o?void 0:o.url),0===i?(t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})):void 0)):this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})}delete(e,t=null){return this.firestore.collection(this.url).doc(e).delete()}fitch(e){const t=new Date(new Date(null==e?void 0:e.start).setHours(0,0,0,0)),l=new Date(new Date(null==e?void 0:e.end).setHours(23,59,59,59)),o=null==e?void 0:e.userID;return this.firestore.collection(this.url,o?e=>e.where("date",">",t).where("date","<",l).where("driverID","==",o):e=>e.where("date",">",t).where("date","<",l))}}return e.\u0275fac=function(t){return new(t||e)(o.ac(i.a),o.ac(n.a))},e.\u0275prov=o.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},YTlH:function(e,t,l){"use strict";l.d(t,"a",function(){return Q});var o=l("mrSG"),i=l("0IaG"),n=l("7+5H"),a=l("LRne"),r=l("3Pt+"),s=l("fXoL"),u=l("12jx"),c=l("wd/R"),d=l("DYbl"),h=l("/zas"),v=l("SRE/"),p=l("NAU6"),b=l("uNiC"),m=l("h1pn"),f=l("V5Mw"),g=l("H0VJ"),k=l("FKr1"),D=l("otk6"),C=l("5EWq"),y=l("ofXK"),I=l("kmnG"),w=l("d3UM"),M=l("jIHw"),O=l("Q4Mo"),_=l("WLRH"),W=l("iadO");function S(e,t){if(1&e){const e=s.Xb();s.Wb(0,"div",24),s.Wb(1,"mat-form-field",25),s.Wb(2,"mat-label"),s.Qc(3,"Category"),s.Vb(),s.Wb(4,"mat-select",5),s.ec("valueChange",function(t){return s.Ec(e),s.hc().category=t})("selectionChange",function(t){return s.Ec(e),s.hc().onUserChange(t)}),s.Wb(5,"mat-option",26),s.Qc(6,"All"),s.Vb(),s.Wb(7,"mat-option",27),s.Qc(8,"Admins"),s.Vb(),s.Wb(9,"mat-option",28),s.Qc(10,"Supervisor"),s.Vb(),s.Wb(11,"mat-option",8),s.Qc(12,"Drivers"),s.Vb(),s.Wb(13,"mat-option",29),s.Qc(14,"Members"),s.Vb(),s.Vb(),s.Vb(),s.Vb()}if(2&e){const e=s.hc();s.Cb(4),s.oc("value","driver")("value",e.category)}}function V(e,t){1&e&&(s.Wb(0,"mat-option",7),s.Qc(1,"Car"),s.Vb())}function N(e,t){if(1&e){const e=s.Xb();s.Wb(0,"mat-form-field",30),s.Wb(1,"mat-label"),s.Qc(2,"Contents"),s.Vb(),s.Wb(3,"mat-select",35),s.ec("valueChange",function(t){return s.Ec(e),s.hc(2).tableType=t})("selectionChange",function(){return s.Ec(e),s.hc(2).onContentChange()}),s.Wb(4,"mat-option",11),s.Qc(5,"Refuel"),s.Vb(),s.Wb(6,"mat-option",10),s.Qc(7,"Parking"),s.Vb(),s.Vb(),s.Vb()}if(2&e){const e=s.hc(2);s.Cb(3),s.oc("value",e.tableType)}}const T=function(e,t){return{"p-mb-2":e,"p-m-2":t}};function B(e,t){if(1&e){const e=s.Xb();s.Wb(0,"p-toolbar",2),s.Wb(1,"div",3),s.Wb(2,"mat-form-field",30),s.Wb(3,"mat-label"),s.Qc(4,"Duration"),s.Vb(),s.Wb(5,"mat-select",5),s.ec("valueChange",function(t){return s.Ec(e),s.hc().duration=t})("selectionChange",function(t){return s.Ec(e),s.hc().onColumnsChange(t)}),s.Wb(6,"mat-option",31),s.Qc(7,"Daily"),s.Vb(),s.Wb(8,"mat-option",32),s.Qc(9,"Weekly"),s.Vb(),s.Wb(10,"mat-option",33),s.Qc(11,"Monthly"),s.Vb(),s.Vb(),s.Vb(),s.Wb(12,"mat-form-field",34),s.Wb(13,"mat-label"),s.Qc(14,"Grouped By"),s.Vb(),s.Wb(15,"mat-select",35),s.ec("valueChange",function(t){return s.Ec(e),s.hc().groupedBy=t})("selectionChange",function(t){return s.Ec(e),s.hc().onGroupedByChange(t)}),s.Wb(16,"mat-option",36),s.Qc(17),s.Vb(),s.Oc(18,V,2,0,"mat-option",37),s.Wb(19,"mat-option",38),s.Qc(20,"Date"),s.Vb(),s.Vb(),s.Vb(),s.Vb(),s.Wb(21,"div",3),s.Oc(22,N,8,1,"mat-form-field",39),s.Wb(23,"mat-form-field",34),s.Wb(24,"mat-label"),s.Qc(25,"Enter a date range"),s.Vb(),s.Wb(26,"mat-date-range-input",40),s.Rb(27,"input",41),s.Wb(28,"input",42),s.ec("ngModelChange",function(){return s.Ec(e),s.hc().getChangedData()}),s.Vb(),s.Vb(),s.Wb(29,"mat-hint"),s.Qc(30,"DD/MM/YYYY \u2013 DD/MM/YYYY"),s.Vb(),s.Rb(31,"mat-datepicker-toggle",43),s.Rb(32,"mat-date-range-picker",null,44),s.Vb(),s.Vb(),s.Vb()}if(2&e){const e=s.Bc(33),t=s.hc();s.oc("ngClass",s.tc(10,T,!t.isInModal,t.isInModal)),s.Cb(5),s.oc("value",t.duration),s.Cb(10),s.oc("value",t.groupedBy),s.Cb(2),s.Rc("driver"===t.role?"User":"Driver"),s.Cb(1),s.oc("ngIf","attendance"!==t.reportFrom),s.Cb(4),s.oc("ngIf","attendance"===t.reportFrom),s.Cb(4),s.oc("formGroup",t.range)("rangePicker",e)("max",t.today),s.Cb(5),s.oc("for",e)}}const Y=function(e,t){return{"p-mb-0":e,"p-m-0":t}},F=function(e){return{"p-mr-3":e}},j=function(e){return{card:e}};let Q=(()=>{class e{constructor(e,t,l,o,i,a,u,c,d,h,v){var p,b,m,f,g,k;this.carService=e,this.sessionQuery=t,this.userService=l,this.refuelService=o,this.parkingService=i,this.attendanceService=a,this.locationService=u,this.dialogServices=c,this.dateAdapter=d,this.fun=h,this.config=v,this.formSubmit=new s.o,this.formClose=new s.o,this.caption="Report",this.columns=[],this.driverColumns=[],this.carColumns=[],this.actions=[],this.toolBarActions=[],this.dates=["monday","tuesday"],this.users=[],this.cars=[],this.refuel=[],this.parking=[],this.attendance=[],this.location=[],this.array=[],this.data=[],this.range=new r.h({start:new r.f(null),end:new r.f(null)}),this.today=new Date,this.duration="day",this.category="driver",this.groupedBy=[],this.tableType=[],this.user$=this.sessionQuery.select(e=>e.user),this.role=null,this.userTag=null,this.dialogConfigModal={closable:!0,formComponent:n.a},this.config.title?(this.reportFrom=this.config.title,this.category=(null===(p=this.config.lookupData)||void 0===p?void 0:p.category)||"driver",this.duration=(null===(b=this.config.lookupData)||void 0===b?void 0:b.duration)||"day",this.groupedBy=(null===(m=this.config.lookupData)||void 0===m?void 0:m.groupedBy)||[],this.tableType=(null===(f=this.config.lookupData)||void 0===f?void 0:f.tableType)||[],(null===(g=this.config.lookupData)||void 0===g?void 0:g.range)&&(this.range=null===(k=this.config.lookupData)||void 0===k?void 0:k.range),this.isInModal=!0):this.isInModal=!1}ngOnInit(){this.dateAdapter.setLocale("en-GB"),this.user$.subscribe(e=>{this.role=null==e?void 0:e.role,"supervisor"===(null==e?void 0:e.role)||"admin"===(null==e?void 0:e.role)||"driver"===(null==e?void 0:e.role)&&(this.userTag=null==e?void 0:e.tag)}),this.onTableChange({value:this.reportFrom})}onTableChange(e){"driver"===e.value?this.onUserChange({value:this.category}):"car"===e.value?this.onCarChange():"location"===e.value?this.onLocationLoaded():"attendance"!==e.value&&"refuel"!==e.value&&"parking"!==e.value||(this.onUserChange({value:"driver"}),this.onCarChange(),this.onDateChange(),this.onColumnsChange({value:this.duration}))}onUserChange(e){"driver"===this.reportFrom&&this.blockUI.start("Loading...");const t=null==e?void 0:e.value;let l;this.users$=l=this.userService.get("all"===t?null:t).snapshotChanges(),l.subscribe(e=>{this.users=this.fun.extractData(e),"driver"===this.reportFrom&&(this.blockUI.stop(),this.data=this.users)}),"driver"===this.reportFrom&&(this.columns=this.onColumns("driverCol"),this.report$=this.users$)}onCarChange(){let e;"car"===this.reportFrom&&this.blockUI.start("Loading..."),this.cars$=e=this.carService.get(!0).snapshotChanges(),e.subscribe(e=>{this.cars=this.fun.extractData(e),"car"===this.reportFrom&&(this.blockUI.stop(),this.data=this.cars)}),"car"===this.reportFrom&&(this.columns=this.onColumns("carCol"),this.report$=this.cars$)}onLocationLoaded(){let e;"location"===this.reportFrom&&this.blockUI.start("Loading..."),this.location$=e=this.locationService.get().snapshotChanges(),e.subscribe(e=>{if(this.location=this.fun.extractData(e),"location"===this.reportFrom){this.blockUI.stop(),this.data=this.location,this.columns=this.onColumns("location");const e=this.location.map(e=>Object.assign(Object.assign({},e),{driver:null==e?void 0:e.drivers.length}));this.report$=Object(a.a)(e)}else this.report$=this.location$})}getChangedData(){var e;(null===(e=this.range.value)||void 0===e?void 0:e.end)&&(this.report$=this.onDateChange())}onRefuelChange(){"refuel"===this.reportFrom&&this.blockUI.start("Loading...");const{start:e,end:t}=this.range.value,l=c(e).toDate(),o=c(t).toDate();let i;return this.refuel$=i=this.parkingService.fitch({start:l,end:o}).snapshotChanges(),i.subscribe(e=>{this.refuel=this.fun.extractData(e),"refuel"===this.reportFrom&&(this.blockUI.stop(),this.data=this.refuel,this.onGroupedByChange({value:this.groupedBy}))}),this.refuel$}onParkingChange(){"parking"===this.reportFrom&&this.blockUI.start("Loading...");const{start:e,end:t}=this.range.value,l=c(e).toDate(),o=c(t).toDate();let i;return this.parking$=i=this.parkingService.fitch({start:l,end:o}).snapshotChanges(),i.subscribe(e=>{this.parking=this.fun.extractData(e),"parking"===this.reportFrom&&(this.blockUI.stop(),this.data=this.parking,this.onGroupedByChange({value:this.groupedBy}))}),this.parking$}onAttendanceChange(){let e;"parking"===this.reportFrom&&this.blockUI.start("Loading...");const{start:t,end:l}=this.range.value,o=c(t).toDate(),i=c(l).toDate();return this.refuel$=this.refuelService.fitch({start:o,end:i,userID:this.userTag}).snapshotChanges().subscribe(e=>{this.refuel=this.fun.extractData(e)}),this.parking=this.parkingService.fitch({start:o,end:i,userID:this.userTag}).snapshotChanges().subscribe(e=>{this.parking=this.fun.extractData(e)}),e=this.attendance$=this.attendanceService.fitch({start:o,end:i,userID:this.userTag}).snapshotChanges(),e.subscribe(e=>{this.attendance=this.fun.extractData(e),this.blockUI.stop(),this.onGroupedByChange({value:this.groupedBy})}),e}onDateChange(){var e;if(null===(e=this.range.value)||void 0===e?void 0:e.end){if("refuel"===this.reportFrom)return this.onRefuelChange();if("parking"===this.reportFrom)return this.onParkingChange();if("attendance"===this.reportFrom)return this.onAttendanceChange()}return Object(a.a)([])}onGroupedByChange(e){var t;if((null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0){if("parking"===this.reportFrom){let t=this.parking;t=this.fun.groupedBy(t,e.value).map(e=>{var t;return{driverName:e.driverName,driverID:e.driverID,plateNo:e.plateNo,date:e.date,carID:e.carID,price:this.fun.sumObjArr(null==e?void 0:e.items,"price"),parkings:null===(t=e.items)||void 0===t?void 0:t.length,items:e.items}}),this.report$=Object(a.a)(t),this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Parkings",name:"parkings",type:"link",sortable:!0}],this.actions=[]}else if("refuel"===this.reportFrom){let t=this.refuel;const l=this.fun.groupedBy(t,e.value);t=null==l?void 0:l.map(e=>({driverName:e.driverName,driverID:e.driverID,plateNo:e.plateNo,date:e.date,carID:e.carID,price:this.fun.sumObjArr(null==e?void 0:e.items,"price"),refuels:e.items.length,items:e.items})),this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Refuels",name:"refuels",type:"link",sortable:!0}],this.report$=Object(a.a)(t),this.actions=[]}else if("attendance"===this.reportFrom){this.attendance=this.attendance.map(e=>Object.assign(Object.assign({},e),{dates:c(e.date).format("YYYY-MM-DD")}));const t=this.fun.groupedBy(this.attendance,e.value),l=this.mapping(t,e.value);this.refuel=this.refuel.map(e=>Object.assign(Object.assign({},e),{dates:c(e.date).format("YYYY-MM-DD"),travel:e.current_KM_On_Refuel-e.previous_KM_On_Refuel}));let o=this.fun.groupedBy(this.refuel,e.value);o=this.onGrouping(o,"refuel"),this.parking=this.parking.map(e=>Object.assign(Object.assign({},e),{dates:c(e.date).format("YYYY-MM-DD")}));let i=this.fun.groupedBy(this.parking,e.value);i=this.onGrouping(i,"parking");const n=this.groupedBy,r=2===n.length?"both":1===n.length&&n.includes("dates")?"date":1===n.length&&n.includes("driverID")?"driver":null;if(this.columns=this.onColumns(r),this.array=l,this.tableType.length>0){let e=o.length>=i.length?this.onCombine(o,i):this.onCombine(i,o);e=this.onCombine(l,e),this.report$=Object(a.a)(e)}else this.report$=Object(a.a)(l);this.actions=[]}}else if("parking"===this.reportFrom)this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"link",sortable:!0}],this.report$=this.parking$,this.actions=[];else if("refuel"===this.reportFrom)this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Liter",name:"liter",sortable:!0},{label:"Previous KM",name:"previous_KM_On_Refuel",sortable:!0},{label:"Current KM",name:"current_KM_On_Refuel",sortable:!0},{label:"Travel",name:"travel",sortable:!0}],this.refuel$.subscribe(e=>{const t=this.fun.extractData(e).map(e=>Object.assign(Object.assign({},e),{travel:e.current_KM_On_Refuel-e.previous_KM_On_Refuel}));this.report$=Object(a.a)(t)});else if("attendance"===this.reportFrom){this.columns=this.onColumns();const e=this.attendance.map(e=>Object.assign(Object.assign({},e),{dates:c(e.date).format("YYYY-MM-DD"),disable:e.isApproved,approve:e.isApproved?e.isApproved:e.isCanceled?"Canceled":"Pending"}));this.report$=Object(a.a)(e),this.actions=[]}}onCombine(e,t){return e.map(e=>{const l=this.groupedBy,o=2===l.length?t.find(t=>(null==t?void 0:t.driverID)===(null==e?void 0:e.driverID)&&(null==t?void 0:t.dates)===(null==e?void 0:e.dates)):1===l.length&&l.includes("dates")?t.find(t=>(null==t?void 0:t.dates)===(null==e?void 0:e.dates)):1===l.length&&l.includes("driverID")?t.find(t=>(null==t?void 0:t.driverID)===(null==e?void 0:e.driverID)):null,i=(o.refuel||0)+(o.parking||0);return Object.assign(Object.assign(Object.assign({},e),o),{total:i})})}mapping(e,t){return null==e?void 0:e.map((e,l,o)=>{var i,n,a,r,s,u,d,h,v,p;const b=null===(i=null==e?void 0:e.items)||void 0===i?void 0:i.filter(e=>"check-in"===e.mode)[0],m=null===(n=null==e?void 0:e.items)||void 0===n?void 0:n.filter(e=>"check-out"===e.mode)[0],f=null===(r=null===(a=o[l-1])||void 0===a?void 0:a.items)||void 0===r?void 0:r.filter(e=>"check-out"===e.mode)[0],g=(null==m?void 0:m.currentKM)?new Date(null==m?void 0:m.date).getTime()/1e3-new Date(null==b?void 0:b.date).getTime()/1e3:(new Date).getTime()/1e3-new Date(null==b?void 0:b.date).getTime()/1e3,k=c.duration(Number(g),"seconds").days(),D=c.duration(Number(g),"seconds").hours(),C=c.duration(Number(g),"seconds").minutes(),y=c.duration(Number(g),"seconds").seconds(),I=parseFloat(null==m?void 0:m.currentKM)-parseFloat(null==b?void 0:b.currentKM),w=parseFloat(null==b?void 0:b.currentKM)-parseFloat(null==f?void 0:f.currentKM);let M=[],O="";return 0!==k?(M=[k],O="d"):0!==D?(M=[D<10?"0"+D:D,C<10?"0"+C:C],O=D>1?"hrs":"hr"):0!==C?(M=[C<10?"0"+C:C,y<10?"0"+y:y],O=C>1?"mins":"min"):0!==y&&(M=[C<10?"0"+C:C,y<10?"0"+y:y],O=D>1?"secs":"sec"),2===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:c(null==e?void 0:e.date).format("YYYY-MM-DD"),check_in_time:(null==b?void 0:b.date)||null,check_in_km:(null==b?void 0:b.currentKM)||"-",check_out_time:(null==m?void 0:m.date)||null,check_out_km:(null==m?void 0:m.currentKM)||"-",duration:M.join(":")+O,travel:(null==m?void 0:m.currentKM)?I+" km":"-",advance:w?w+" km":"-",count:e.items.length,items:e.items}:(null==t?void 0:t.includes("dates"))&&1===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:c(null==e?void 0:e.date).format("YYYY-MM-DD"),checkIn:null===(s=null==e?void 0:e.items)||void 0===s?void 0:s.filter(e=>"check-in"===e.mode).length,checkOut:null===(u=e.items)||void 0===u?void 0:u.filter(e=>"check-out"===e.mode).length,count:Math.max(null==e?void 0:e.items.filter(e=>"check-in"===e.mode).length,null===(d=e.items)||void 0===d?void 0:d.filter(e=>"check-out"===e.mode).length),items:null==e?void 0:e.items}:(null==t?void 0:t.includes("driverID"))&&1===(null==t?void 0:t.length)?{driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,dates:c(null==e?void 0:e.date).format("YYYY-MM-DD"),checkIn:null===(h=null==e?void 0:e.items)||void 0===h?void 0:h.filter(e=>"check-in"===e.mode).length,checkOut:null===(v=e.items)||void 0===v?void 0:v.filter(e=>"check-out"===e.mode).length,count:Math.max(null==e?void 0:e.items.filter(e=>"check-in"===e.mode).length,null===(p=e.items)||void 0===p?void 0:p.filter(e=>"check-out"===e.mode).length),items:null==e?void 0:e.items}:void 0})}onGrouping(e,t=""){return null==e?void 0:e.map(e=>{const l="parking"===t?{parking:this.fun.sumObjArr(null==e?void 0:e.items,"price"),parking_items:null==e?void 0:e.items}:{},o="refuel"===t?{refuel:this.fun.sumObjArr(null==e?void 0:e.items,"price"),refuel_items:null==e?void 0:e.items}:{};return Object.assign(Object.assign({driverName:null==e?void 0:e.driverName,driverID:null==e?void 0:e.driverID,date:null==e?void 0:e.date,dates:c(null==e?void 0:e.date).format("YYYY-MM-DD")},o),l)})}onColumns(e=null){const t=this.tableType,l=2===t.length?[{label:"Refuel",name:"refuel",type:"link",sortable:!0},{label:"Parking",name:"parking",type:"link",sortable:!0},{label:"Total",name:"total",type:"price",sortable:!0}]:1===t.length&&t.includes("refuel")?[{label:"Refuel",name:"refuel",type:"link",sortable:!0}]:1===t.length&&t.includes("parking")?[{label:"Parking",name:"parking",type:"link",sortable:!0}]:[];if(null===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Type",name:"mode",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0},{label:"Status",name:"approve",type:"status",sortable:!0}];return"driver"===this.role&&e.shift(),e}if("both"===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In Time",name:"check_in_time",type:"mediumTime",sortable:!0},{label:"Check In KM",name:"check_in_km",sortable:!0},{label:"Check Out Time",name:"check_out_time",type:"mediumTime",sortable:!0},{label:"Check Out KM",name:"check_out_km",sortable:!0},{label:"Duration",name:"duration",sortable:!0},{label:"Travel",name:"travel",sortable:!0},{label:"Advance",name:"advance",sortable:!0},...l];return"driver"===this.role&&e.shift(),e}if("date"===e)return[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In",name:"checkIn",type:"link",sortable:!0},{label:"Check Out",name:"checkOut",type:"link",sortable:!0},{label:"Attendance",name:"count",type:"link",sortable:!0},...l];if("driver"===e){const e=[{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Check In",name:"checkIn",type:"link",sortable:!0},{label:"Check Out",name:"checkOut",type:"link",sortable:!0},{label:"Attendance",name:"count",type:"link",sortable:!0},...l];return"driver"===this.role&&e.shift(),e}return"driverCol"===e?[{label:"Name",name:"name",sortable:!0},{label:"Email",name:"email",type:"email",sortable:!0},{label:"Phone",name:"phone",type:"phone",sortable:!0},{label:"Role",name:"role",sortable:!0},{label:"Access",name:"disabled",type:"status",sortable:!0}]:"carCol"===e?[{label:"Plate No",name:"plateNo",sortable:!0},{label:"Brand",name:"brand",sortable:!0},{label:"Model",name:"model",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Status",name:"status",type:"status",sortable:!0}]:"location"===e?[{label:"Place",name:"place",sortable:!0},{label:"Latitude",name:"latitude",type:"price",sortable:!0},{label:"Longitude",name:"longitude",type:"price",sortable:!0},{label:"Drivers",name:"driver",type:"link",sortable:!0},{label:"Range",name:"range",type:"price",sortable:!0}]:void 0}onColumnsChange(e){if("isoWeek"===e.value||"month"===e.value||"day"===e.value){let t,l;const o=c().format("dddd").toLowerCase();l=this.dates.includes(o)&&"isoWeek"===e.value?c().subtract(1,"weeks").startOf("isoWeek").toDate():c().startOf(e.value).toDate(),t=c().endOf(e.value).toDate(),t=t>new Date?new Date:t,this.range.controls.start.patchValue(l),this.range.controls.end.patchValue(t)}}onContentChange(){var e;if((null===(e=this.groupedBy)||void 0===e?void 0:e.length)>0){this.refuel=this.refuel.map(e=>Object.assign(Object.assign({},e),{dates:c(e.date).format("YYYY-MM-DD"),travel:e.current_KM_On_Refuel-e.previous_KM_On_Refuel}));let e=this.fun.groupedBy(this.refuel,this.groupedBy);this.refuel=e=this.onGrouping(e,"refuel"),this.parking=this.parking.map(e=>Object.assign(Object.assign({},e),{dates:c(e.date).format("YYYY-MM-DD")}));let t=this.fun.groupedBy(this.parking,this.groupedBy);this.parking=t=this.onGrouping(t,"parking");let l=this.onCombine(e,t);l=this.onCombine(this.array,l);const o=this.groupedBy,i=2===o.length?"both":1===o.length&&o.includes("dates")?"date":1===o.length&&o.includes("driverID")?"driver":null;this.columns=this.onColumns(i),this.report$=Object(a.a)(l)}}onActionClick(e){var t,l,i,n,a,r,s,u,c,d,h,v,p,b,m,f,g,k,D,C,y,I,w,M,O,_;if("link"===e.type){let W,S;const V=this.groupedBy;if("checkIn"===e.position)W=[V.includes("dates")&&1===V.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0}],S=null===(l=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.items)||void 0===l?void 0:l.filter(e=>"check-in"===e.mode),this.showModalTable("Check In - "+((null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.driverName)||(null===(a=null===(n=null==e?void 0:e.data)||void 0===n?void 0:n.date)||void 0===a?void 0:a.split("T")[0])),W,S);else if("checkOut"===e.position)W=[V.includes("dates")&&1===V.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Time",name:"date",type:"mediumTime",sortable:!0},{label:"KM",name:"currentKM",sortable:!0}],S=null===(s=null===(r=null==e?void 0:e.data)||void 0===r?void 0:r.items)||void 0===s?void 0:s.filter(e=>"check-out"===e.mode),this.showModalTable("Check Out - "+((null===(u=null==e?void 0:e.data)||void 0===u?void 0:u.driverName)||(null===(d=null===(c=null==e?void 0:e.data)||void 0===c?void 0:c.date)||void 0===d?void 0:d.split("T")[0])),W,S);else if("count"===e.position){W=[V.includes("dates")&&1===V.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Check In Time",name:"check_in_time",type:"mediumTime",sortable:!0},{label:"Check In KM",name:"check_in_km",sortable:!0},{label:"Check Out Time",name:"check_out_time",type:"mediumTime",sortable:!0},{label:"Check Out KM",name:"check_out_km",sortable:!0},{label:"Duration",name:"duration",sortable:!0},{label:"Travel",name:"travel",sortable:!0},{label:"Advance",name:"advance",sortable:!0}];const t=this.fun.groupedBy(null===(h=null==e?void 0:e.data)||void 0===h?void 0:h.items,["driverID","dates"]);S=this.mapping(t,["driverID","dates"]);const l=this.groupedBy,o=2===l.length?(null===(v=null==e?void 0:e.data)||void 0===v?void 0:v.driverName)+" - "+(null===(p=null==e?void 0:e.data)||void 0===p?void 0:p.dates):1===l.length&&l.includes("dates")?null===(b=null==e?void 0:e.data)||void 0===b?void 0:b.dates:1===l.length&&l.includes("driverID")?null===(m=null==e?void 0:e.data)||void 0===m?void 0:m.driverName:null;this.showModalTable("Attendance - "+o,W,S,"95%")}else if("driverName"===e.position||"driver"===e.position){let t;if(t="driver"===e.position?null===(f=this.users)||void 0===f?void 0:f.filter(t=>{var l,o;return null===(o=null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.drivers)||void 0===o?void 0:o.includes(null==t?void 0:t.id)}).map(e=>{var{name:t,phone:l,email:i,role:n}=e;return Object(o.__rest)(e,["name","phone","email","image","role"]),{name:t,phone:l,email:i,role:n}}):null===(g=this.users)||void 0===g?void 0:g.filter(t=>{var l;return(null==t?void 0:t.id)===(null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.driverID)}).map(e=>{var{name:t,phone:l,email:i,role:n}=e;return Object(o.__rest)(e,["name","phone","email","image","role"]),{name:t,phone:l,email:i,role:n}}),t.length>0){const e=Object.keys(t[0]),l=this.fun.getColumns(e);this.showModalTable("Driver Info",l,t)}}else if("refuels"===e.position||"refuel"===e.position){W=[V.includes("dates")&&1===V.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Car",name:"plateNo",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Liter",name:"liter",sortable:!0},{label:"Previous KM",name:"previous_KM_On_Refuel",sortable:!0},{label:"Current KM",name:"current_KM_On_Refuel",sortable:!0},{label:"Travel",name:"travel",sortable:!0}];const t=null===(k=null==e?void 0:e.data)||void 0===k?void 0:k.refuel_items,l=this.groupedBy,o=2===l.length?"Refuel: "+(null===(D=null==e?void 0:e.data)||void 0===D?void 0:D.driverName):1===l.length&&l.includes("dates")?"Refuel: "+(null===(C=null==e?void 0:e.data)||void 0===C?void 0:C.dates):1===l.length&&l.includes("driverID")?"Refuel: "+(null===(y=null==e?void 0:e.data)||void 0===y?void 0:y.driverName):null;this.showModalTable(o,W,t)}else if("parkings"===e.position||"parking"===e.position){W=[V.includes("dates")&&1===V.length?{label:"Driver",name:"driverName",sortable:!0}:{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Car",name:"plateNo",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0}];const t=null===(I=null==e?void 0:e.data)||void 0===I?void 0:I.parking_items,l=this.groupedBy,o=2===l.length?null===(w=null==e?void 0:e.data)||void 0===w?void 0:w.driverName:1===l.length&&l.includes("dates")?null===(M=null==e?void 0:e.data)||void 0===M?void 0:M.dates:1===l.length&&l.includes("driverID")?"Parking: "+(null===(O=null==e?void 0:e.data)||void 0===O?void 0:O.driverName):null;this.showModalTable(o,W,t,"1200px")}else if("price"===e.position){const t=this.fun.getColumns(["time","place","price"]);this.showModalTable("Prices",t,null===(_=e.data)||void 0===_?void 0:_.prices)}else"plateNo"===e.position&&this.cars$.subscribe(t=>{const l=this.fun.extractData(t).filter(t=>{var l;return(null==t?void 0:t.id)===(null===(l=null==e?void 0:e.data)||void 0===l?void 0:l.carID)}).map(e=>{var{plateNo:t,brand:l,model:i,driverName:n,status:a,company:r}=e;return Object(o.__rest)(e,["plateNo","brand","model","driverName","image","status","company"]),{plateNo:t,brand:l,model:i,driverName:n,status:a,company:r}});if(l.length>0){const e=Object.keys(l[0]),t=this.fun.getColumns(e);this.showModalTable("Car Info",t,S)}})}}showModalTable(e,t,l,o="1000px"){this.dialogConfigModal.width=o,this.dialogConfigModal.lookupData={caption:e,columns:t,data:l},this.dialogServices.handleDialog(this.dialogConfigModal)}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(s.Qb(d.a),s.Qb(h.a),s.Qb(v.a),s.Qb(p.a),s.Qb(b.a),s.Qb(m.a),s.Qb(f.a),s.Qb(g.a),s.Qb(k.a),s.Qb(D.a),s.Qb(i.a))},e.\u0275cmp=s.Kb({type:e,selectors:[["app-report"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:39,vars:28,consts:[["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title","capitalize"],[3,"ngClass"],[1,"p-toolbar-group-left"],[1,"full-width",3,"ngClass"],[3,"value","valueChange","selectionChange"],["value","attendance"],["value","car"],["value","driver"],["value","location"],["value","parking"],["value","refuel"],["class","p-toolbar-group-left p-ml-3",4,"ngIf"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[3,"ngClass",4,"ngIf"],[3,"caption","columns","data","isInModal","hasOrder","actions","selectedColumns","first","rows","sortBy","toolBarActions","buttonClick"],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"],[1,"p-toolbar-group-left","p-ml-3"],[1,"full-width"],["value","all"],["value","admin"],["value","supervisor"],["value","member"],[1,"p-mr-3"],["value","day"],["value","isoWeek"],["value","month"],[1,"p-ml-3"],["multiple","",3,"value","valueChange","selectionChange"],["value","driverID"],["value","car",4,"ngIf"],["value","dates"],["class","p-mr-3",4,"ngIf"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date",3,"ngModelChange"],["matSuffix","",3,"for"],["picker",""]],template:function(e,t){1&e&&(s.Wb(0,"div",0),s.Wb(1,"div",1),s.Qc(2),s.Vb(),s.Wb(3,"p-toolbar",2),s.Wb(4,"div",3),s.Wb(5,"mat-form-field",4),s.Wb(6,"mat-label"),s.Qc(7,"Tables"),s.Vb(),s.Wb(8,"mat-select",5),s.ec("valueChange",function(e){return t.reportFrom=e})("selectionChange",function(e){return t.onTableChange(e)}),s.Wb(9,"mat-option",6),s.Qc(10,"Attendance"),s.Vb(),s.Wb(11,"mat-option",7),s.Qc(12,"Car"),s.Vb(),s.Wb(13,"mat-option",8),s.Qc(14,"Driver"),s.Vb(),s.Wb(15,"mat-option",9),s.Qc(16,"Location"),s.Vb(),s.Wb(17,"mat-option",10),s.Qc(18,"Parking"),s.Vb(),s.Wb(19,"mat-option",11),s.Qc(20,"Refuel"),s.Vb(),s.Vb(),s.Vb(),s.Vb(),s.Oc(21,S,15,2,"div",12),s.Vb(),s.Wb(22,"button",13),s.ec("click",function(){return t.onCancel()}),s.Vb(),s.Vb(),s.Wb(23,"div",14),s.Wb(24,"div",2),s.Oc(25,B,34,13,"p-toolbar",15),s.Vb(),s.Wb(26,"app-table-template",16),s.ec("buttonClick",function(e){return t.onActionClick(e)}),s.ic(27,"async"),s.Vb(),s.Vb(),s.Wb(28,"div",17),s.Wb(29,"button",18),s.ec("click",function(){return t.onCancel()}),s.Rb(30,"span",19),s.Wb(31,"span",20),s.Qc(32,"Cancel"),s.Vb(),s.Rb(33,"span",21),s.Vb(),s.Wb(34,"button",22),s.Rb(35,"span",23),s.Wb(36,"span",20),s.Qc(37,"Export"),s.Vb(),s.Rb(38,"span",21),s.Vb(),s.Vb()),2&e&&(s.Cb(2),s.Sc("",t.reportFrom," Report"),s.Cb(1),s.oc("ngClass",s.tc(21,Y,!t.isInModal,t.isInModal)),s.Cb(2),s.oc("ngClass",s.sc(24,F,"driver"===t.reportFrom)),s.Cb(3),s.oc("value",t.reportFrom),s.Cb(13),s.oc("ngIf","driver"===t.reportFrom),s.Cb(3),s.oc("ngClass",s.sc(26,j,!t.isInModal)),s.Cb(1),s.oc("ngIf","driver"!==t.reportFrom&&"car"!==t.reportFrom&&"location"!==t.reportFrom),s.Cb(1),s.oc("caption",t.caption)("columns",t.columns)("data",s.jc(27,19,t.report$))("isInModal",t.isInModal)("hasOrder",!1)("actions",t.actions)("selectedColumns",t.columns)("first",(null==t.currentPage?null:t.currentPage.first)||0)("rows",(null==t.currentPage?null:t.currentPage.rows)||10)("sortBy",t.sortBy)("toolBarActions",t.toolBarActions),s.Cb(8),s.oc("disabled",t.data.length<=0))},directives:[i.g,C.a,y.k,I.c,I.g,w.a,k.i,y.m,M.b,O.a,i.e,_.a,i.c,W.d,r.r,r.i,W.l,r.c,r.q,r.g,W.k,I.f,W.j,I.h,W.e],pipes:[y.b],styles:[""]}),Object(o.__decorate)([Object(u.a)()],e.prototype,"blockUI",void 0),e})()},h1pn:function(e,t,l){"use strict";l.d(t,"a",function(){return r});var o=l("fXoL"),i=l("sSZD"),n=l("I/3d"),a=l("otk6");let r=(()=>{class e{constructor(e,t,l){this.db=e,this.firestore=t,this.fun=l,this.url="/attendance"}get(e=!1){const t=""+this.url;return e?this.firestore.collection(t,t=>t.where("status","==",e)):this.firestore.collection(t)}add(e,t=null){var l;delete e.id;const o=[],i=""+this.url;if((null===(l=null==e?void 0:e.image)||void 0===l?void 0:l.length)>0)return e.image.forEach((l,n)=>this.fun.storeToFirebase(l,this.url).then(l=>{if(o.push(l),n+1===e.image.length)return e.image=o,e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()});n++}).catch(e=>{t.block.stop(),this.fun.notify("",e,1e4)}));e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()})}update(e,t,l=null){var o;delete t.id;let i=0;const n=[];return(null===(o=null==t?void 0:t.image)||void 0===o?void 0:o.length)>0?t.image.forEach((o,a)=>null==(null==o?void 0:o.url)?this.fun.storeToFirebase(o,this.url).then(o=>{if(n.push(o),i++,a+1===t.image.length)return t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()});a++}).catch(e=>{l.block.stop(),this.fun.notify("","Something error occur",3e3)}):(n.push(null==o?void 0:o.url),0===i?(t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})):void 0)):this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})}delete(e,t=null){return this.firestore.collection(this.url).doc(e).delete()}fitch(e){const t=new Date(new Date(null==e?void 0:e.start).setHours(0,0,0,0)),l=new Date(new Date(null==e?void 0:e.end).setHours(23,59,59,59)),o=null==e?void 0:e.userID;return this.firestore.collection(this.url,o?e=>e.where("date",">",t).where("date","<",l).where("driverID","==",o):e=>e.where("date",">",t).where("date","<",l))}}return e.\u0275fac=function(t){return new(t||e)(o.ac(i.a),o.ac(n.a),o.ac(a.a))},e.\u0275prov=o.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},uNiC:function(e,t,l){"use strict";l.d(t,"a",function(){return r});var o=l("fXoL"),i=l("sSZD"),n=l("I/3d"),a=l("otk6");let r=(()=>{class e{constructor(e,t,l){this.db=e,this.firestore=t,this.fun=l,this.url="/parking"}get(e=!1){const t=""+this.url;return e?this.firestore.collection(t,t=>t.where("status","==",e)):this.firestore.collection(t)}add(e,t=null){var l;delete e.id;const o=[],i=""+this.url;if((null===(l=null==e?void 0:e.image)||void 0===l?void 0:l.length)>0)return e.image.forEach((l,n)=>this.fun.storeToFirebase(l,this.url).then(l=>{if(o.push(l),n+1===e.image.length)return e.image=o,e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()});n++}).catch(e=>{t.block.stop(),this.fun.notify("",e,1e4)}));e.created_at=(new Date).toISOString(),this.firestore.collection(i).add(e).then(e=>{var l;null==t||t.ref.close(),null===(l=null==t?void 0:t.block)||void 0===l||l.stop()}).catch(e=>{var l;null===(l=null==t?void 0:t.block)||void 0===l||l.stop()})}update(e,t,l=null){var o;delete t.id;let i=0;const n=[];return(null===(o=null==t?void 0:t.image)||void 0===o?void 0:o.length)>0?t.image.forEach((o,a)=>null==(null==o?void 0:o.url)?this.fun.storeToFirebase(o,this.url).then(o=>{if(n.push(o),i++,a+1===t.image.length)return t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()});a++}).catch(e=>{l.block.stop(),this.fun.notify("","Something error occur",3e3)}):(n.push(null==o?void 0:o.url),0===i?(t.image=n,this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})):void 0)):this.firestore.collection(this.url).doc(e).update(t).then(e=>{var t;null==l||l.ref.close(),null===(t=null==l?void 0:l.block)||void 0===t||t.stop()}).catch(e=>{var t;null===(t=null==l?void 0:l.block)||void 0===t||t.stop()})}delete(e,t=null){return this.firestore.collection(this.url).doc(e).delete()}fitch(e){const t=new Date(new Date(null==e?void 0:e.start).setHours(0,0,0,0)),l=new Date(new Date(null==e?void 0:e.end).setHours(23,59,59,59)),o=null==e?void 0:e.userID;return this.firestore.collection(this.url,o?e=>e.where("date",">",t).where("date","<=",l).where("driverID","==",o):e=>e.where("date",">",t).where("date","<=",l))}}return e.\u0275fac=function(t){return new(t||e)(o.ac(i.a),o.ac(n.a),o.ac(a.a))},e.\u0275prov=o.Mb({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);