(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{MYyV:function(e,t,i){"use strict";i.r(t),i.d(t,"ParkingModule",function(){return ae});var a=i("5EWq"),o=i("Xa2L"),n=i("/1cH"),r=i("iadO"),l=i("1jcm"),s=i("d3UM"),c=i("NFeN"),d=i("qFsG"),u=i("kmnG"),b=i("0IaG"),p=i("V5BG"),m=i("Q4Mo"),h=i("jIHw"),f=i("7kUa"),g=i("3Pt+"),v=i("rEr+"),C=i("PCNd"),D=i("n1FK"),y=i("ofXK"),k=i("mrSG"),V=i("YTlH"),W=i("LRne"),w=i("7+5H"),I=i("nnAt"),M=i("fXoL"),Q=i("otk6"),x=i("FKr1");function S(e,t){if(1&e&&(M.Wb(0,"mat-error",8),M.Qc(1),M.Vb()),2&e){const e=M.hc();M.Cb(1),M.Rc(e.displayMessage.price)}}let O=(()=>{class e{constructor(e,t,i,a){var o,n,r,l,s,c;this.fb=e,this.fun=t,this.dateAdapter=i,this.config=a,this.formSubmit=new M.o,this.formSave=new M.o,this.formClose=new M.o,this.isUpdate=!1,this.displayMessage={},this.dateAdapter.setLocale("en-GB"),this.isUpdate=!!(null===(o=this.config.formData)||void 0===o?void 0:o.price),this.day=(null===(n=this.config.formData)||void 0===n?void 0:n.day)||new Date,this.min=new Date(new Date(this.day).setHours(0,0,0,0)),this.max=new Date(new Date(this.day).setHours(23,59,59,59)),this.form=this.fb.group({id:null===(r=this.config.formData)||void 0===r?void 0:r.id,price:[null===(l=this.config.formData)||void 0===l?void 0:l.price,g.x.required],time:(null===(s=this.config.formData)||void 0===s?void 0:s.time)||this.day,place:null===(c=this.config.formData)||void 0===c?void 0:c.place}),this.validationMessages={price:{required:"field is required."}},this.genericValidator=new I.a(this.validationMessages)}ngOnInit(){this.form.valueChanges.subscribe(()=>this.displayMessage=this.genericValidator.processMessages(this.form))}blur(){this.displayMessage=this.genericValidator.processMessages(this.form)}keyDown(e,t){return e.key?this.fun.allowedKey(e.key,t):(e.target.value=this.fun.removeNotAllowedKey(e.target.value,t),!0)}getFile(e){this.form.controls.image.setValue((null==e?void 0:e.upload.length)>0?null==e?void 0:e.upload:[])}onSubmit(){this.formSave.emit({data:this.form.value,update:this.isUpdate})}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(M.Qb(g.e),M.Qb(Q.a),M.Qb(x.a),M.Qb(b.a))},e.\u0275cmp=M.Kb({type:e,selectors:[["app-parking-prices"]],outputs:{formSubmit:"formSubmit",formSave:"formSave",formClose:"formClose"},decls:39,vars:13,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title","capitalize"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12","p-md-6"],[1,"full-width"],[1,"error"],["matInput","","tabindex","0","type","text","value","","formControlName","price",3,"blur","input","keydown"],["class","error",4,"ngIf"],["matInput","","formControlName","time","readonly","",3,"ngxMatDatetimePicker","min","max"],["matSuffix","",3,"for"],[3,"showSeconds","stepHour","stepMinute","stepSecond","enableMeridian"],["picker",""],[1,"p-col-12"],["matInput","","tabindex","0","type","text","value","","formControlName","place",3,"blur","input","keydown"],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"]],template:function(e,t){if(1&e&&(M.Wb(0,"form",0),M.ec("submit",function(){return t.onSubmit()}),M.Wb(1,"div",1),M.Wb(2,"div",2),M.Qc(3),M.Vb(),M.Wb(4,"button",3),M.ec("click",function(){return t.onCancel()}),M.Vb(),M.Vb(),M.Wb(5,"div",4),M.Wb(6,"div",5),M.Wb(7,"div",6),M.Wb(8,"mat-form-field",7),M.Wb(9,"mat-label"),M.Qc(10,"Price"),M.Wb(11,"span",8),M.Qc(12,"*"),M.Vb(),M.Vb(),M.Wb(13,"input",9),M.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"price")})("keydown",function(e){return t.keyDown(e,"price")}),M.Vb(),M.Oc(14,S,2,1,"mat-error",10),M.Vb(),M.Vb(),M.Wb(15,"div",6),M.Wb(16,"mat-form-field",7),M.Wb(17,"mat-label"),M.Qc(18,"Time"),M.Vb(),M.Rb(19,"input",11),M.Rb(20,"mat-datepicker-toggle",12),M.Rb(21,"ngx-mat-datetime-picker",13,14),M.Vb(),M.Vb(),M.Wb(23,"div",15),M.Wb(24,"mat-form-field",7),M.Wb(25,"mat-label"),M.Qc(26,"Place"),M.Vb(),M.Wb(27,"textarea",16),M.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"text")})("keydown",function(e){return t.keyDown(e,"text")}),M.Vb(),M.Vb(),M.Vb(),M.Vb(),M.Vb(),M.Wb(28,"div",17),M.Wb(29,"button",18),M.ec("click",function(){return t.onCancel()}),M.Rb(30,"span",19),M.Wb(31,"span",20),M.Qc(32,"Cancel"),M.Vb(),M.Rb(33,"span",21),M.Vb(),M.Wb(34,"button",22),M.Rb(35,"span",23),M.Wb(36,"span",20),M.Qc(37,"Save"),M.Vb(),M.Rb(38,"span",21),M.Vb(),M.Vb(),M.Vb()),2&e){const e=M.Bc(22);M.oc("formGroup",t.form),M.Cb(3),M.Rc(t.config.title),M.Cb(11),M.oc("ngIf",t.displayMessage.price),M.Cb(5),M.oc("ngxMatDatetimePicker",e)("min",t.min)("max",t.max),M.Cb(1),M.oc("for",e),M.Cb(1),M.oc("showSeconds",!0)("stepHour",1)("stepMinute",1)("stepSecond",1)("enableMeridian",!0),M.Cb(13),M.oc("disabled",!t.form.valid)}},directives:[g.y,g.r,g.i,b.g,h.b,m.a,b.e,u.c,u.g,d.b,g.c,g.q,g.g,y.m,D.a,r.j,u.h,D.b,b.c,u.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}"]}),e})();var N=i("4ZtF"),R=i("12jx"),B=i("/vft"),P=i("H28f"),j=i("H0VJ"),A=i("WLRH"),q=i("xivw");function $(e,t){if(1&e&&(M.Wb(0,"mat-error",8),M.Qc(1),M.Vb()),2&e){const e=M.hc();M.Cb(1),M.Sc("",e.displayMessage.date," ")}}function G(e,t){if(1&e&&(M.Wb(0,"mat-error",8),M.Qc(1),M.Vb()),2&e){const e=M.hc();M.Cb(1),M.Sc("",e.displayMessage.price," ")}}function F(e,t){if(1&e&&(M.Wb(0,"mat-option",31),M.Wb(1,"span",32),M.Wb(2,"b"),M.Qc(3),M.Vb(),M.Vb(),M.Rb(4,"br"),M.Wb(5,"small",32),M.Qc(6),M.Vb(),M.Rb(7,"br"),M.Vb()),2&e){const e=t.$implicit;M.oc("value",e.id),M.Cb(3),M.Rc(e.plateNo),M.Cb(3),M.Rc(" "+e.brand+" - "+e.model)}}function Y(e,t){if(1&e&&(M.Wb(0,"mat-error",8),M.Qc(1),M.Vb()),2&e){const e=M.hc();M.Cb(1),M.Rc(e.displayMessage.carID)}}function _(e,t){if(1&e&&(M.Wb(0,"mat-option",31),M.Wb(1,"span",32),M.Qc(2),M.Vb(),M.Vb()),2&e){const e=t.$implicit;M.oc("value",e.id),M.Cb(2),M.Rc(e.name)}}function H(e,t){if(1&e&&(M.Wb(0,"mat-error",8),M.Qc(1),M.Vb()),2&e){const e=M.hc();M.Cb(1),M.Rc(e.displayMessage.driverID)}}const L=function(){return[]};let U=(()=>{class e{constructor(e,t,i,a,o,n,r){var l,s,c,d,u,b,p,m,h,f,v,C,D,y,k,V,W,w,Q,x;this.fb=e,this.fun=t,this.fieldsQuery=i,this.fieldService=a,this.dialogServices=o,this.dateAdapter=n,this.config=r,this.formSubmit=new M.o,this.formClose=new M.o,this.drivers=[],this.cars=[],this.columns=["time","place","price"],this.actions=[{icon:"pencil",color:"warning",disable:!1},{icon:"trash",color:"danger"}],this.isPublished=!0,this.prices=[],this.prices$=this.fieldsQuery.selectAll(),this.dialogConfig={width:"450px",formComponent:O},this.displayMessage={},this.dateAdapter.setLocale("en-GB"),this.image=Object(N.k)(null===(l=this.config.formData)||void 0===l?void 0:l.image)?null===(s=this.config.formData)||void 0===s?void 0:s.image:Object(N.p)(null===(c=this.config.formData)||void 0===c?void 0:c.image)?[null===(d=this.config.formData)||void 0===d?void 0:d.image]:Object(N.q)(null===(u=this.config.formData)||void 0===u?void 0:u.image)?[null===(b=this.config.formData)||void 0===b?void 0:b.image]:[],null===(m=null===(p=this.config.lookupData)||void 0===p?void 0:p.drivers)||void 0===m||m.subscribe(e=>{this.drivers=this.fun.extractData(e)}),null===(f=null===(h=this.config.lookupData)||void 0===h?void 0:h.cars)||void 0===f||f.subscribe(e=>{this.cars=this.fun.extractData(e)}),this.prices=(null===(v=this.config.formData)||void 0===v?void 0:v.prices)||[],this.fieldService.set(this.prices),this.isPublished=void 0===(null===(C=this.config.formData)||void 0===C?void 0:C.status)||(null===(D=this.config.formData)||void 0===D?void 0:D.status),this.form=this.fb.group({id:null===(y=this.config.formData)||void 0===y?void 0:y.id,date:[(null===(k=this.config.formData)||void 0===k?void 0:k.date)?new Date(null===(V=this.config.formData)||void 0===V?void 0:V.date):(new Date).toISOString(),[g.x.required,g.x.maxLength]],price:[null===(W=this.config.formData)||void 0===W?void 0:W.price,g.x.required],prices:this.prices,driverID:[null===(w=this.config.formData)||void 0===w?void 0:w.driverID,g.x.required],carID:[null===(Q=this.config.formData)||void 0===Q?void 0:Q.carID,g.x.required],image:this.image,created_at:null===(x=this.config.formData)||void 0===x?void 0:x.created_at}),this.validationMessages={driverID:{required:"field is required."},date:{required:"field is required.",maxLength:"date can't be pass current date"},price:{required:"field is required."},carID:{required:"field is required."}},this.genericValidator=new I.a(this.validationMessages)}ngOnInit(){this.prices$.subscribe(e=>{this.prices=e,e.length>0?(this.form.controls.price.patchValue(this.fun.sumObjArr(this.prices,"price")||null),this.form.controls.prices.patchValue(this.prices)):this.form.controls.price.patchValue(null)}),this.columns=this.fun.getColumns(this.columns),this.today=new Date,this.form.valueChanges.subscribe(()=>this.displayMessage=this.genericValidator.processMessages(this.form))}add(){var e;this.dialogConfig.title="New Parking Price",this.dialogConfig.formData={id:this.prices.length+1,day:null===(e=this.form.value)||void 0===e?void 0:e.date};const t=this.dialogServices.handleDialog(this.dialogConfig);this.handleModalChange(t)}update(e){var t;this.dialogConfig.title="Edit Parking Price",this.dialogConfig.formData=Object.assign(Object.assign({},e),{day:null===(t=this.form.value)||void 0===t?void 0:t.date});const i=this.dialogServices.handleDialog(this.dialogConfig);this.handleModalChange(i)}handleModalChange(e){var t;null===(t=e.componentInstance)||void 0===t||t.formSave.subscribe(t=>{var i;t.update?this.fieldService.update(t.data):(null===(i=null==t?void 0:t.data)||void 0===i?void 0:i.price)&&this.fieldService.add(t.data),e.close()})}blur(){this.displayMessage=this.genericValidator.processMessages(this.form)}keyDown(e,t){return e.key?this.fun.allowedKey(e.key,t):(e.target.value=this.fun.removeNotAllowedKey(e.target.value,t),!0)}onClick(){this.add()}onActionClick(e){"pencil"===e.type?this.update(e.data):"trash"===e.type&&(this.prices=this.prices.filter(t=>t.id!==e.data.id),this.fieldService.delete(e.data.id))}onChange(e,t="car"){var i,a;if("car"===t){const t=null===(i=this.cars.filter(t=>t.id===e.value)[0])||void 0===i?void 0:i.driverID;this.form.controls.driverID.patchValue(t||null)}else{const t=null===(a=this.cars.filter(t=>t.driverID===e.value)[0])||void 0===a?void 0:a.id;null===this.form.value.carID&&this.form.controls.carID.patchValue(t||null)}}setValidation(e=null){this.form.controls.plateNo.setErrors({found:!0}),this.displayMessage=this.genericValidator.processMessages(this.form)}getFile(e){this.form.controls.image.setValue((null==e?void 0:e.upload.length)>0?null==e?void 0:e.upload:[])}onSubmit(){var e,t,i;const a=this.form.value,o=null===(e=this.drivers)||void 0===e?void 0:e.filter(e=>e.id===a.driverID)[0],n=null===(t=this.cars)||void 0===t?void 0:t.filter(e=>e.id===a.carID)[0],r=(null==a?void 0:a.date)?new Date(null==a?void 0:a.date):null,l=Object.assign(Object.assign({},a),{driverName:null===(i=null==o?void 0:o.name)||void 0===i?void 0:i.split(" ")[0],plateNo:null==n?void 0:n.plateNo,prices:this.prices,date:r});this.formSubmit.emit(l)}onCancel(){this.formClose.emit()}}return e.\u0275fac=function(t){return new(t||e)(M.Qb(g.e),M.Qb(Q.a),M.Qb(B.a),M.Qb(P.a),M.Qb(j.a),M.Qb(x.a),M.Qb(b.a))},e.\u0275cmp=M.Kb({type:e,selectors:[["app-parking-form"]],outputs:{formSubmit:"formSubmit",formClose:"formClose"},decls:68,vars:27,consts:[["autocomplete","off",3,"formGroup","submit"],["mat-dialog-title","",1,"p-dialog-header","p-d-flex","p-jc-lg-between",2,"padding","0.2re 0.3rem"],[1,"p-dialog-title","capitalize"],["pButton","","pRipple","","icon","pi pi-times",1,"shadow-none","p-button-rounded","p-button-plain","p-button-text","p-mr-1",3,"click"],["mat-dialog-content","",1,"p-dialog-content"],[1,"p-grid"],[1,"p-col-12","p-md-6"],[1,"full-width"],[1,"error"],["matInput","","formControlName","date",3,"matDatepicker","max","blur"],["matSuffix","",3,"for"],["dp3",""],["class","error",4,"ngIf"],["readonly","","matInput","","tabindex","0","type","text","value","","formControlName","price",3,"blur","input","keydown"],["price",""],["placeholder","choose car","formControlName","carID",3,"selectionChange","closed"],[3,"value",4,"ngFor","ngForOf"],["placeholder","choose driver","formControlName","driverID",3,"selectionChange","closed"],[1,"p-col-12"],[1,"buttons"],["pButton","","pRipple","","type","button","label","Add Price",3,"disabled","icon","click"],[3,"columns","data","isInModal","hasOrder","actions","toolBarActions","buttonClick"],[3,"uploadedFile","limit","fileDropped"],["fileImage",""],["mat-dialog-actions","",1,"p-dialog-footer","button-row"],["pbutton","","pripple","","label","Cancel","type","button","icon","pi pi-times",1,"p-button-text","p-ripple","p-button","p-component","shadow-none","p-mr-2",3,"click"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-times"],[1,"p-button-label"],[1,"p-ink"],["pbutton","","pripple","","label","Save","icon","pi pi-check","type","submit",1,"p-button-text","p-ripple","p-button","p-component","shadow-none",3,"disabled"],["aria-hidden","true",1,"p-button-icon","p-button-icon-left","pi","pi-check"],[3,"value"],[1,"capitalize"]],template:function(e,t){if(1&e&&(M.Wb(0,"form",0),M.ec("submit",function(){return t.onSubmit()}),M.Wb(1,"div",1),M.Wb(2,"div",2),M.Qc(3),M.Vb(),M.Wb(4,"button",3),M.ec("click",function(){return t.onCancel()}),M.Vb(),M.Vb(),M.Wb(5,"div",4),M.Wb(6,"div",5),M.Wb(7,"div",6),M.Wb(8,"mat-form-field",7),M.Wb(9,"mat-label"),M.Qc(10,"Date"),M.Wb(11,"span",8),M.Qc(12,"*"),M.Vb(),M.Vb(),M.Wb(13,"input",9),M.ec("blur",function(){return t.blur()}),M.Vb(),M.Wb(14,"mat-hint"),M.Qc(15,"MM/DD/YYYY"),M.Vb(),M.Rb(16,"mat-datepicker-toggle",10),M.Rb(17,"mat-datepicker",null,11),M.Oc(19,$,2,1,"mat-error",12),M.Vb(),M.Vb(),M.Wb(20,"div",6),M.Wb(21,"mat-form-field",7),M.Wb(22,"mat-label"),M.Qc(23,"Price"),M.Wb(24,"span",8),M.Qc(25,"*"),M.Vb(),M.Vb(),M.Wb(26,"input",13,14),M.ec("blur",function(){return t.blur()})("input",function(e){return t.keyDown(e,"price")})("keydown",function(e){return t.keyDown(e,"price")}),M.Vb(),M.Oc(28,G,2,1,"mat-error",12),M.Vb(),M.Vb(),M.Wb(29,"div",6),M.Wb(30,"mat-form-field",7),M.Wb(31,"mat-label"),M.Qc(32,"Car"),M.Wb(33,"span",8),M.Qc(34,"*"),M.Vb(),M.Vb(),M.Wb(35,"mat-select",15),M.ec("selectionChange",function(e){return t.onChange(e,"car")})("closed",function(){return t.blur()}),M.Oc(36,F,8,3,"mat-option",16),M.Vb(),M.Oc(37,Y,2,1,"mat-error",12),M.Vb(),M.Vb(),M.Wb(38,"div",6),M.Wb(39,"mat-form-field",7),M.Wb(40,"mat-label"),M.Qc(41,"Driver"),M.Wb(42,"span",8),M.Qc(43,"*"),M.Vb(),M.Vb(),M.Wb(44,"mat-select",17),M.ec("selectionChange",function(e){return t.onChange(e,"driver")})("closed",function(){return t.blur()}),M.Oc(45,_,3,2,"mat-option",16),M.Vb(),M.Oc(46,H,2,1,"mat-error",12),M.Vb(),M.Vb(),M.Wb(47,"div",18),M.Wb(48,"div",7),M.Wb(49,"div",19),M.Wb(50,"button",20),M.ec("click",function(){return t.onClick()}),M.Vb(),M.Vb(),M.Wb(51,"app-table-template",21),M.ec("buttonClick",function(e){return t.onActionClick(e)}),M.ic(52,"async"),M.Vb(),M.Vb(),M.Vb(),M.Wb(53,"div",18),M.Wb(54,"div",7),M.Wb(55,"app-file-upload-template",22,23),M.ec("fileDropped",function(e){return t.getFile(e)}),M.Vb(),M.Vb(),M.Vb(),M.Vb(),M.Vb(),M.Wb(57,"div",24),M.Wb(58,"button",25),M.ec("click",function(){return t.onCancel()}),M.Rb(59,"span",26),M.Wb(60,"span",27),M.Qc(61,"Cancel"),M.Vb(),M.Rb(62,"span",28),M.Vb(),M.Wb(63,"button",29),M.Rb(64,"span",30),M.Wb(65,"span",27),M.Qc(66,"Save"),M.Vb(),M.Rb(67,"span",28),M.Vb(),M.Vb(),M.Vb()),2&e){const e=M.Bc(18);M.oc("formGroup",t.form),M.Cb(3),M.Rc(t.config.title),M.Cb(10),M.oc("matDatepicker",e)("max",t.today),M.Cb(3),M.oc("for",e),M.Cb(3),M.oc("ngIf",t.displayMessage.date),M.Cb(9),M.oc("ngIf",t.displayMessage.price),M.Cb(8),M.oc("ngForOf",t.cars),M.Cb(1),M.oc("ngIf",t.displayMessage.carID),M.Cb(8),M.oc("ngForOf",t.drivers),M.Cb(1),M.oc("ngIf",t.displayMessage.driverID),M.Cb(4),M.Eb("p-button-sm shadow-none p-mr-2"),M.oc("disabled",!(null!=t.form&&null!=t.form.value&&t.form.value.date))("icon","pi pi-plus"),M.Cb(1),M.oc("columns",t.columns)("data",M.jc(52,24,t.prices$))("isInModal",!0)("hasOrder",!1)("actions",t.actions)("toolBarActions",M.rc(26,L)),M.Cb(4),M.oc("uploadedFile",t.image)("limit",10),M.Cb(8),M.oc("disabled",!t.form.valid)}},directives:[g.y,g.r,g.i,b.g,h.b,m.a,b.e,u.c,u.g,d.b,g.c,r.g,g.q,g.g,u.f,r.j,u.h,r.f,y.m,s.a,y.l,A.a,q.a,b.c,u.b,x.i],pipes:[y.b],styles:[".example-section[_ngcontent-%COMP%]{display:flex;align-content:center;align-items:center;height:60px}.buttons[_ngcontent-%COMP%]{display:flex;width:100%;justify-content:flex-end}"],changeDetection:0}),Object(k.__decorate)([Object(R.a)()],e.prototype,"blockUI",void 0),e})();var E=i("wd/R"),K=i("DYbl"),T=i("/zas"),z=i("SRE/"),J=i("uNiC"),X=i("sSZD");let Z=(()=>{class e{constructor(e,t,i,a,o,n,r,l){this.carService=e,this.sessionQuery=t,this.userService=i,this.parkingService=a,this.dialogServices=o,this.dateAdapter=n,this.db=r,this.fun=l,this.caption="Parking",this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"link",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],this.actions=[{icon:"pencil",color:"warning",disable:!1}],this.toolBarActions=[{position:"right",action:[]},{position:"left",action:[{label:"Report",icon:"chart-bar",color:"",tooltip:null},{label:"Create",icon:"plus",color:"",tooltip:null}]}],this.dates=["monday","tuesday"],this.range=new g.h({start:new g.f(null),end:new g.f(null)}),this.today=new Date,this.duration="day",this.groupedBy=[],this.user$=this.sessionQuery.select(e=>e.user),this.dialogConfig={width:"600px",formComponent:U,service:this.parkingService},this.dialogConfigModal={closable:!0,formComponent:w.a},this.dialogConfigReport={width:"95%",formComponent:V.a}}ngOnInit(){let e,t;this.user$.subscribe(e=>{this.role=null==e?void 0:e.role,"supervisor"===(null==e?void 0:e.role)&&(this.actions=[],this.toolBarActions=[{position:"right",action:[]},{position:"left",action:[{label:"Report",icon:"chart-bar",color:"",tooltip:null}]}])}),this.dateAdapter.setLocale("en-GB"),this.onColumnsChange({value:this.duration}),this.onDateChange(),this.cars$=e=this.carService.get(!0).snapshotChanges(),e.subscribe(e=>this.cars=this.fun.extractData(e)),this.users$=t=this.userService.get("driver").snapshotChanges(),t.subscribe(e=>this.users=this.fun.extractData(e))}add(){this.dialogConfig.title="New Parking",this.dialogConfig.formData="",this.dialogConfig.lookupData={drivers:this.users$,cars:this.cars$},this.dialogServices.handleDialog(this.dialogConfig)}update(e){this.dialogConfig.title="Edit Parking Info",this.dialogConfig.formData=e,this.dialogConfig.lookupData={drivers:this.users$,cars:this.cars$},this.dialogServices.handleDialog(this.dialogConfig)}report(){this.dialogConfigReport.title="parking",this.dialogConfigReport.lookupData={duration:this.duration,groupedBy:this.groupedBy,range:this.range},this.dialogServices.handleDialog(this.dialogConfigReport)}getChangedData(){var e;(null===(e=this.range.value)||void 0===e?void 0:e.end)&&(this.parking$=this.onDateChange())}onDateChange(){var e;if(null===(e=this.range.value)||void 0===e?void 0:e.end){let e;this.blockUI.start("Loading...");const{start:t,end:i}=this.range.value,a=E(t).toDate(),o=E(i).toDate();return e=this.data=this.parkingService.fitch({start:a,end:o}).snapshotChanges(),e.subscribe(e=>{this.parking=this.fun.extractData(e),this.blockUI.stop(),this.onGroupedByChange({value:this.groupedBy})}),e}return Object(W.a)([])}onGroupedByChange(e){var t;if((null===(t=null==e?void 0:e.value)||void 0===t?void 0:t.length)>0){let t=this.parking;t=this.fun.groupedBy(t,e.value).map(e=>{var t;return{driverName:e.driverName,driverID:e.driverID,plateNo:e.plateNo,date:e.date,carID:e.carID,price:this.fun.sumObjArr(null==e?void 0:e.items,"price"),count:null===(t=e.items)||void 0===t?void 0:t.length,items:e.items}}),this.parking$=Object(W.a)(t),this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Parkings",name:"count",type:"link",sortable:!0}],this.actions=[]}else this.columns=[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Price",name:"price",type:"link",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],this.parking$=this.data,this.actions=[{icon:"pencil",color:"warning",disable:!1}]}onColumnsChange(e){if("isoWeek"===e.value||"month"===e.value||"day"===e.value){let t,i;const a=E().format("dddd").toLowerCase();i=this.dates.includes(a)&&"isoWeek"===e.value?E().subtract(1,"weeks").startOf("isoWeek").toDate():E().startOf(e.value).toDate(),t=E().endOf(e.value).toDate(),t=t>new Date?new Date:t,this.range.controls.start.patchValue(i),this.range.controls.end.patchValue(t)}}onActionClick(e){var t;if("pencil"===e.type)this.update(e.data);else if("trash"===e.type)this.blockUI.start("Deleting..."),this.parkingService.delete(e.data.id).then(this.blockUI.stop());else if("link"===e.type)if("driverName"===e.position)this.users$.subscribe(t=>{const i=this.fun.extractData(t).filter(t=>{var i;return(null==t?void 0:t.id)===(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.driverID)}).map(e=>{var{name:t,phone:i,email:a,image:o,role:n}=e;return Object(k.__rest)(e,["name","phone","email","image","role"]),{name:t,phone:i,email:a,image:o,role:n}});if(i.length>0){const e=Object.keys(i[0]),t=this.fun.getColumns(e);this.showModalTable("Driver Info",t,i)}});else if("plateNo"===e.position)this.cars$.subscribe(t=>{const i=this.fun.extractData(t).filter(t=>{var i;return(null==t?void 0:t.id)===(null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.carID)}).map(e=>{var{plateNo:t,brand:i,model:a,driverName:o,image:n,status:r,company:l}=e;return Object(k.__rest)(e,["plateNo","brand","model","driverName","image","status","company"]),{plateNo:t,brand:i,model:a,driverName:o,image:n,status:r,company:l}});if(i.length>0){const e=Object.keys(i[0]),t=this.fun.getColumns(e);this.showModalTable("Car Info",t,i)}});else if("count"===e.position)this.showModalTable("Parking",[{label:"Date",name:"date",type:"mediumDate",sortable:!0},{label:"Price",name:"price",type:"price",sortable:!0},{label:"Driver",name:"driverName",type:"link",sortable:!0},{label:"Car",name:"plateNo",type:"link",sortable:!0},{label:"Image",name:"image",type:"image",sortable:!1}],e.data.items);else if("price"===e.position){const i=this.fun.getColumns(["time","place","price"]);this.showModalTable("Prices",i,null===(t=e.data)||void 0===t?void 0:t.prices)}}showModalTable(e,t,i,a="1000px"){this.dialogConfigModal.width=a,this.dialogConfigModal.lookupData={caption:e,columns:t,data:i},this.dialogServices.handleDialog(this.dialogConfigModal)}onToolBarActionClick(e){"plus"===e?this.add():"chart-bar"===e&&this.report()}}return e.\u0275fac=function(t){return new(t||e)(M.Qb(K.a),M.Qb(T.a),M.Qb(z.a),M.Qb(J.a),M.Qb(j.a),M.Qb(x.a),M.Qb(X.a),M.Qb(Q.a))},e.\u0275cmp=M.Kb({type:e,selectors:[["app-parking"]],decls:38,vars:17,consts:[[1,"card"],[1,"p-toolbar-group-left"],[1,"p-mr-3"],[3,"value","valueChange","selectionChange"],["value","day"],["value","isoWeek"],["value","month"],[1,"p-ml-3"],["multiple","",3,"value","valueChange","selectionChange"],["value","driverID"],["value","carID"],["value","date"],[3,"formGroup","rangePicker","max"],["matStartDate","","formControlName","start","placeholder","Start date"],["matEndDate","","formControlName","end","placeholder","End date",3,"ngModelChange"],["matSuffix","",3,"for"],["openOnFocus","true","timeInterval","5"],["picker",""],["id","componentID"],[3,"caption","columns","data","actions","selectedColumns","first","rows","sortBy","toolBarActions","buttonClick","toolBarButtonClick"]],template:function(e,t){if(1&e&&(M.Wb(0,"div",0),M.Wb(1,"p-toolbar"),M.Wb(2,"div",1),M.Wb(3,"mat-form-field",2),M.Wb(4,"mat-label"),M.Qc(5,"Duration"),M.Vb(),M.Wb(6,"mat-select",3),M.ec("valueChange",function(e){return t.duration=e})("selectionChange",function(e){return t.onColumnsChange(e)}),M.Wb(7,"mat-option",4),M.Qc(8,"Daily"),M.Vb(),M.Wb(9,"mat-option",5),M.Qc(10,"Weekly"),M.Vb(),M.Wb(11,"mat-option",6),M.Qc(12,"Monthly"),M.Vb(),M.Vb(),M.Vb(),M.Wb(13,"mat-form-field",7),M.Wb(14,"mat-label"),M.Qc(15,"Grouped By"),M.Vb(),M.Wb(16,"mat-select",8),M.ec("valueChange",function(e){return t.groupedBy=e})("selectionChange",function(e){return t.onGroupedByChange(e)}),M.Wb(17,"mat-option",9),M.Qc(18,"Driver"),M.Vb(),M.Wb(19,"mat-option",10),M.Qc(20,"Car"),M.Vb(),M.Wb(21,"mat-option",11),M.Qc(22,"Date"),M.Vb(),M.Vb(),M.Vb(),M.Vb(),M.Wb(23,"div",1),M.Wb(24,"mat-form-field"),M.Wb(25,"mat-label"),M.Qc(26,"Enter a date range"),M.Vb(),M.Wb(27,"mat-date-range-input",12),M.Rb(28,"input",13),M.Wb(29,"input",14),M.ec("ngModelChange",function(){return t.getChangedData()}),M.Vb(),M.Vb(),M.Wb(30,"mat-hint"),M.Qc(31,"DD/MM/YYYY \u2013 DD/MM/YYYY"),M.Vb(),M.Rb(32,"mat-datepicker-toggle",15),M.Rb(33,"mat-date-range-picker",16,17),M.Vb(),M.Vb(),M.Vb(),M.Vb(),M.Wb(35,"div",18),M.Wb(36,"app-table-template",19),M.ec("buttonClick",function(e){return t.onActionClick(e)})("toolBarButtonClick",function(e){return t.onToolBarActionClick(e)}),M.ic(37,"async"),M.Vb(),M.Vb()),2&e){const e=M.Bc(34);M.Cb(6),M.oc("value",t.duration),M.Cb(10),M.oc("value",t.groupedBy),M.Cb(11),M.oc("formGroup",t.range)("rangePicker",e)("max",t.today),M.Cb(5),M.oc("for",e),M.Cb(4),M.oc("caption",t.caption)("columns",t.columns)("data",M.jc(37,15,t.parking$))("actions",t.actions)("selectedColumns",t.columns)("first",(null==t.currentPage?null:t.currentPage.first)||0)("rows",(null==t.currentPage?null:t.currentPage.rows)||10)("sortBy",t.sortBy)("toolBarActions",t.toolBarActions)}},directives:[a.a,u.c,u.g,s.a,x.i,r.d,g.r,g.i,r.l,g.c,g.q,g.g,r.k,u.f,r.j,u.h,r.e,A.a],pipes:[y.b],styles:["@media print{[_nghost-%COMP%]{display:none}}"]}),Object(k.__decorate)([Object(R.a)()],e.prototype,"blockUI",void 0),e})();var ee=i("tyNb");const te=[{path:"",component:Z},{path:"**",redirectTo:""}];let ie=(()=>{class e{}return e.\u0275mod=M.Ob({type:e}),e.\u0275inj=M.Nb({factory:function(t){return new(t||e)},imports:[[ee.e.forChild(te)],ee.e]}),e})(),ae=(()=>{class e{}return e.\u0275mod=M.Ob({type:e}),e.\u0275inj=M.Nb({factory:function(t){return new(t||e)},imports:[[y.c,ie,C.a,v.f,g.k,g.v,f.b,h.c,m.b,a.b,D.e,D.c,p.a,b.f,u.e,d.c,c.b,s.b,l.b,r.i,n.a,o.a]]}),e})()}}]);